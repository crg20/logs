--- Bootstrap started on Thu, 15 Oct 2020 09:26:30 +0000 ---

cleanup() {
    rm -rf "${TMPFILES}" || true
}

trap cleanup EXIT
+ trap cleanup EXIT

BASE_DIR=$(dirname "$(readlink -f "${BASH_SOURCE[0]}")")
+++ readlink -f /srv/scality/metalk8s-2.6.0-dev/bootstrap.sh
++ dirname /srv/scality/metalk8s-2.6.0-dev/bootstrap.sh
+ BASE_DIR=/srv/scality/metalk8s-2.6.0-dev

SALT_CALL=${SALT_CALL:-salt-call}
+ SALT_CALL=salt-call

declare -a PACKAGES=(
    salt-minion-3000.3
    genisoimage
)
+ PACKAGES=(salt-minion-3000.3 genisoimage)
+ declare -a PACKAGES

# shellcheck disable=SC1090
. "$BASE_DIR"/common.sh
+ . /srv/scality/metalk8s-2.6.0-dev/common.sh
#!/bin/bash

declare OS OS_FAMILY
++ declare OS OS_FAMILY

declare -A GPGCHECK_YUM_REPOSITORIES=(
    [metalk8s-epel]=1
    [metalk8s-kubernetes]=1
    [metalk8s-saltstack]=1
    [metalk8s-scality]=0
)
++ GPGCHECK_YUM_REPOSITORIES=([metalk8s-epel]=1 [metalk8s-kubernetes]=1 [metalk8s-saltstack]=1 [metalk8s-scality]=0)
++ declare -A GPGCHECK_YUM_REPOSITORIES

declare -A GPGCHECK_APT_REPOSITORIES=(
    [metalk8s-bionic]=no
    [metalk8s-bionic-backports]=no
    [metalk8s-bionic-updates]=no
    [metalk8s-kubernetes-xenial]=no
    [metalk8s-salt_ubuntu1804]=no
    [metalk8s-scality]=no
)
++ GPGCHECK_APT_REPOSITORIES=([metalk8s-bionic]=no [metalk8s-bionic-backports]=no [metalk8s-bionic-updates]=no [metalk8s-kubernetes-xenial]=no [metalk8s-salt_ubuntu1804]=no [metalk8s-scality]=no)
++ declare -A GPGCHECK_APT_REPOSITORIES

RPM=${RPM:-$(command -v rpm || true)}
+++ command -v rpm
++ RPM=/usr/bin/rpm
DPKG=${DPKG:-$(command -v dpkg || true)}
+++ command -v dpkg
+++ true
++ DPKG=
YUM=${YUM:-$(command -v yum || true)}
+++ command -v yum
++ YUM=/usr/bin/yum
APT=${APT:-$(command -v apt || true)}
+++ command -v apt
+++ true
++ APT=
SYSTEMCTL=${SYSTEMCTL:-$(command -v systemctl)}
+++ command -v systemctl
++ SYSTEMCTL=/usr/bin/systemctl

determine_os() {
    # We rely on /etc/os-release to discover the OS because its present on all
    # recent Linux distributions
    if [ -f /etc/os-release ]; then
        # shellcheck disable=SC1091
        . /etc/os-release
        OS=$ID
        [[ $OS = rhel ]] && OS=redhat
        if [[ $OS =~ ^(redhat|centos)$ ]]; then
            OS_FAMILY=redhat
        elif [[ $OS =~ ^(debian|ubuntu)$ ]]; then
            OS_FAMILY=debian
        fi
    else
        die "Impossible to determine the OS"
    fi
}

configure_repositories() {
    case "$OS_FAMILY" in
        redhat)
            configure_yum_repositories
            ;;
        debian)
            configure_apt_repositories
            ;;
        *)
            die "OS $OS not supported";;
    esac
}

configure_yum_repositories() {
    configure_yum_local_repositories

    "$YUM" clean all
}

configure_apt_repositories() {
    configure_apt_local_repositories

    "$APT" clean all
}

configure_yum_local_repositories() {
    for repository in "${!GPGCHECK_YUM_REPOSITORIES[@]}"; do
        configure_yum_local_repository "$repository" \
            "${GPGCHECK_YUM_REPOSITORIES[$repository]}"
    done
}

configure_apt_local_repositories() {
    for repository in "${!GPGCHECK_APT_REPOSITORIES[@]}"; do
        configure_apt_local_repository "$repository"
    done
}

configure_yum_local_repository() {
    local -r repo_name=$1 gpgcheck=${2:-0}
    local -r repo_path="$BASE_DIR/packages/redhat/$repo_name-el7"
    local gpg_keys

    gpg_keys=$(
        find "$repo_path" -maxdepth 1 -name "RPM-GPG-KEY-*" \
            -printf "file://%p "
    )

    cat > /etc/yum.repos.d/"$repo_name".repo << EOF
[$repo_name]
name=$repo_name
baseurl=file://$repo_path
enabled=1
priority=1
gpgcheck=$gpgcheck
${gpg_keys:+gpgkey=${gpg_keys%?}}
EOF
}

configure_apt_local_repository() {
    local -r repo_name=$1
    local -r repo_path="$BASE_DIR/packages/debian/$repo_name"
    echo "deb [trusted=yes] file://$repo_path bionic $repo_name" \
        > /etc/apt/sources.list.d/"$repo_name".list
}

get_packages_list() {
    python -c "
import json

with open('$BASE_DIR/salt/metalk8s/versions.json', 'r') as fd:
    versions = json.load(fd)

packages = versions.get('packages', {}).get('$OS', {})
for pkg, pkg_info in packages.items():
    print('{0}{1}'.format(
        pkg, '-' + pkg_info['version'] if pkg_info.get('version') else '')
    )
"
}

check_packages_presence() {
    local -a packages
    local -a pkg_manager_opts=()

    case "$OS_FAMILY" in
        redhat)
            pkg_manager_opts=(
                "$YUM"
                install
                --assumeyes
                --setopt 'tsflags=test'
                --setopt 'skip_missing_names_on_install=False'
            )
            ;;
        debian)
            pkg_manager_opts=(
                "$APT"
                install
                --dry-run
            )
            ;;
    esac

    if read -ra packages < <(get_packages_list); then
        "${pkg_manager_opts[@]}" "${packages[@]}" || \
            die "some packages or dependencies are missing in the configured" \
                "repositories"
    fi
}

install_packages() {
    local -ra packages=("$@")
    local -a repo_list=(/etc/apt/sources.list)

    case "$OS_FAMILY" in
        redhat)
            local -a yum_opts=(
                '--assumeyes'
            )
            "$YUM" install "${yum_opts[@]}" "${packages[@]}"
            ;;
        debian)
            mapfile -O 1 -t repo_list < <(find \
                /etc/apt/sources.list.d/ \
                ! -name 'metalk8s-*' -a -name '*.list')

            for source_list in "${repo_list[@]}"; do
                mv "$source_list"{,.disabled}
            done
            "$APT" update
            DEBIAN_FRONTEND=noninteractive "$APT" -y install "${packages[@]}" \
                || exit_code=$?

            for source_list in "${repo_list[@]}"; do
                mv "$source_list"{.disabled,}
            done

            return ${exit_code:-0}
            ;;
        *)
            die "OS $OS not supported";;
    esac
}

pre_minion_checks() {
    test "x$(whoami)" = "xroot" || die "Script must run as root"
    test -n "${RPM}" || die "rpm not found"
    test -x "${RPM}" || die "rpm at '${RPM}' is not executable"
    test -n "${SYSTEMCTL}" || die "systemctl not found"
    test -x "${SYSTEMCTL}" || die "systemctl at '${SYSTEMCTL}' is not executable"
    test -n "${YUM}" || die "yum not found"
    test -x "${YUM}" || die "yum at '${YUM}' is not executable"
}

disable_salt_minion_service() {
    ${SYSTEMCTL} disable salt-minion.service 2>/dev/null || true
}

stop_salt_minion_service() {
    ${SYSTEMCTL} stop salt-minion.service 2>/dev/null || true
}

run_quiet() {
    local name=$1
    shift 1

    echo -n "> ${name}..."
    local start
    start=$(date +%s)
    set +e
    "$@" > >(tee -ia "${LOGFILE}" > "${TMPFILES}/out") 2>&1
    local RC=$?
    set -e
    local end
    end=$(date +%s)

    local duration=$(( end - start ))

    if [ $RC -eq 0 ]; then
        echo " done [${duration}s]"
    else
        echo " fail [${duration}s]"
        cat >/dev/stderr << EOM

Failure while running step '${name}'

Command: $@

Output:

<< BEGIN >>
EOM
        cat "${TMPFILES}/out" > /dev/stderr

        cat >/dev/stderr << EOM
<< END >>

This script will now exit

EOM

        exit 1
    fi
}

run_verbose() {
    local name=$1
    shift 1

    echo "> ${name}..."
    "$@"
}

run() {
    if [ "$VERBOSE" -eq 1 ]; then
        run_verbose "${@}"
    else
        run_quiet "${@}"
    fi
}

die() {
    echo 1>&2 "$@"
    return 1
}

check_package_manager_yum() {
    test -n "$RPM" || die "rpm not found"
    test -x "$RPM" || die "rpm at '$RPM' is not executable"
    test -n "$YUM" || die "yum not found"
    test -x "$YUM" || die "yum at '$YUM' is not executable"
}

check_package_manager_apt() {
    test -n "$DPKG" || die "dpkg not found"
    test -x "$DPKG" || die "dpkg at '$DPKG' is not executable"
    test -n "$APT" || die "apt not found"
    test -x "$APT" || die "apt '$APT' is not executable"
}

check_dist_centos() {
    check_package_manager_yum
}

check_dist_redhat() {
    check_package_manager_yum
    command -v subscription-manager || die "subscription-manager not found"
    subscription-manager status || \
        echo "Warning: system does not seem to be registered to any" \
             "subscription management service" >&2
}

check_dist_ubuntu() {
    check_package_manager_apt
}

pre_minion_checks() {
    if declare -f "check_dist_$OS" &> /dev/null; then
        "check_dist_$OS"
    else
        die "OS $OS not supported"
    fi

    test "x$(whoami)" = "xroot" || die "Script must run as root"
    test -n "$SYSTEMCTL" || die "systemctl not found"
    test -x "$SYSTEMCTL" || die "systemctl at '$SYSTEMCTL' is not executable"
}

get_salt_container() {
    local -r max_retries=10
    local salt_container='' attempts=0
    local -a found_containers=()

    while [[ $attempts -lt $max_retries ]]; do
        IFS=$'\n' read -r -d '' -a found_containers < <(crictl ps -q \
            --label io.kubernetes.pod.namespace=kube-system \
            --label io.kubernetes.container.name=salt-master \
            --state Running && printf '\0')

        if [[ "${#found_containers[@]}" -eq 1 ]]; then
            salt_container=${found_containers[0]}
            break
        fi
        echo "Invalid number of candidates: ${#found_containers[@]}" >&2
        (( attempts++ ))
        sleep 3
    done

    if [ -z "$salt_container" ]; then
        echo "Failed to find a running 'salt-master' container" >&2
        exit 1
    fi

    echo "$salt_container"
}

configure_salt_minion_local_mode() {
    local -r file_root="$BASE_DIR/salt"

    "$SALT_CALL" --file-root="$file_root" \
        --local --retcode-passthrough saltutil.sync_all saltenv=base
    "$SALT_CALL" --file-root="$file_root" \
        --local --retcode-passthrough state.sls metalk8s.salt.minion.local \
        pillar="{'metalk8s': {'archives': '$BASE_DIR'}}" saltenv=base
}

get_salt_env() {
    "$SALT_CALL" --out txt slsutil.renderer \
        string="metalk8s-{{ pillar.metalk8s.nodes[grains.id].version }}" \
        | cut -c 8-
}

get_salt_minion_id() {
    "$SALT_CALL" --out txt grains.get id | cut -c 8-
}

orchestrate_bootstrap() {
    # Grains must be set (in `/etc/salt/grains`) *before* invoking `salt-call`,
    # otherwise grains set during execution won't be taken into account
    # properly.
    run "Calculating Salt grains in local mode" \
        "$SALT_CALL" --local --state-output=mixed --retcode-passthrough state.sls \
            metalk8s.node.grains \
            saltenv=metalk8s-2.6.0-dev \
            pillarenv=metalk8s-2.6.0-dev

    local -r control_plane_ip=$(
        $SALT_CALL --local grains.get metalk8s:control_plane_ip --out txt \
        | awk '/^local\: /{ print $2 }'
    )

    pillar=(
      "{"
      "  'repo': {'local_mode': True},"
      "  'metalk8s': {"
      "    'endpoints': {"
      "      'repositories': {"
      "         'ip': $control_plane_ip,"
      "         'ports': {'http': 8080}"
      "      },"
      "      'salt-master': {'ip': $control_plane_ip}"
      "    }"
      "  }"
      "}"
    )

    run "Deploying early-stage bootstrap node in local mode (this may take a while)" \
        "$SALT_CALL" --local --state-output=mixed --retcode-passthrough \
            state.sls metalk8s.roles.internal.early-stage-bootstrap \
            saltenv=metalk8s-2.6.0-dev \
            pillarenv=metalk8s-2.6.0-dev \
            pillar="${pillar[*]}" -l trace

exit 1

    SALT_MASTER_CALL=(crictl exec -i "$(get_salt_container)")

    run "Syncing Utility modules on Salt master" \
        "${SALT_MASTER_CALL[@]}" salt-run --state-output=mixed saltutil.sync_utils \
            saltenv=metalk8s-2.6.0-dev

    run "Syncing Pillar modules on Salt master" \
        "${SALT_MASTER_CALL[@]}" salt-run --state-output=mixed saltutil.sync_pillar \
            saltenv=metalk8s-2.6.0-dev
    run "Syncing Runner modules on Salt master" \
        "${SALT_MASTER_CALL[@]}" salt-run --state-output=mixed saltutil.sync_runners \
            saltenv=metalk8s-2.6.0-dev
    run "Syncing Execution modules on Salt master" \
        "${SALT_MASTER_CALL[@]}" salt-run --state-output=mixed saltutil.sync_modules \
            saltenv=metalk8s-2.6.0-dev

    local -r bootstrap_id=$(
        $SALT_CALL --local --out txt grains.get id \
        | awk '/^local\: /{ print $2 }'
    )

    pillar=(
      "{"
      "  'bootstrap_id': '$bootstrap_id'"
      "}"
    )

    run "Accepting bootstrap minion key on Salt master" \
        "${SALT_MASTER_CALL[@]}" salt-run --state-output=mixed state.orchestrate \
            metalk8s.orchestrate.bootstrap.accept-minion \
            saltenv=metalk8s-2.6.0-dev \
            pillar="${pillar[*]}"

    run "Refreshing all modules and data on bootstrap minion" \
        salt-call --state-output=mixed saltutil.sync_all \
            refresh=True \
            saltenv=metalk8s-2.6.0-dev

    run "Deploying bootstrap node (this may take a while)" \
        "${SALT_MASTER_CALL[@]}" salt-run --state-output=mixed state.orchestrate \
            metalk8s.orchestrate.bootstrap \
            saltenv=metalk8s-2.6.0-dev \
            pillar="${pillar[*]}"

    # The `mine.update` executed during `metalk8s.orchestrate.bootstrap` seems
    # not always to actually update the mine with all `mine_functions` we
    # expect. Forcing another update seems to resolve this somewhat.
    run "Syncing mine" \
        "$SALT_CALL" mine.update
}


bootstrap_file_is_present() {
    if [ ! -f "$CONFIG_FILEPATH" ]; then
        die "You need to create a BootstrapConfiguration file, at $CONFIG_FILEPATH." \
            "Please refer to the configuration section of the MetalK8s Installation Guide"
        return 1
    fi
}


main() {
    run "Determine the OS" determine_os
    run "Checking that BootstrapConfiguration is present" bootstrap_file_is_present
    run "Pre-minion system tests" pre_minion_checks
    run "Configure internal repositories" configure_repositories
    run "Check mandatory packages presence" check_packages_presence
    run "Disabling Salt minion service" disable_salt_minion_service
    run "Stopping Salt minion service" stop_salt_minion_service
    run "Installing mandatory packages" install_packages "${PACKAGES[@]}"
    run "Configuring Salt minion to run in local mode" configure_salt_minion_local_mode

    orchestrate_bootstrap

    "$BASE_DIR"/backup.sh
}

main
+ main
+ run 'Determine the OS' determine_os
+ '[' 0 -eq 1 ']'
+ run_quiet 'Determine the OS' determine_os
+ local 'name=Determine the OS'
+ shift 1
+ echo -n '> Determine the OS...'
> Determine the OS...+ local start
++ date +%s
+ start=1602753990
+ set +e
+ determine_os
tee -ia "${LOGFILE}" > "${TMPFILES}/out"
++ tee -ia /var/log/metalk8s/bootstrap.log
+ local RC=0
+ set -e
+ local end
++ date +%s
+ '[' -f /etc/os-release ']'
+ . /etc/os-release
NAME="CentOS Linux"
++ NAME='CentOS Linux'
VERSION="7 (Core)"
++ VERSION='7 (Core)'
ID="centos"
++ ID=centos
ID_LIKE="rhel fedora"
++ ID_LIKE='rhel fedora'
VERSION_ID="7"
++ VERSION_ID=7
PRETTY_NAME="CentOS Linux 7 (Core)"
++ PRETTY_NAME='CentOS Linux 7 (Core)'
ANSI_COLOR="0;31"
++ ANSI_COLOR='0;31'
CPE_NAME="cpe:/o:centos:centos:7"
++ CPE_NAME=cpe:/o:centos:centos:7
HOME_URL="https://www.centos.org/"
++ HOME_URL=https://www.centos.org/
BUG_REPORT_URL="https://bugs.centos.org/"
++ BUG_REPORT_URL=https://bugs.centos.org/

CENTOS_MANTISBT_PROJECT="CentOS-7"
++ CENTOS_MANTISBT_PROJECT=CentOS-7
CENTOS_MANTISBT_PROJECT_VERSION="7"
++ CENTOS_MANTISBT_PROJECT_VERSION=7
REDHAT_SUPPORT_PRODUCT="centos"
++ REDHAT_SUPPORT_PRODUCT=centos
REDHAT_SUPPORT_PRODUCT_VERSION="7"
++ REDHAT_SUPPORT_PRODUCT_VERSION=7

+ OS=centos
+ [[ centos = rhel ]]
+ [[ centos =~ ^(redhat|centos)$ ]]
+ OS_FAMILY=redhat
+ end=1602753990
+ local duration=0
+ '[' 0 -eq 0 ']'
+ echo ' done [0s]'
 done [0s]
+ run 'Checking that BootstrapConfiguration is present' bootstrap_file_is_present
+ '[' 0 -eq 1 ']'
+ run_quiet 'Checking that BootstrapConfiguration is present' bootstrap_file_is_present
+ local 'name=Checking that BootstrapConfiguration is present'
+ shift 1
+ echo -n '> Checking that BootstrapConfiguration is present...'
> Checking that BootstrapConfiguration is present...+ local start
++ date +%s
+ start=1602753990
+ set +e
+ bootstrap_file_is_present
tee -ia "${LOGFILE}" > "${TMPFILES}/out"
+ local RC=0
+ set -e
+ local end
++ tee -ia /var/log/metalk8s/bootstrap.log
++ date +%s
+ '[' '!' -f /etc/metalk8s/bootstrap.yaml ']'
+ end=1602753990
+ local duration=0
+ '[' 0 -eq 0 ']'
+ echo ' done [0s]'
 done [0s]
+ run 'Pre-minion system tests' pre_minion_checks
+ '[' 0 -eq 1 ']'
+ run_quiet 'Pre-minion system tests' pre_minion_checks
+ local 'name=Pre-minion system tests'
+ shift 1
+ echo -n '> Pre-minion system tests...'
> Pre-minion system tests...+ local start
++ date +%s
+ start=1602753990
+ set +e
+ pre_minion_checks
tee -ia "${LOGFILE}" > "${TMPFILES}/out"
++ tee -ia /var/log/metalk8s/bootstrap.log
+ declare -f check_dist_centos
+ check_dist_centos
+ check_package_manager_yum
+ test -n /usr/bin/rpm
+ test -x /usr/bin/rpm
+ test -n /usr/bin/yum
+ test -x /usr/bin/yum
++ whoami
+ local RC=0
+ set -e
+ local end
+ test xroot = xroot
+ test -n /usr/bin/systemctl
+ test -x /usr/bin/systemctl
++ date +%s
+ end=1602753990
+ local duration=0
+ '[' 0 -eq 0 ']'
+ echo ' done [0s]'
 done [0s]
+ run 'Configure internal repositories' configure_repositories
+ '[' 0 -eq 1 ']'
+ run_quiet 'Configure internal repositories' configure_repositories
+ local 'name=Configure internal repositories'
+ shift 1
+ echo -n '> Configure internal repositories...'
> Configure internal repositories...+ local start
++ date +%s
+ start=1602753990
+ set +e
+ configure_repositories
tee -ia "${LOGFILE}" > "${TMPFILES}/out"
++ tee -ia /var/log/metalk8s/bootstrap.log
+ case "$OS_FAMILY" in
+ configure_yum_repositories
+ configure_yum_local_repositories
+ for repository in '"${!GPGCHECK_YUM_REPOSITORIES[@]}"'
+ configure_yum_local_repository metalk8s-kubernetes 1
+ local -r repo_name=metalk8s-kubernetes gpgcheck=1
+ local -r repo_path=/srv/scality/metalk8s-2.6.0-dev/packages/redhat/metalk8s-kubernetes-el7
+ local gpg_keys
++ find /srv/scality/metalk8s-2.6.0-dev/packages/redhat/metalk8s-kubernetes-el7 -maxdepth 1 -name 'RPM-GPG-KEY-*' -printf 'file://%p '
+ gpg_keys='file:///srv/scality/metalk8s-2.6.0-dev/packages/redhat/metalk8s-kubernetes-el7/RPM-GPG-KEY-metalk8s-kubernetes-7_2 file:///srv/scality/metalk8s-2.6.0-dev/packages/redhat/metalk8s-kubernetes-el7/RPM-GPG-KEY-metalk8s-kubernetes-7_1 '
+ cat
+ for repository in '"${!GPGCHECK_YUM_REPOSITORIES[@]}"'
+ configure_yum_local_repository metalk8s-epel 1
+ local -r repo_name=metalk8s-epel gpgcheck=1
+ local -r repo_path=/srv/scality/metalk8s-2.6.0-dev/packages/redhat/metalk8s-epel-el7
+ local gpg_keys
++ find /srv/scality/metalk8s-2.6.0-dev/packages/redhat/metalk8s-epel-el7 -maxdepth 1 -name 'RPM-GPG-KEY-*' -printf 'file://%p '
+ gpg_keys='file:///srv/scality/metalk8s-2.6.0-dev/packages/redhat/metalk8s-epel-el7/RPM-GPG-KEY-metalk8s-epel-7_1 '
+ cat
+ for repository in '"${!GPGCHECK_YUM_REPOSITORIES[@]}"'
+ configure_yum_local_repository metalk8s-scality 0
+ local -r repo_name=metalk8s-scality gpgcheck=0
+ local -r repo_path=/srv/scality/metalk8s-2.6.0-dev/packages/redhat/metalk8s-scality-el7
+ local gpg_keys
++ find /srv/scality/metalk8s-2.6.0-dev/packages/redhat/metalk8s-scality-el7 -maxdepth 1 -name 'RPM-GPG-KEY-*' -printf 'file://%p '
+ gpg_keys=
+ cat
+ for repository in '"${!GPGCHECK_YUM_REPOSITORIES[@]}"'
+ configure_yum_local_repository metalk8s-saltstack 1
+ local -r repo_name=metalk8s-saltstack gpgcheck=1
+ local -r repo_path=/srv/scality/metalk8s-2.6.0-dev/packages/redhat/metalk8s-saltstack-el7
+ local gpg_keys
++ find /srv/scality/metalk8s-2.6.0-dev/packages/redhat/metalk8s-saltstack-el7 -maxdepth 1 -name 'RPM-GPG-KEY-*' -printf 'file://%p '
+ gpg_keys='file:///srv/scality/metalk8s-2.6.0-dev/packages/redhat/metalk8s-saltstack-el7/RPM-GPG-KEY-metalk8s-saltstack-7_1 '
+ cat
+ /usr/bin/yum clean all
Failed to set locale, defaulting to C
Loaded plugins: fastestmirror
Cleaning repos: base epel extras metalk8s-epel metalk8s-kubernetes
              : metalk8s-saltstack metalk8s-scality updates
Cleaning up list of fastest mirrors
+ local RC=0
+ set -e
+ local end
++ date +%s
+ end=1602753991
+ local duration=1
+ '[' 0 -eq 0 ']'
+ echo ' done [1s]'
 done [1s]
+ run 'Check mandatory packages presence' check_packages_presence
+ '[' 0 -eq 1 ']'
+ run_quiet 'Check mandatory packages presence' check_packages_presence
+ local 'name=Check mandatory packages presence'
+ shift 1
+ echo -n '> Check mandatory packages presence...'
> Check mandatory packages presence...+ local start
++ date +%s
+ start=1602753991
+ set +e
+ check_packages_presence
tee -ia "${LOGFILE}" > "${TMPFILES}/out"
++ tee -ia /var/log/metalk8s/bootstrap.log
+ local -a packages
+ pkg_manager_opts=()
+ local -a pkg_manager_opts
+ case "$OS_FAMILY" in
+ pkg_manager_opts=("$YUM" install --assumeyes --setopt 'tsflags=test' --setopt 'skip_missing_names_on_install=False')
+ read -ra packages
get_packages_list
++ get_packages_list
++ python -c '
import json

with open('\''/srv/scality/metalk8s-2.6.0-dev/salt/metalk8s/versions.json'\'', '\''r'\'') as fd:
    versions = json.load(fd)

packages = versions.get('\''packages'\'', {}).get('\''centos'\'', {})
for pkg, pkg_info in packages.items():
    print('\''{0}{1}'\''.format(
        pkg, '\''-'\'' + pkg_info['\''version'\''] if pkg_info.get('\''version'\'') else '\'''\'')
    )
'
+ /usr/bin/yum install --assumeyes --setopt tsflags=test --setopt skip_missing_names_on_install=False iptables
Failed to set locale, defaulting to C
Loaded plugins: fastestmirror
Determining fastest mirrors
 * base: mirror.oss.ou.edu
 * epel: mirror.oss.ou.edu
 * extras: mirror.clarkson.edu
 * updates: centos.s.uw.edu
http://mirror.metrocast.net/fedora/epel/7/x86_64/repodata/ffef7b3bf9afed6102996c483439b512844b9ee7e54210b20353b62d31e6b24a-primary.sqlite.bz2: [Errno 12] Timeout on http://mirror.metrocast.net/fedora/epel/7/x86_64/repodata/ffef7b3bf9afed6102996c483439b512844b9ee7e54210b20353b62d31e6b24a-primary.sqlite.bz2: (28, 'Operation too slow. Less than 1000 bytes/sec transferred the last 30 seconds')
Trying other mirror.
http://mirror.arizona.edu/centos/7.8.2003/os/x86_64/repodata/f09552edffa70f49f553e411c2282fbccfffbeafa21e81e32622b103038b8bae-primary.sqlite.bz2: [Errno 12] Timeout on http://mirror.arizona.edu/centos/7.8.2003/os/x86_64/repodata/f09552edffa70f49f553e411c2282fbccfffbeafa21e81e32622b103038b8bae-primary.sqlite.bz2: (28, 'Operation too slow. Less than 1000 bytes/sec transferred the last 30 seconds')
Trying other mirror.
http://mirror.chpc.utah.edu/pub/centos/7.8.2003/updates/x86_64/repodata/3ceff108624118bff78dd0800f6d36b716cce8ad5606653c446b834e76b3b915-primary.sqlite.bz2: [Errno 12] Timeout on http://mirror.chpc.utah.edu/pub/centos/7.8.2003/updates/x86_64/repodata/3ceff108624118bff78dd0800f6d36b716cce8ad5606653c446b834e76b3b915-primary.sqlite.bz2: (28, 'Operation too slow. Less than 1000 bytes/sec transferred the last 30 seconds')
Trying other mirror.
http://mirrors.tummy.com/mirrors/CentOS/7.8.2003/os/x86_64/repodata/f09552edffa70f49f553e411c2282fbccfffbeafa21e81e32622b103038b8bae-primary.sqlite.bz2: [Errno 12] Timeout on http://mirrors.tummy.com/mirrors/CentOS/7.8.2003/os/x86_64/repodata/f09552edffa70f49f553e411c2282fbccfffbeafa21e81e32622b103038b8bae-primary.sqlite.bz2: (28, 'Operation too slow. Less than 1000 bytes/sec transferred the last 30 seconds')
Trying other mirror.
Package iptables-1.4.21-34.el7.x86_64 already installed and latest version
Nothing to do
+ local RC=0
+ set -e
+ local end
++ date +%s
+ end=1602754138
+ local duration=147
+ '[' 0 -eq 0 ']'
+ echo ' done [147s]'
 done [147s]
+ run 'Disabling Salt minion service' disable_salt_minion_service
+ '[' 0 -eq 1 ']'
+ run_quiet 'Disabling Salt minion service' disable_salt_minion_service
+ local 'name=Disabling Salt minion service'
+ shift 1
+ echo -n '> Disabling Salt minion service...'
> Disabling Salt minion service...+ local start
++ date +%s
+ start=1602754138
+ set +e
+ disable_salt_minion_service
tee -ia "${LOGFILE}" > "${TMPFILES}/out"
++ tee -ia /var/log/metalk8s/bootstrap.log
+ /usr/bin/systemctl disable salt-minion.service
+ local RC=0
+ set -e
+ local end
++ date +%s
+ end=1602754138
+ local duration=0
+ '[' 0 -eq 0 ']'
+ echo ' done [0s]'
 done [0s]
+ run 'Stopping Salt minion service' stop_salt_minion_service
+ '[' 0 -eq 1 ']'
+ run_quiet 'Stopping Salt minion service' stop_salt_minion_service
+ local 'name=Stopping Salt minion service'
+ shift 1
+ echo -n '> Stopping Salt minion service...'
> Stopping Salt minion service...+ local start
++ date +%s
+ start=1602754138
+ set +e
+ stop_salt_minion_service
tee -ia "${LOGFILE}" > "${TMPFILES}/out"
++ tee -ia /var/log/metalk8s/bootstrap.log
+ /usr/bin/systemctl stop salt-minion.service
+ local RC=0
+ set -e
+ local end
++ date +%s
+ end=1602754138
+ local duration=0
+ '[' 0 -eq 0 ']'
+ echo ' done [0s]'
 done [0s]
+ run 'Installing mandatory packages' install_packages salt-minion-3000.3 genisoimage
+ '[' 0 -eq 1 ']'
+ run_quiet 'Installing mandatory packages' install_packages salt-minion-3000.3 genisoimage
+ local 'name=Installing mandatory packages'
+ shift 1
+ echo -n '> Installing mandatory packages...'
> Installing mandatory packages...+ local start
++ date +%s
+ start=1602754138
+ set +e
+ install_packages salt-minion-3000.3 genisoimage
tee -ia "${LOGFILE}" > "${TMPFILES}/out"
++ tee -ia /var/log/metalk8s/bootstrap.log
+ packages=("$@")
+ local -ra packages
+ repo_list=(/etc/apt/sources.list)
+ local -a repo_list
+ case "$OS_FAMILY" in
+ yum_opts=('--assumeyes')
+ local -a yum_opts
+ /usr/bin/yum install --assumeyes salt-minion-3000.3 genisoimage
Failed to set locale, defaulting to C
Loaded plugins: fastestmirror
Loading mirror speeds from cached hostfile
 * base: mirror.oss.ou.edu
 * epel: mirror.oss.ou.edu
 * extras: mirror.clarkson.edu
 * updates: centos.s.uw.edu
Package salt-minion-3000.3-1.el7.noarch already installed and latest version
Package genisoimage-1.1.11-25.el7.x86_64 already installed and latest version
Nothing to do
+ local RC=0
+ set -e
+ local end
++ date +%s
+ end=1602754139
+ local duration=1
+ '[' 0 -eq 0 ']'
+ echo ' done [1s]'
 done [1s]
+ run 'Configuring Salt minion to run in local mode' configure_salt_minion_local_mode
+ '[' 0 -eq 1 ']'
+ run_quiet 'Configuring Salt minion to run in local mode' configure_salt_minion_local_mode
+ local 'name=Configuring Salt minion to run in local mode'
+ shift 1
+ echo -n '> Configuring Salt minion to run in local mode...'
> Configuring Salt minion to run in local mode...+ local start
++ date +%s
+ start=1602754139
+ set +e
+ configure_salt_minion_local_mode
tee -ia "${LOGFILE}" > "${TMPFILES}/out"
++ tee -ia /var/log/metalk8s/bootstrap.log
+ local -r file_root=/srv/scality/metalk8s-2.6.0-dev/salt
+ salt-call --file-root=/srv/scality/metalk8s-2.6.0-dev/salt --local --retcode-passthrough saltutil.sync_all saltenv=base
local:
    ----------
    beacons:
    clouds:
    engines:
    executors:
    grains:
    log_handlers:
    matchers:
    modules:
    output:
    pillar:
    proxymodules:
    renderers:
    returners:
    sdb:
    serializers:
    states:
    thorium:
    utils:
+ salt-call --file-root=/srv/scality/metalk8s-2.6.0-dev/salt --local --retcode-passthrough state.sls metalk8s.salt.minion.local 'pillar={'\''metalk8s'\'': {'\''archives'\'': '\''/srv/scality/metalk8s-2.6.0-dev'\''}}' saltenv=base
local:
----------
          ID: Configure salt minion for local mode
    Function: file.serialize
        Name: /etc/salt/minion.d/99-metalk8s-local.conf
      Result: True
     Comment: File /etc/salt/minion.d/99-metalk8s-local.conf is in the correct state
     Started: 09:29:03.075424
    Duration: 17.7 ms
     Changes:   

Summary for local
------------
Succeeded: 1
Failed:    0
------------
Total states run:     1
Total run time:  17.700 ms
+ local RC=0
+ set -e
+ local end
++ date +%s
+ end=1602754143
+ local duration=4
+ '[' 0 -eq 0 ']'
+ echo ' done [4s]'
 done [4s]
+ orchestrate_bootstrap
+ run 'Calculating Salt grains in local mode' salt-call --local --state-output=mixed --retcode-passthrough state.sls metalk8s.node.grains saltenv=metalk8s-2.6.0-dev pillarenv=metalk8s-2.6.0-dev
+ '[' 0 -eq 1 ']'
+ run_quiet 'Calculating Salt grains in local mode' salt-call --local --state-output=mixed --retcode-passthrough state.sls metalk8s.node.grains saltenv=metalk8s-2.6.0-dev pillarenv=metalk8s-2.6.0-dev
+ local 'name=Calculating Salt grains in local mode'
+ shift 1
+ echo -n '> Calculating Salt grains in local mode...'
> Calculating Salt grains in local mode...+ local start
++ date +%s
+ start=1602754143
+ set +e
+ salt-call --local --state-output=mixed --retcode-passthrough state.sls metalk8s.node.grains saltenv=metalk8s-2.6.0-dev pillarenv=metalk8s-2.6.0-dev
tee -ia "${LOGFILE}" > "${TMPFILES}/out"
++ tee -ia /var/log/metalk8s/bootstrap.log
local:
  Name: metalk8s:control_plane_ip - Function: grains.present - Result: Clean Started: - 09:29:04.314766 Duration: 1.884 ms
  Name: metalk8s:workload_plane_ip - Function: grains.present - Result: Clean Started: - 09:29:04.316878 Duration: 0.584 ms

Summary for local
------------
Succeeded: 2
Failed:    0
------------
Total states run:     2
Total run time:   2.468 ms
+ local RC=0
+ set -e
+ local end
++ date +%s
+ end=1602754144
+ local duration=1
+ '[' 0 -eq 0 ']'
+ echo ' done [1s]'
 done [1s]
++ salt-call --local grains.get metalk8s:control_plane_ip --out txt
++ awk '/^local\: /{ print $2 }'
+ local -r control_plane_ip=10.0.3.15
+ pillar=("{" "  'repo': {'local_mode': True}," "  'metalk8s': {" "    'endpoints': {" "      'repositories': {" "         'ip': $control_plane_ip," "         'ports': {'http': 8080}" "      }," "      'salt-master': {'ip': $control_plane_ip}" "    }" "  }" "}")
+ run 'Deploying early-stage bootstrap node in local mode (this may take a while)' salt-call --local --state-output=mixed --retcode-passthrough state.sls metalk8s.roles.internal.early-stage-bootstrap saltenv=metalk8s-2.6.0-dev pillarenv=metalk8s-2.6.0-dev 'pillar={   '\''repo'\'': {'\''local_mode'\'': True},   '\''metalk8s'\'': {     '\''endpoints'\'': {       '\''repositories'\'': {          '\''ip'\'': 10.0.3.15,          '\''ports'\'': {'\''http'\'': 8080}       },       '\''salt-master'\'': {'\''ip'\'': 10.0.3.15}     }   } }' -l trace
+ '[' 0 -eq 1 ']'
+ run_quiet 'Deploying early-stage bootstrap node in local mode (this may take a while)' salt-call --local --state-output=mixed --retcode-passthrough state.sls metalk8s.roles.internal.early-stage-bootstrap saltenv=metalk8s-2.6.0-dev pillarenv=metalk8s-2.6.0-dev 'pillar={   '\''repo'\'': {'\''local_mode'\'': True},   '\''metalk8s'\'': {     '\''endpoints'\'': {       '\''repositories'\'': {          '\''ip'\'': 10.0.3.15,          '\''ports'\'': {'\''http'\'': 8080}       },       '\''salt-master'\'': {'\''ip'\'': 10.0.3.15}     }   } }' -l trace
+ local 'name=Deploying early-stage bootstrap node in local mode (this may take a while)'
+ shift 1
+ echo -n '> Deploying early-stage bootstrap node in local mode (this may take a while)...'
> Deploying early-stage bootstrap node in local mode (this may take a while)...+ local start
++ date +%s
+ start=1602754145
+ set +e
+ salt-call --local --state-output=mixed --retcode-passthrough state.sls metalk8s.roles.internal.early-stage-bootstrap saltenv=metalk8s-2.6.0-dev pillarenv=metalk8s-2.6.0-dev 'pillar={   '\''repo'\'': {'\''local_mode'\'': True},   '\''metalk8s'\'': {     '\''endpoints'\'': {       '\''repositories'\'': {          '\''ip'\'': 10.0.3.15,          '\''ports'\'': {'\''http'\'': 8080}       },       '\''salt-master'\'': {'\''ip'\'': 10.0.3.15}     }   } }' -l trace
tee -ia "${LOGFILE}" > "${TMPFILES}/out"
++ tee -ia /var/log/metalk8s/bootstrap.log
[DEBUG   ] Reading configuration from /etc/salt/minion
[DEBUG   ] Including configuration from '/etc/salt/minion.d/99-metalk8s-local.conf'
[DEBUG   ] Reading configuration from /etc/salt/minion.d/99-metalk8s-local.conf
[DEBUG   ] Using cached minion ID from /etc/salt/minion_id: 10.0.2.15
[TRACE   ] The required configuration section, 'fluent_handler', was not found the in the configuration. Not loading the fluent logging handlers module.
[TRACE   ] None of the required configuration sections, 'logstash_udp_handler' and 'logstash_zmq_handler', were found in the configuration. Not loading the Logstash logging handlers module.
[DEBUG   ] Configuration file path: /etc/salt/minion
[WARNING ] Insecure logging configuration detected! Sensitive data may be logged.
[DEBUG   ] Grains refresh requested. Refreshing grains.
[DEBUG   ] Reading configuration from /etc/salt/minion
[DEBUG   ] Including configuration from '/etc/salt/minion.d/99-metalk8s-local.conf'
[DEBUG   ] Reading configuration from /etc/salt/minion.d/99-metalk8s-local.conf
[TRACE   ] 'dig' could not be found in the following search path: '[u'/usr/local/sbin', u'/usr/local/bin', u'/usr/sbin', u'/usr/bin', u'/root/bin', u'/sbin', u'/bin']'
[TRACE   ] 'drill' could not be found in the following search path: '[u'/usr/local/sbin', u'/usr/local/bin', u'/usr/sbin', u'/usr/bin', u'/root/bin', u'/sbin', u'/bin']'
[TRACE   ] 'host' could not be found in the following search path: '[u'/usr/local/sbin', u'/usr/local/bin', u'/usr/sbin', u'/usr/bin', u'/root/bin', u'/sbin', u'/bin']'
[TRACE   ] 'nslookup' could not be found in the following search path: '[u'/usr/local/sbin', u'/usr/local/bin', u'/usr/sbin', u'/usr/bin', u'/root/bin', u'/sbin', u'/bin']'
[TRACE   ] 'esxcli' could not be found in the following search path: '[u'/usr/local/sbin', u'/usr/local/bin', u'/usr/sbin', u'/usr/bin', u'/root/bin', u'/sbin', u'/bin']'
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False, False) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False, False) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False, False) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False, False) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False, False) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False, False) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False, False) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False, False) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Error loading grains.napalm: "napalm"" (/usr/lib/python2.7/site-packages/salt/grains/napalm.pyc) cannot be loaded: NAPALM is not installed: ``pip install napalm``
[TRACE   ] Loading core.append_domain grain
[TRACE   ] Loading core.cwd grain
[TRACE   ] Loading core.default_gateway grain
[TRACE   ] Loading core.dns grain
[TRACE   ] Loading core.fqdns grain
[TRACE   ] Loading core.get_machine_id grain
[TRACE   ] Loading core.get_master grain
[TRACE   ] Loading core.get_server_id grain
[TRACE   ] Loading core.hostname grain
[TRACE   ] Loading core.hwaddr_interfaces grain
[TRACE   ] Loading core.id_ grain
[TRACE   ] Loading core.ip4_interfaces grain
[TRACE   ] Loading core.ip6_interfaces grain
[TRACE   ] Loading core.ip_fqdn grain
[TRACE   ] Loading core.ip_interfaces grain
[TRACE   ] Loading core.linux_distribution grain
[TRACE   ] Loading core.locale_info grain
[TRACE   ] Loading core.os_data grain
[TRACE   ] Adding selinux grains
[TRACE   ] Adding systemd grains
[TRACE   ] Adding init grain
[TRACE   ] Getting lsb_release distro information
[TRACE   ] lsb_release python bindings not available
[TRACE   ] Attempting to parse /etc/lsb-release
[TRACE   ] Failed to parse /etc/lsb-release: [Errno 2] No such file or directory: u'/etc/lsb-release'
[TRACE   ] Failed to get lsb_distrib_id, trying to parse os-release
[TRACE   ] Getting OS name, release, and codename from platform.linux_distribution()
[TRACE   ] Loading core.path grain
[TRACE   ] Loading core.pythonexecutable grain
[TRACE   ] Loading core.pythonpath grain
[TRACE   ] Loading core.pythonversion grain
[TRACE   ] Loading core.saltpath grain
[TRACE   ] Loading core.saltversion grain
[TRACE   ] Loading core.saltversioninfo grain
[TRACE   ] Loading core.zmqversion grain
[TRACE   ] Loading disks.disks grain
[TRACE   ] Device sda reports itself as an HDD
[TRACE   ] Device dm-0 reports itself as an HDD
[TRACE   ] Device dm-1 reports itself as an HDD
[TRACE   ] Loading extra.config grain
[DEBUG   ] Loading static grains from /etc/salt/grains
[TRACE   ] Loading extra.shell grain
[TRACE   ] Loading mdadm.mdadm grain
[TRACE   ] Loading minion_process.grains grain
[TRACE   ] Loading opts.opts grain
[TRACE   ] Loading zfs.zfs grain
[DEBUG   ] LazyLoaded zfs.is_supported
[TRACE   ] 'zfs-fuse' could not be found in the following search path: '[u'/usr/local/sbin', u'/usr/local/bin', u'/usr/sbin', u'/usr/bin', u'/root/bin', u'/sbin', u'/bin']'
[TRACE   ] 'zpool' could not be found in the following search path: '[u'/usr/local/sbin', u'/usr/local/bin', u'/usr/sbin', u'/usr/bin', u'/root/bin', u'/sbin', u'/bin']'
[DEBUG   ] Determining pillar cache
[DEBUG   ] LazyLoaded jinja.render
[DEBUG   ] LazyLoaded yaml.render
[DEBUG   ] compile template: /srv/scality/metalk8s-2.6.0-dev/pillar/top.sls
[DEBUG   ] Jinja search path: [u'/srv/scality/metalk8s-2.6.0-dev/pillar']
[PROFILE ] Time (in seconds) to render '/srv/scality/metalk8s-2.6.0-dev/pillar/top.sls' using 'jinja' renderer: 0.0151019096375
[DEBUG   ] Rendered data from file: /srv/scality/metalk8s-2.6.0-dev/pillar/top.sls:
# The mechanics of this file are very similar to those of `salt/top.sls(.in)`.
# Please refer to the comments in that file for more background.

metalk8s-2.6.0-dev:
  I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev:
    - match: compound
    - metalk8s.roles.minion

  # Specific case for ca as we need signing_policy at the very beginning
  I@metalk8s:ca:minion:10.0.2.15:
    - match: compound
    - metalk8s.roles.ca


  I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:bootstrap:
    - match: compound
    - metalk8s.roles.bootstrap

  I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:etcd:
    - match: compound
    - metalk8s.roles.etcd

  I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:master:
    - match: compound
    - metalk8s.roles.master

  I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:node:
    - match: compound
    - metalk8s.roles.node


[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'metalk8s-2.6.0-dev', OrderedDict([(u'I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev', [OrderedDict([(u'match', u'compound')]), u'metalk8s.roles.minion']), (u'I@metalk8s:ca:minion:10.0.2.15', [OrderedDict([(u'match', u'compound')]), u'metalk8s.roles.ca']), (u'I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:bootstrap', [OrderedDict([(u'match', u'compound')]), u'metalk8s.roles.bootstrap']), (u'I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:etcd', [OrderedDict([(u'match', u'compound')]), u'metalk8s.roles.etcd']), (u'I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:master', [OrderedDict([(u'match', u'compound')]), u'metalk8s.roles.master']), (u'I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:node', [OrderedDict([(u'match', u'compound')]), u'metalk8s.roles.node'])]))])
[PROFILE ] Time (in seconds) to render '/srv/scality/metalk8s-2.6.0-dev/pillar/top.sls' using 'yaml' renderer: 0.00103092193604
[DEBUG   ] LazyLoaded metalk8s.ext_pillar
[DEBUG   ] Loading MetalK8s configuration from /etc/metalk8s/bootstrap.yaml
[DEBUG   ] LazyLoaded pillar_utils.assert_equals
[DEBUG   ] LazyLoaded jinja.render
[DEBUG   ] LazyLoaded yaml.render
[DEBUG   ] LazyLoaded confirm_top.confirm_top
[DEBUG   ] LazyLoaded compound_match.match
[DEBUG   ] compound_match: 10.0.2.15 ? I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev
[DEBUG   ] LazyLoaded pillar_match.match
[DEBUG   ] pillar target: metalk8s:nodes:10.0.2.15:version:2.6.0-dev
[DEBUG   ] Attempting to match '2.6.0-dev' in 'metalk8s:nodes:10.0.2.15:version' using delimiter ':'
[DEBUG   ] Attempting to match 'version:2.6.0-dev' in 'metalk8s:nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:version:2.6.0-dev' in 'metalk8s:nodes' using delimiter ':'
[DEBUG   ] Attempting to match 'nodes:10.0.2.15:version:2.6.0-dev' in 'metalk8s' using delimiter ':'
[DEBUG   ] Attempting to match '2.6.0-dev' in 'nodes:10.0.2.15:version' using delimiter ':'
[DEBUG   ] Attempting to match 'version:2.6.0-dev' in 'nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:version:2.6.0-dev' in 'nodes' using delimiter ':'
[DEBUG   ] compound_match 10.0.2.15 ? "I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev" => "False"
[DEBUG   ] LazyLoaded compound_match.match
[DEBUG   ] compound_match: 10.0.2.15 ? I@metalk8s:ca:minion:10.0.2.15
[DEBUG   ] LazyLoaded pillar_match.match
[DEBUG   ] pillar target: metalk8s:ca:minion:10.0.2.15
[DEBUG   ] Attempting to match '10.0.2.15' in 'metalk8s:ca:minion' using delimiter ':'
[DEBUG   ] compound_match 10.0.2.15 ? "I@metalk8s:ca:minion:10.0.2.15" => "True"
[DEBUG   ] LazyLoaded compound_match.match
[DEBUG   ] compound_match: 10.0.2.15 ? I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:bootstrap
[DEBUG   ] LazyLoaded pillar_match.match
[DEBUG   ] pillar target: metalk8s:nodes:10.0.2.15:version:2.6.0-dev
[DEBUG   ] Attempting to match '2.6.0-dev' in 'metalk8s:nodes:10.0.2.15:version' using delimiter ':'
[DEBUG   ] Attempting to match 'version:2.6.0-dev' in 'metalk8s:nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:version:2.6.0-dev' in 'metalk8s:nodes' using delimiter ':'
[DEBUG   ] Attempting to match 'nodes:10.0.2.15:version:2.6.0-dev' in 'metalk8s' using delimiter ':'
[DEBUG   ] Attempting to match '2.6.0-dev' in 'nodes:10.0.2.15:version' using delimiter ':'
[DEBUG   ] Attempting to match 'version:2.6.0-dev' in 'nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:version:2.6.0-dev' in 'nodes' using delimiter ':'
[DEBUG   ] pillar target: metalk8s:nodes:10.0.2.15:roles:bootstrap
[DEBUG   ] Attempting to match 'bootstrap' in 'metalk8s:nodes:10.0.2.15:roles' using delimiter ':'
[DEBUG   ] Attempting to match 'roles:bootstrap' in 'metalk8s:nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:roles:bootstrap' in 'metalk8s:nodes' using delimiter ':'
[DEBUG   ] Attempting to match 'nodes:10.0.2.15:roles:bootstrap' in 'metalk8s' using delimiter ':'
[DEBUG   ] Attempting to match 'bootstrap' in 'nodes:10.0.2.15:roles' using delimiter ':'
[DEBUG   ] Attempting to match 'roles:bootstrap' in 'nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:roles:bootstrap' in 'nodes' using delimiter ':'
[DEBUG   ] compound_match 10.0.2.15 ? "I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:bootstrap" => "False and False"
[DEBUG   ] LazyLoaded compound_match.match
[DEBUG   ] compound_match: 10.0.2.15 ? I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:etcd
[DEBUG   ] LazyLoaded pillar_match.match
[DEBUG   ] pillar target: metalk8s:nodes:10.0.2.15:version:2.6.0-dev
[DEBUG   ] Attempting to match '2.6.0-dev' in 'metalk8s:nodes:10.0.2.15:version' using delimiter ':'
[DEBUG   ] Attempting to match 'version:2.6.0-dev' in 'metalk8s:nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:version:2.6.0-dev' in 'metalk8s:nodes' using delimiter ':'
[DEBUG   ] Attempting to match 'nodes:10.0.2.15:version:2.6.0-dev' in 'metalk8s' using delimiter ':'
[DEBUG   ] Attempting to match '2.6.0-dev' in 'nodes:10.0.2.15:version' using delimiter ':'
[DEBUG   ] Attempting to match 'version:2.6.0-dev' in 'nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:version:2.6.0-dev' in 'nodes' using delimiter ':'
[DEBUG   ] pillar target: metalk8s:nodes:10.0.2.15:roles:etcd
[DEBUG   ] Attempting to match 'etcd' in 'metalk8s:nodes:10.0.2.15:roles' using delimiter ':'
[DEBUG   ] Attempting to match 'roles:etcd' in 'metalk8s:nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:roles:etcd' in 'metalk8s:nodes' using delimiter ':'
[DEBUG   ] Attempting to match 'nodes:10.0.2.15:roles:etcd' in 'metalk8s' using delimiter ':'
[DEBUG   ] Attempting to match 'etcd' in 'nodes:10.0.2.15:roles' using delimiter ':'
[DEBUG   ] Attempting to match 'roles:etcd' in 'nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:roles:etcd' in 'nodes' using delimiter ':'
[DEBUG   ] compound_match 10.0.2.15 ? "I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:etcd" => "False and False"
[DEBUG   ] LazyLoaded compound_match.match
[DEBUG   ] compound_match: 10.0.2.15 ? I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:master
[DEBUG   ] LazyLoaded pillar_match.match
[DEBUG   ] pillar target: metalk8s:nodes:10.0.2.15:version:2.6.0-dev
[DEBUG   ] Attempting to match '2.6.0-dev' in 'metalk8s:nodes:10.0.2.15:version' using delimiter ':'
[DEBUG   ] Attempting to match 'version:2.6.0-dev' in 'metalk8s:nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:version:2.6.0-dev' in 'metalk8s:nodes' using delimiter ':'
[DEBUG   ] Attempting to match 'nodes:10.0.2.15:version:2.6.0-dev' in 'metalk8s' using delimiter ':'
[DEBUG   ] Attempting to match '2.6.0-dev' in 'nodes:10.0.2.15:version' using delimiter ':'
[DEBUG   ] Attempting to match 'version:2.6.0-dev' in 'nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:version:2.6.0-dev' in 'nodes' using delimiter ':'
[DEBUG   ] pillar target: metalk8s:nodes:10.0.2.15:roles:master
[DEBUG   ] Attempting to match 'master' in 'metalk8s:nodes:10.0.2.15:roles' using delimiter ':'
[DEBUG   ] Attempting to match 'roles:master' in 'metalk8s:nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:roles:master' in 'metalk8s:nodes' using delimiter ':'
[DEBUG   ] Attempting to match 'nodes:10.0.2.15:roles:master' in 'metalk8s' using delimiter ':'
[DEBUG   ] Attempting to match 'master' in 'nodes:10.0.2.15:roles' using delimiter ':'
[DEBUG   ] Attempting to match 'roles:master' in 'nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:roles:master' in 'nodes' using delimiter ':'
[DEBUG   ] compound_match 10.0.2.15 ? "I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:master" => "False and False"
[DEBUG   ] LazyLoaded compound_match.match
[DEBUG   ] compound_match: 10.0.2.15 ? I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:node
[DEBUG   ] LazyLoaded pillar_match.match
[DEBUG   ] pillar target: metalk8s:nodes:10.0.2.15:version:2.6.0-dev
[DEBUG   ] Attempting to match '2.6.0-dev' in 'metalk8s:nodes:10.0.2.15:version' using delimiter ':'
[DEBUG   ] Attempting to match 'version:2.6.0-dev' in 'metalk8s:nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:version:2.6.0-dev' in 'metalk8s:nodes' using delimiter ':'
[DEBUG   ] Attempting to match 'nodes:10.0.2.15:version:2.6.0-dev' in 'metalk8s' using delimiter ':'
[DEBUG   ] Attempting to match '2.6.0-dev' in 'nodes:10.0.2.15:version' using delimiter ':'
[DEBUG   ] Attempting to match 'version:2.6.0-dev' in 'nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:version:2.6.0-dev' in 'nodes' using delimiter ':'
[DEBUG   ] pillar target: metalk8s:nodes:10.0.2.15:roles:node
[DEBUG   ] Attempting to match 'node' in 'metalk8s:nodes:10.0.2.15:roles' using delimiter ':'
[DEBUG   ] Attempting to match 'roles:node' in 'metalk8s:nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:roles:node' in 'metalk8s:nodes' using delimiter ':'
[DEBUG   ] Attempting to match 'nodes:10.0.2.15:roles:node' in 'metalk8s' using delimiter ':'
[DEBUG   ] Attempting to match 'node' in 'nodes:10.0.2.15:roles' using delimiter ':'
[DEBUG   ] Attempting to match 'roles:node' in 'nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:roles:node' in 'nodes' using delimiter ':'
[DEBUG   ] compound_match 10.0.2.15 ? "I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:node" => "False and False"
[DEBUG   ] compile template: /srv/scality/metalk8s-2.6.0-dev/pillar/metalk8s/roles/ca.sls
[DEBUG   ] Jinja search path: [u'/srv/scality/metalk8s-2.6.0-dev/pillar']
[PROFILE ] Time (in seconds) to render '/srv/scality/metalk8s-2.6.0-dev/pillar/metalk8s/roles/ca.sls' using 'jinja' renderer: 0.0032172203064
[DEBUG   ] Rendered data from file: /srv/scality/metalk8s-2.6.0-dev/pillar/metalk8s/roles/ca.sls:
mine_functions:
  kubernetes_root_ca_b64:
    - mine_function: hashutil.base64_encodefile
    - /etc/kubernetes/pki/ca.crt

  kubernetes_etcd_ca_b64:
    - mine_function: hashutil.base64_encodefile
    - /etc/kubernetes/pki/etcd/ca.crt

  kubernetes_front_proxy_ca_b64:
    - mine_function: hashutil.base64_encodefile
    - /etc/kubernetes/pki/front-proxy-ca.crt

  kubernetes_sa_pub_key_b64:
    - mine_function: hashutil.base64_encodefile
    - /etc/kubernetes/pki/sa.pub

  dex_ca_b64:
    - mine_function: hashutil.base64_encodefile
    - /etc/metalk8s/pki/dex/ca.crt

  ingress_ca_b64:
    - mine_function: hashutil.base64_encodefile
    - /etc/metalk8s/pki/nginx-ingress/ca.crt

x509_signing_policies:
  kube_apiserver_client_policy:
    - minions: '*'
    - signing_private_key: /etc/kubernetes/pki/ca.key
    - signing_cert: /etc/kubernetes/pki/ca.crt
    - keyUsage: critical digitalSignature, keyEncipherment
    - extendedKeyUsage: clientAuth
    - days_valid: 365
  kube_apiserver_server_policy:
    - minions: '*'
    - signing_private_key: /etc/kubernetes/pki/ca.key
    - signing_cert: /etc/kubernetes/pki/ca.crt
    - keyUsage: critical digitalSignature, keyEncipherment
    - extendedKeyUsage: serverAuth
    - days_valid: 365
  etcd_client_policy:
    - minions: '*'
    - signing_private_key: /etc/kubernetes/pki/etcd/ca.key
    - signing_cert: /etc/kubernetes/pki/etcd/ca.crt
    - keyUsage: critical digitalSignature, keyEncipherment
    - extendedKeyUsage: clientAuth
    - days_valid: 365
  etcd_server_client_policy:
    - minions: '*'
    - signing_private_key: /etc/kubernetes/pki/etcd/ca.key
    - signing_cert: /etc/kubernetes/pki/etcd/ca.crt
    - keyUsage: critical digitalSignature, keyEncipherment
    - extendedKeyUsage: serverAuth, clientAuth
    - days_valid: 365
  front_proxy_client_policy:
    - minions: '*'
    - signing_private_key: /etc/kubernetes/pki/front-proxy-ca.key
    - signing_cert: /etc/kubernetes/pki/front-proxy-ca.crt
    - keyUsage: critical digitalSignature, keyEncipherment
    - extendedKeyUsage: clientAuth
    - days_valid: 365
  ingress_server_policy:
    - minions: '*'
    - signing_private_key: /etc/metalk8s/pki/nginx-ingress/ca.key
    - signing_cert: /etc/metalk8s/pki/nginx-ingress/ca.crt
    - keyUsage: critical digitalSignature, keyEncipherment
    - extendedKeyUsage: serverAuth
    - days_valid: 365
  dex_server_policy:
    - minions: '*'
    - signing_private_key: /etc/metalk8s/pki/dex/ca.key
    - signing_cert: /etc/metalk8s/pki/dex/ca.crt
    - keyUsage: critical digitalSignature, keyEncipherment
    - extendedKeyUsage: serverAuth
    - days_valid: 365

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'mine_functions', OrderedDict([(u'kubernetes_root_ca_b64', [OrderedDict([(u'mine_function', u'hashutil.base64_encodefile')]), u'/etc/kubernetes/pki/ca.crt']), (u'kubernetes_etcd_ca_b64', [OrderedDict([(u'mine_function', u'hashutil.base64_encodefile')]), u'/etc/kubernetes/pki/etcd/ca.crt']), (u'kubernetes_front_proxy_ca_b64', [OrderedDict([(u'mine_function', u'hashutil.base64_encodefile')]), u'/etc/kubernetes/pki/front-proxy-ca.crt']), (u'kubernetes_sa_pub_key_b64', [OrderedDict([(u'mine_function', u'hashutil.base64_encodefile')]), u'/etc/kubernetes/pki/sa.pub']), (u'dex_ca_b64', [OrderedDict([(u'mine_function', u'hashutil.base64_encodefile')]), u'/etc/metalk8s/pki/dex/ca.crt']), (u'ingress_ca_b64', [OrderedDict([(u'mine_function', u'hashutil.base64_encodefile')]), u'/etc/metalk8s/pki/nginx-ingress/ca.crt'])])), (u'x509_signing_policies', OrderedDict([(u'kube_apiserver_client_policy', [OrderedDict([(u'minions', u'*')]), OrderedDict([(u'signing_private_key', u'/etc/kubernetes/pki/ca.key')]), OrderedDict([(u'signing_cert', u'/etc/kubernetes/pki/ca.crt')]), OrderedDict([(u'keyUsage', u'critical digitalSignature, keyEncipherment')]), OrderedDict([(u'extendedKeyUsage', u'clientAuth')]), OrderedDict([(u'days_valid', 365)])]), (u'kube_apiserver_server_policy', [OrderedDict([(u'minions', u'*')]), OrderedDict([(u'signing_private_key', u'/etc/kubernetes/pki/ca.key')]), OrderedDict([(u'signing_cert', u'/etc/kubernetes/pki/ca.crt')]), OrderedDict([(u'keyUsage', u'critical digitalSignature, keyEncipherment')]), OrderedDict([(u'extendedKeyUsage', u'serverAuth')]), OrderedDict([(u'days_valid', 365)])]), (u'etcd_client_policy', [OrderedDict([(u'minions', u'*')]), OrderedDict([(u'signing_private_key', u'/etc/kubernetes/pki/etcd/ca.key')]), OrderedDict([(u'signing_cert', u'/etc/kubernetes/pki/etcd/ca.crt')]), OrderedDict([(u'keyUsage', u'critical digitalSignature, keyEncipherment')]), OrderedDict([(u'extendedKeyUsage', u'clientAuth')]), OrderedDict([(u'days_valid', 365)])]), (u'etcd_server_client_policy', [OrderedDict([(u'minions', u'*')]), OrderedDict([(u'signing_private_key', u'/etc/kubernetes/pki/etcd/ca.key')]), OrderedDict([(u'signing_cert', u'/etc/kubernetes/pki/etcd/ca.crt')]), OrderedDict([(u'keyUsage', u'critical digitalSignature, keyEncipherment')]), OrderedDict([(u'extendedKeyUsage', u'serverAuth, clientAuth')]), OrderedDict([(u'days_valid', 365)])]), (u'front_proxy_client_policy', [OrderedDict([(u'minions', u'*')]), OrderedDict([(u'signing_private_key', u'/etc/kubernetes/pki/front-proxy-ca.key')]), OrderedDict([(u'signing_cert', u'/etc/kubernetes/pki/front-proxy-ca.crt')]), OrderedDict([(u'keyUsage', u'critical digitalSignature, keyEncipherment')]), OrderedDict([(u'extendedKeyUsage', u'clientAuth')]), OrderedDict([(u'days_valid', 365)])]), (u'ingress_server_policy', [OrderedDict([(u'minions', u'*')]), OrderedDict([(u'signing_private_key', u'/etc/metalk8s/pki/nginx-ingress/ca.key')]), OrderedDict([(u'signing_cert', u'/etc/metalk8s/pki/nginx-ingress/ca.crt')]), OrderedDict([(u'keyUsage', u'critical digitalSignature, keyEncipherment')]), OrderedDict([(u'extendedKeyUsage', u'serverAuth')]), OrderedDict([(u'days_valid', 365)])]), (u'dex_server_policy', [OrderedDict([(u'minions', u'*')]), OrderedDict([(u'signing_private_key', u'/etc/metalk8s/pki/dex/ca.key')]), OrderedDict([(u'signing_cert', u'/etc/metalk8s/pki/dex/ca.crt')]), OrderedDict([(u'keyUsage', u'critical digitalSignature, keyEncipherment')]), OrderedDict([(u'extendedKeyUsage', u'serverAuth')]), OrderedDict([(u'days_valid', 365)])])]))])
[PROFILE ] Time (in seconds) to render '/srv/scality/metalk8s-2.6.0-dev/pillar/metalk8s/roles/ca.sls' using 'yaml' renderer: 0.01176404953
[DEBUG   ] LazyLoaded jinja.render
[DEBUG   ] LazyLoaded yaml.render
[DEBUG   ] LazyLoaded state.sls
[DEBUG   ] LazyLoaded direct_call.execute
[DEBUG   ] LazyLoaded saltutil.is_running
[DEBUG   ] LazyLoaded grains.get
[DEBUG   ] LazyLoaded config.get
[DEBUG   ] key: test, ret: _|-
[DEBUG   ] Updating roots fileserver cache
[DEBUG   ] Returning file list from cache: age=2 cache_time=20 /var/cache/salt/minion/file_lists/roots/metalk8s-2.6.0-dev.p
[DEBUG   ] Gathering pillar data for state run
[DEBUG   ] Determining pillar cache
[DEBUG   ] LazyLoaded jinja.render
[DEBUG   ] LazyLoaded yaml.render
[DEBUG   ] compile template: /srv/scality/metalk8s-2.6.0-dev/pillar/top.sls
[DEBUG   ] Jinja search path: [u'/srv/scality/metalk8s-2.6.0-dev/pillar']
[PROFILE ] Time (in seconds) to render '/srv/scality/metalk8s-2.6.0-dev/pillar/top.sls' using 'jinja' renderer: 0.00492286682129
[DEBUG   ] Rendered data from file: /srv/scality/metalk8s-2.6.0-dev/pillar/top.sls:
# The mechanics of this file are very similar to those of `salt/top.sls(.in)`.
# Please refer to the comments in that file for more background.

metalk8s-2.6.0-dev:
  I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev:
    - match: compound
    - metalk8s.roles.minion

  # Specific case for ca as we need signing_policy at the very beginning
  I@metalk8s:ca:minion:10.0.2.15:
    - match: compound
    - metalk8s.roles.ca


  I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:bootstrap:
    - match: compound
    - metalk8s.roles.bootstrap

  I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:etcd:
    - match: compound
    - metalk8s.roles.etcd

  I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:master:
    - match: compound
    - metalk8s.roles.master

  I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:node:
    - match: compound
    - metalk8s.roles.node


[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'metalk8s-2.6.0-dev', OrderedDict([(u'I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev', [OrderedDict([(u'match', u'compound')]), u'metalk8s.roles.minion']), (u'I@metalk8s:ca:minion:10.0.2.15', [OrderedDict([(u'match', u'compound')]), u'metalk8s.roles.ca']), (u'I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:bootstrap', [OrderedDict([(u'match', u'compound')]), u'metalk8s.roles.bootstrap']), (u'I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:etcd', [OrderedDict([(u'match', u'compound')]), u'metalk8s.roles.etcd']), (u'I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:master', [OrderedDict([(u'match', u'compound')]), u'metalk8s.roles.master']), (u'I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:node', [OrderedDict([(u'match', u'compound')]), u'metalk8s.roles.node'])]))])
[PROFILE ] Time (in seconds) to render '/srv/scality/metalk8s-2.6.0-dev/pillar/top.sls' using 'yaml' renderer: 0.00121998786926
[DEBUG   ] LazyLoaded metalk8s.ext_pillar
[DEBUG   ] Loading MetalK8s configuration from /etc/metalk8s/bootstrap.yaml
[DEBUG   ] LazyLoaded pillar_utils.assert_equals
[DEBUG   ] LazyLoaded jinja.render
[DEBUG   ] LazyLoaded yaml.render
[DEBUG   ] LazyLoaded confirm_top.confirm_top
[DEBUG   ] LazyLoaded compound_match.match
[DEBUG   ] compound_match: 10.0.2.15 ? I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev
[DEBUG   ] LazyLoaded pillar_match.match
[DEBUG   ] pillar target: metalk8s:nodes:10.0.2.15:version:2.6.0-dev
[DEBUG   ] Attempting to match '2.6.0-dev' in 'metalk8s:nodes:10.0.2.15:version' using delimiter ':'
[DEBUG   ] Attempting to match 'version:2.6.0-dev' in 'metalk8s:nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:version:2.6.0-dev' in 'metalk8s:nodes' using delimiter ':'
[DEBUG   ] Attempting to match 'nodes:10.0.2.15:version:2.6.0-dev' in 'metalk8s' using delimiter ':'
[DEBUG   ] Attempting to match '2.6.0-dev' in 'nodes:10.0.2.15:version' using delimiter ':'
[DEBUG   ] Attempting to match 'version:2.6.0-dev' in 'nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:version:2.6.0-dev' in 'nodes' using delimiter ':'
[DEBUG   ] compound_match 10.0.2.15 ? "I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev" => "False"
[DEBUG   ] LazyLoaded compound_match.match
[DEBUG   ] compound_match: 10.0.2.15 ? I@metalk8s:ca:minion:10.0.2.15
[DEBUG   ] LazyLoaded pillar_match.match
[DEBUG   ] pillar target: metalk8s:ca:minion:10.0.2.15
[DEBUG   ] Attempting to match '10.0.2.15' in 'metalk8s:ca:minion' using delimiter ':'
[DEBUG   ] compound_match 10.0.2.15 ? "I@metalk8s:ca:minion:10.0.2.15" => "True"
[DEBUG   ] LazyLoaded compound_match.match
[DEBUG   ] compound_match: 10.0.2.15 ? I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:bootstrap
[DEBUG   ] LazyLoaded pillar_match.match
[DEBUG   ] pillar target: metalk8s:nodes:10.0.2.15:version:2.6.0-dev
[DEBUG   ] Attempting to match '2.6.0-dev' in 'metalk8s:nodes:10.0.2.15:version' using delimiter ':'
[DEBUG   ] Attempting to match 'version:2.6.0-dev' in 'metalk8s:nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:version:2.6.0-dev' in 'metalk8s:nodes' using delimiter ':'
[DEBUG   ] Attempting to match 'nodes:10.0.2.15:version:2.6.0-dev' in 'metalk8s' using delimiter ':'
[DEBUG   ] Attempting to match '2.6.0-dev' in 'nodes:10.0.2.15:version' using delimiter ':'
[DEBUG   ] Attempting to match 'version:2.6.0-dev' in 'nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:version:2.6.0-dev' in 'nodes' using delimiter ':'
[DEBUG   ] pillar target: metalk8s:nodes:10.0.2.15:roles:bootstrap
[DEBUG   ] Attempting to match 'bootstrap' in 'metalk8s:nodes:10.0.2.15:roles' using delimiter ':'
[DEBUG   ] Attempting to match 'roles:bootstrap' in 'metalk8s:nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:roles:bootstrap' in 'metalk8s:nodes' using delimiter ':'
[DEBUG   ] Attempting to match 'nodes:10.0.2.15:roles:bootstrap' in 'metalk8s' using delimiter ':'
[DEBUG   ] Attempting to match 'bootstrap' in 'nodes:10.0.2.15:roles' using delimiter ':'
[DEBUG   ] Attempting to match 'roles:bootstrap' in 'nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:roles:bootstrap' in 'nodes' using delimiter ':'
[DEBUG   ] compound_match 10.0.2.15 ? "I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:bootstrap" => "False and False"
[DEBUG   ] LazyLoaded compound_match.match
[DEBUG   ] compound_match: 10.0.2.15 ? I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:etcd
[DEBUG   ] LazyLoaded pillar_match.match
[DEBUG   ] pillar target: metalk8s:nodes:10.0.2.15:version:2.6.0-dev
[DEBUG   ] Attempting to match '2.6.0-dev' in 'metalk8s:nodes:10.0.2.15:version' using delimiter ':'
[DEBUG   ] Attempting to match 'version:2.6.0-dev' in 'metalk8s:nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:version:2.6.0-dev' in 'metalk8s:nodes' using delimiter ':'
[DEBUG   ] Attempting to match 'nodes:10.0.2.15:version:2.6.0-dev' in 'metalk8s' using delimiter ':'
[DEBUG   ] Attempting to match '2.6.0-dev' in 'nodes:10.0.2.15:version' using delimiter ':'
[DEBUG   ] Attempting to match 'version:2.6.0-dev' in 'nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:version:2.6.0-dev' in 'nodes' using delimiter ':'
[DEBUG   ] pillar target: metalk8s:nodes:10.0.2.15:roles:etcd
[DEBUG   ] Attempting to match 'etcd' in 'metalk8s:nodes:10.0.2.15:roles' using delimiter ':'
[DEBUG   ] Attempting to match 'roles:etcd' in 'metalk8s:nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:roles:etcd' in 'metalk8s:nodes' using delimiter ':'
[DEBUG   ] Attempting to match 'nodes:10.0.2.15:roles:etcd' in 'metalk8s' using delimiter ':'
[DEBUG   ] Attempting to match 'etcd' in 'nodes:10.0.2.15:roles' using delimiter ':'
[DEBUG   ] Attempting to match 'roles:etcd' in 'nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:roles:etcd' in 'nodes' using delimiter ':'
[DEBUG   ] compound_match 10.0.2.15 ? "I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:etcd" => "False and False"
[DEBUG   ] LazyLoaded compound_match.match
[DEBUG   ] compound_match: 10.0.2.15 ? I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:master
[DEBUG   ] LazyLoaded pillar_match.match
[DEBUG   ] pillar target: metalk8s:nodes:10.0.2.15:version:2.6.0-dev
[DEBUG   ] Attempting to match '2.6.0-dev' in 'metalk8s:nodes:10.0.2.15:version' using delimiter ':'
[DEBUG   ] Attempting to match 'version:2.6.0-dev' in 'metalk8s:nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:version:2.6.0-dev' in 'metalk8s:nodes' using delimiter ':'
[DEBUG   ] Attempting to match 'nodes:10.0.2.15:version:2.6.0-dev' in 'metalk8s' using delimiter ':'
[DEBUG   ] Attempting to match '2.6.0-dev' in 'nodes:10.0.2.15:version' using delimiter ':'
[DEBUG   ] Attempting to match 'version:2.6.0-dev' in 'nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:version:2.6.0-dev' in 'nodes' using delimiter ':'
[DEBUG   ] pillar target: metalk8s:nodes:10.0.2.15:roles:master
[DEBUG   ] Attempting to match 'master' in 'metalk8s:nodes:10.0.2.15:roles' using delimiter ':'
[DEBUG   ] Attempting to match 'roles:master' in 'metalk8s:nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:roles:master' in 'metalk8s:nodes' using delimiter ':'
[DEBUG   ] Attempting to match 'nodes:10.0.2.15:roles:master' in 'metalk8s' using delimiter ':'
[DEBUG   ] Attempting to match 'master' in 'nodes:10.0.2.15:roles' using delimiter ':'
[DEBUG   ] Attempting to match 'roles:master' in 'nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:roles:master' in 'nodes' using delimiter ':'
[DEBUG   ] compound_match 10.0.2.15 ? "I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:master" => "False and False"
[DEBUG   ] LazyLoaded compound_match.match
[DEBUG   ] compound_match: 10.0.2.15 ? I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:node
[DEBUG   ] LazyLoaded pillar_match.match
[DEBUG   ] pillar target: metalk8s:nodes:10.0.2.15:version:2.6.0-dev
[DEBUG   ] Attempting to match '2.6.0-dev' in 'metalk8s:nodes:10.0.2.15:version' using delimiter ':'
[DEBUG   ] Attempting to match 'version:2.6.0-dev' in 'metalk8s:nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:version:2.6.0-dev' in 'metalk8s:nodes' using delimiter ':'
[DEBUG   ] Attempting to match 'nodes:10.0.2.15:version:2.6.0-dev' in 'metalk8s' using delimiter ':'
[DEBUG   ] Attempting to match '2.6.0-dev' in 'nodes:10.0.2.15:version' using delimiter ':'
[DEBUG   ] Attempting to match 'version:2.6.0-dev' in 'nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:version:2.6.0-dev' in 'nodes' using delimiter ':'
[DEBUG   ] pillar target: metalk8s:nodes:10.0.2.15:roles:node
[DEBUG   ] Attempting to match 'node' in 'metalk8s:nodes:10.0.2.15:roles' using delimiter ':'
[DEBUG   ] Attempting to match 'roles:node' in 'metalk8s:nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:roles:node' in 'metalk8s:nodes' using delimiter ':'
[DEBUG   ] Attempting to match 'nodes:10.0.2.15:roles:node' in 'metalk8s' using delimiter ':'
[DEBUG   ] Attempting to match 'node' in 'nodes:10.0.2.15:roles' using delimiter ':'
[DEBUG   ] Attempting to match 'roles:node' in 'nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:roles:node' in 'nodes' using delimiter ':'
[DEBUG   ] compound_match 10.0.2.15 ? "I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:node" => "False and False"
[DEBUG   ] compile template: /srv/scality/metalk8s-2.6.0-dev/pillar/metalk8s/roles/ca.sls
[DEBUG   ] Jinja search path: [u'/srv/scality/metalk8s-2.6.0-dev/pillar']
[PROFILE ] Time (in seconds) to render '/srv/scality/metalk8s-2.6.0-dev/pillar/metalk8s/roles/ca.sls' using 'jinja' renderer: 0.00233602523804
[DEBUG   ] Rendered data from file: /srv/scality/metalk8s-2.6.0-dev/pillar/metalk8s/roles/ca.sls:
mine_functions:
  kubernetes_root_ca_b64:
    - mine_function: hashutil.base64_encodefile
    - /etc/kubernetes/pki/ca.crt

  kubernetes_etcd_ca_b64:
    - mine_function: hashutil.base64_encodefile
    - /etc/kubernetes/pki/etcd/ca.crt

  kubernetes_front_proxy_ca_b64:
    - mine_function: hashutil.base64_encodefile
    - /etc/kubernetes/pki/front-proxy-ca.crt

  kubernetes_sa_pub_key_b64:
    - mine_function: hashutil.base64_encodefile
    - /etc/kubernetes/pki/sa.pub

  dex_ca_b64:
    - mine_function: hashutil.base64_encodefile
    - /etc/metalk8s/pki/dex/ca.crt

  ingress_ca_b64:
    - mine_function: hashutil.base64_encodefile
    - /etc/metalk8s/pki/nginx-ingress/ca.crt

x509_signing_policies:
  kube_apiserver_client_policy:
    - minions: '*'
    - signing_private_key: /etc/kubernetes/pki/ca.key
    - signing_cert: /etc/kubernetes/pki/ca.crt
    - keyUsage: critical digitalSignature, keyEncipherment
    - extendedKeyUsage: clientAuth
    - days_valid: 365
  kube_apiserver_server_policy:
    - minions: '*'
    - signing_private_key: /etc/kubernetes/pki/ca.key
    - signing_cert: /etc/kubernetes/pki/ca.crt
    - keyUsage: critical digitalSignature, keyEncipherment
    - extendedKeyUsage: serverAuth
    - days_valid: 365
  etcd_client_policy:
    - minions: '*'
    - signing_private_key: /etc/kubernetes/pki/etcd/ca.key
    - signing_cert: /etc/kubernetes/pki/etcd/ca.crt
    - keyUsage: critical digitalSignature, keyEncipherment
    - extendedKeyUsage: clientAuth
    - days_valid: 365
  etcd_server_client_policy:
    - minions: '*'
    - signing_private_key: /etc/kubernetes/pki/etcd/ca.key
    - signing_cert: /etc/kubernetes/pki/etcd/ca.crt
    - keyUsage: critical digitalSignature, keyEncipherment
    - extendedKeyUsage: serverAuth, clientAuth
    - days_valid: 365
  front_proxy_client_policy:
    - minions: '*'
    - signing_private_key: /etc/kubernetes/pki/front-proxy-ca.key
    - signing_cert: /etc/kubernetes/pki/front-proxy-ca.crt
    - keyUsage: critical digitalSignature, keyEncipherment
    - extendedKeyUsage: clientAuth
    - days_valid: 365
  ingress_server_policy:
    - minions: '*'
    - signing_private_key: /etc/metalk8s/pki/nginx-ingress/ca.key
    - signing_cert: /etc/metalk8s/pki/nginx-ingress/ca.crt
    - keyUsage: critical digitalSignature, keyEncipherment
    - extendedKeyUsage: serverAuth
    - days_valid: 365
  dex_server_policy:
    - minions: '*'
    - signing_private_key: /etc/metalk8s/pki/dex/ca.key
    - signing_cert: /etc/metalk8s/pki/dex/ca.crt
    - keyUsage: critical digitalSignature, keyEncipherment
    - extendedKeyUsage: serverAuth
    - days_valid: 365

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'mine_functions', OrderedDict([(u'kubernetes_root_ca_b64', [OrderedDict([(u'mine_function', u'hashutil.base64_encodefile')]), u'/etc/kubernetes/pki/ca.crt']), (u'kubernetes_etcd_ca_b64', [OrderedDict([(u'mine_function', u'hashutil.base64_encodefile')]), u'/etc/kubernetes/pki/etcd/ca.crt']), (u'kubernetes_front_proxy_ca_b64', [OrderedDict([(u'mine_function', u'hashutil.base64_encodefile')]), u'/etc/kubernetes/pki/front-proxy-ca.crt']), (u'kubernetes_sa_pub_key_b64', [OrderedDict([(u'mine_function', u'hashutil.base64_encodefile')]), u'/etc/kubernetes/pki/sa.pub']), (u'dex_ca_b64', [OrderedDict([(u'mine_function', u'hashutil.base64_encodefile')]), u'/etc/metalk8s/pki/dex/ca.crt']), (u'ingress_ca_b64', [OrderedDict([(u'mine_function', u'hashutil.base64_encodefile')]), u'/etc/metalk8s/pki/nginx-ingress/ca.crt'])])), (u'x509_signing_policies', OrderedDict([(u'kube_apiserver_client_policy', [OrderedDict([(u'minions', u'*')]), OrderedDict([(u'signing_private_key', u'/etc/kubernetes/pki/ca.key')]), OrderedDict([(u'signing_cert', u'/etc/kubernetes/pki/ca.crt')]), OrderedDict([(u'keyUsage', u'critical digitalSignature, keyEncipherment')]), OrderedDict([(u'extendedKeyUsage', u'clientAuth')]), OrderedDict([(u'days_valid', 365)])]), (u'kube_apiserver_server_policy', [OrderedDict([(u'minions', u'*')]), OrderedDict([(u'signing_private_key', u'/etc/kubernetes/pki/ca.key')]), OrderedDict([(u'signing_cert', u'/etc/kubernetes/pki/ca.crt')]), OrderedDict([(u'keyUsage', u'critical digitalSignature, keyEncipherment')]), OrderedDict([(u'extendedKeyUsage', u'serverAuth')]), OrderedDict([(u'days_valid', 365)])]), (u'etcd_client_policy', [OrderedDict([(u'minions', u'*')]), OrderedDict([(u'signing_private_key', u'/etc/kubernetes/pki/etcd/ca.key')]), OrderedDict([(u'signing_cert', u'/etc/kubernetes/pki/etcd/ca.crt')]), OrderedDict([(u'keyUsage', u'critical digitalSignature, keyEncipherment')]), OrderedDict([(u'extendedKeyUsage', u'clientAuth')]), OrderedDict([(u'days_valid', 365)])]), (u'etcd_server_client_policy', [OrderedDict([(u'minions', u'*')]), OrderedDict([(u'signing_private_key', u'/etc/kubernetes/pki/etcd/ca.key')]), OrderedDict([(u'signing_cert', u'/etc/kubernetes/pki/etcd/ca.crt')]), OrderedDict([(u'keyUsage', u'critical digitalSignature, keyEncipherment')]), OrderedDict([(u'extendedKeyUsage', u'serverAuth, clientAuth')]), OrderedDict([(u'days_valid', 365)])]), (u'front_proxy_client_policy', [OrderedDict([(u'minions', u'*')]), OrderedDict([(u'signing_private_key', u'/etc/kubernetes/pki/front-proxy-ca.key')]), OrderedDict([(u'signing_cert', u'/etc/kubernetes/pki/front-proxy-ca.crt')]), OrderedDict([(u'keyUsage', u'critical digitalSignature, keyEncipherment')]), OrderedDict([(u'extendedKeyUsage', u'clientAuth')]), OrderedDict([(u'days_valid', 365)])]), (u'ingress_server_policy', [OrderedDict([(u'minions', u'*')]), OrderedDict([(u'signing_private_key', u'/etc/metalk8s/pki/nginx-ingress/ca.key')]), OrderedDict([(u'signing_cert', u'/etc/metalk8s/pki/nginx-ingress/ca.crt')]), OrderedDict([(u'keyUsage', u'critical digitalSignature, keyEncipherment')]), OrderedDict([(u'extendedKeyUsage', u'serverAuth')]), OrderedDict([(u'days_valid', 365)])]), (u'dex_server_policy', [OrderedDict([(u'minions', u'*')]), OrderedDict([(u'signing_private_key', u'/etc/metalk8s/pki/dex/ca.key')]), OrderedDict([(u'signing_cert', u'/etc/metalk8s/pki/dex/ca.crt')]), OrderedDict([(u'keyUsage', u'critical digitalSignature, keyEncipherment')]), OrderedDict([(u'extendedKeyUsage', u'serverAuth')]), OrderedDict([(u'days_valid', 365)])])]))])
[PROFILE ] Time (in seconds) to render '/srv/scality/metalk8s-2.6.0-dev/pillar/metalk8s/roles/ca.sls' using 'yaml' renderer: 0.00472211837769
[DEBUG   ] Finished gathering pillar data for state run
[INFO    ] Loading fresh modules for state activity
[DEBUG   ] LazyLoaded jinja.render
[DEBUG   ] LazyLoaded yaml.render
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/roles/internal/early-stage-bootstrap.sls' to resolve 'salt://metalk8s/roles/internal/early-stage-bootstrap.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/roles/internal/early-stage-bootstrap.sls' to resolve 'salt://metalk8s/roles/internal/early-stage-bootstrap.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/roles/internal/early-stage-bootstrap.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/roles/internal/early-stage-bootstrap.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/roles/internal/early-stage-bootstrap.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/roles/internal/early-stage-bootstrap.sls' using 'jinja' renderer: 0.0224039554596
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/roles/internal/early-stage-bootstrap.sls:
include:
  - metalk8s.kubernetes.ca.kubernetes.installed
  - metalk8s.roles.bootstrap.local
  - metalk8s.roles.minion

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'include', [u'metalk8s.kubernetes.ca.kubernetes.installed', u'metalk8s.roles.bootstrap.local', u'metalk8s.roles.minion'])])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/roles/internal/early-stage-bootstrap.sls' using 'yaml' renderer: 0.000895977020264
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/kubernetes/ca/kubernetes/installed.sls' to resolve 'salt://metalk8s/kubernetes/ca/kubernetes/installed.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubernetes/ca/kubernetes/installed.sls' to resolve 'salt://metalk8s/kubernetes/ca/kubernetes/installed.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/kubernetes/ca/kubernetes/installed.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/kubernetes/ca/kubernetes/installed.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubernetes/ca/kubernetes/installed.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[DEBUG   ] LazyLoaded grains.filter_by
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubernetes/ca/kubernetes/installed.sls' using 'jinja' renderer: 0.0845069885254
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubernetes/ca/kubernetes/installed.sls:


include:
  - metalk8s.internal.m2crypto

Create CA private key:
  x509.private_key_managed:
    - name: /etc/kubernetes/pki/ca.key
    - bits: 4096
    - verbose: False
    - user: root
    - group: root
    - mode: 600
    - makedirs: True
    - dir_mode: 755
    - require:
      - metalk8s_package_manager: Install m2crypto
    - unless:
      - test -f "/etc/kubernetes/pki/ca.key"

Generate CA certificate:
  x509.certificate_managed:
    - name: /etc/kubernetes/pki/ca.crt
    - signing_private_key: /etc/kubernetes/pki/ca.key
    - CN: kubernetes
    - keyUsage: "critical digitalSignature, keyEncipherment, keyCertSign"
    - basicConstraints: "critical CA:true"
    - days_valid: 3650
    - user: root
    - group: root
    - mode: 644
    - makedirs: True
    - dir_mode: 755
    - require:
      - x509: Create CA private key

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'include', [u'metalk8s.internal.m2crypto']), (u'Create CA private key', OrderedDict([(u'x509.private_key_managed', [OrderedDict([(u'name', u'/etc/kubernetes/pki/ca.key')]), OrderedDict([(u'bits', 4096)]), OrderedDict([(u'verbose', False)]), OrderedDict([(u'user', u'root')]), OrderedDict([(u'group', u'root')]), OrderedDict([(u'mode', 600)]), OrderedDict([(u'makedirs', True)]), OrderedDict([(u'dir_mode', 755)]), OrderedDict([(u'require', [OrderedDict([(u'metalk8s_package_manager', u'Install m2crypto')])])]), OrderedDict([(u'unless', [u'test -f "/etc/kubernetes/pki/ca.key"'])])])])), (u'Generate CA certificate', OrderedDict([(u'x509.certificate_managed', [OrderedDict([(u'name', u'/etc/kubernetes/pki/ca.crt')]), OrderedDict([(u'signing_private_key', u'/etc/kubernetes/pki/ca.key')]), OrderedDict([(u'CN', u'kubernetes')]), OrderedDict([(u'keyUsage', u'critical digitalSignature, keyEncipherment, keyCertSign')]), OrderedDict([(u'basicConstraints', u'critical CA:true')]), OrderedDict([(u'days_valid', 3650)]), OrderedDict([(u'user', u'root')]), OrderedDict([(u'group', u'root')]), OrderedDict([(u'mode', 644)]), OrderedDict([(u'makedirs', True)]), OrderedDict([(u'dir_mode', 755)]), OrderedDict([(u'require', [OrderedDict([(u'x509', u'Create CA private key')])])])])]))])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubernetes/ca/kubernetes/installed.sls' using 'yaml' renderer: 0.00204992294312
[DEBUG   ] Could not find file 'salt://metalk8s/internal/m2crypto.sls' in saltenv 'metalk8s-2.6.0-dev'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/internal/m2crypto/init.sls' to resolve 'salt://metalk8s/internal/m2crypto/init.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/internal/m2crypto/init.sls' to resolve 'salt://metalk8s/internal/m2crypto/init.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/internal/m2crypto/init.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/internal/m2crypto/init.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/internal/m2crypto/init.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/internal/m2crypto/init.sls' using 'jinja' renderer: 0.000852823257446
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/internal/m2crypto/init.sls:
#
# Install m2crypto to manage x509 certs
#
# Available states
# ================
#
# * installed   -> Install m2crypto
# * absent      -> Uninstall m2crypto
#
include:
  - .installed

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'include', [u'.installed'])])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/internal/m2crypto/init.sls' using 'yaml' renderer: 0.000478029251099
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/internal/m2crypto/installed.sls' to resolve 'salt://metalk8s/internal/m2crypto/installed.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/internal/m2crypto/installed.sls' to resolve 'salt://metalk8s/internal/m2crypto/installed.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/internal/m2crypto/installed.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/internal/m2crypto/installed.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/internal/m2crypto/installed.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/macro.sls' to resolve 'salt://metalk8s/macro.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/macro.sls' to resolve 'salt://metalk8s/macro.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/macro.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/macro.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/internal/m2crypto/installed.sls' using 'jinja' renderer: 0.07408618927
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/internal/m2crypto/installed.sls:


include:
  - metalk8s.repo

Install m2crypto:
  
  metalk8s_package_manager.installed:
    - name: m2crypto
    - pkgs_info: {"kubectl": {"version": "1.17.9"}, "xfsprogs": {"version": null}, "httpd-tools": {"version": null}, "iproute": {"version": null}, "sos": {"version": null}, "yum-plugin-versionlock": {"version": null}, "socat": {"version": null}, "containerd": {"version": "1.2.13-2.el7"}, "coreutils": {"version": null}, "container-selinux": {"version": null}, "iptables": {"version": null}, "ebtables": {"version": null}, "salt-minion": {"version": "3000.3"}, "calico-cni-plugin": {"version": "3.12.0-1.el7"}, "yum-utils": {"version": null}, "kubelet": {"version": "1.17.9"}, "m2crypto": {"version": null}, "genisoimage": {"version": null}, "util-linux": {"version": null}, "metalk8s-sosreport": {"version": "2.6-1.el7"}, "cri-tools": {"version": null}, "ethtool": {"version": null}, "e2fsprogs": {"version": null}, "runc": {"version": null}, "kubernetes-cni": {"version": null}}
    - reload_modules: True
    - require:
      - test: Repositories configured

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'include', [u'metalk8s.repo']), (u'Install m2crypto', OrderedDict([(u'metalk8s_package_manager.installed', [OrderedDict([(u'name', u'm2crypto')]), OrderedDict([(u'pkgs_info', OrderedDict([(u'kubectl', OrderedDict([(u'version', u'1.17.9')])), (u'xfsprogs', OrderedDict([(u'version', None)])), (u'httpd-tools', OrderedDict([(u'version', None)])), (u'iproute', OrderedDict([(u'version', None)])), (u'sos', OrderedDict([(u'version', None)])), (u'yum-plugin-versionlock', OrderedDict([(u'version', None)])), (u'socat', OrderedDict([(u'version', None)])), (u'containerd', OrderedDict([(u'version', u'1.2.13-2.el7')])), (u'coreutils', OrderedDict([(u'version', None)])), (u'container-selinux', OrderedDict([(u'version', None)])), (u'iptables', OrderedDict([(u'version', None)])), (u'ebtables', OrderedDict([(u'version', None)])), (u'salt-minion', OrderedDict([(u'version', u'3000.3')])), (u'calico-cni-plugin', OrderedDict([(u'version', u'3.12.0-1.el7')])), (u'yum-utils', OrderedDict([(u'version', None)])), (u'kubelet', OrderedDict([(u'version', u'1.17.9')])), (u'm2crypto', OrderedDict([(u'version', None)])), (u'genisoimage', OrderedDict([(u'version', None)])), (u'util-linux', OrderedDict([(u'version', None)])), (u'metalk8s-sosreport', OrderedDict([(u'version', u'2.6-1.el7')])), (u'cri-tools', OrderedDict([(u'version', None)])), (u'ethtool', OrderedDict([(u'version', None)])), (u'e2fsprogs', OrderedDict([(u'version', None)])), (u'runc', OrderedDict([(u'version', None)])), (u'kubernetes-cni', OrderedDict([(u'version', None)]))]))]), OrderedDict([(u'reload_modules', True)]), OrderedDict([(u'require', [OrderedDict([(u'test', u'Repositories configured')])])])])]))])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/internal/m2crypto/installed.sls' using 'yaml' renderer: 0.00337600708008
[DEBUG   ] Could not find file 'salt://metalk8s/repo.sls' in saltenv 'metalk8s-2.6.0-dev'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/repo/init.sls' to resolve 'salt://metalk8s/repo/init.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/repo/init.sls' to resolve 'salt://metalk8s/repo/init.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/repo/init.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/repo/init.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/repo/init.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/repo/init.sls' using 'jinja' renderer: 0.00188493728638
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/repo/init.sls:
include:
  - .redhat

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'include', [u'.redhat'])])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/repo/init.sls' using 'yaml' renderer: 0.000715970993042
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/repo/redhat.sls' to resolve 'salt://metalk8s/repo/redhat.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/repo/redhat.sls' to resolve 'salt://metalk8s/repo/redhat.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/repo/redhat.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[WARNING ] Skip, invalid archive path /metalk8s.iso, should be an iso or a directory.
[ERROR   ] Rendering exception occurred
Traceback (most recent call last):
  File "/usr/lib/python2.7/site-packages/salt/utils/templates.py", line 169, in render_tmpl
    output = render_str(tmplstr, context, tmplpath)
  File "/usr/lib/python2.7/site-packages/salt/utils/templates.py", line 404, in render_jinja_tmpl
    buf=tmplstr)
SaltRenderError: Jinja variable 'dict object' has no attribute u'metalk8s-2.6.0-dev'
[CRITICAL] Rendering SLS 'metalk8s-2.6.0-dev:metalk8s.repo.redhat' failed: Jinja variable 'dict object' has no attribute u'metalk8s-2.6.0-dev'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/roles/bootstrap/local.sls' to resolve 'salt://metalk8s/roles/bootstrap/local.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/roles/bootstrap/local.sls' to resolve 'salt://metalk8s/roles/bootstrap/local.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/roles/bootstrap/local.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/roles/bootstrap/local.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/roles/bootstrap/local.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/roles/bootstrap/local.sls' using 'jinja' renderer: 0.000948905944824
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/roles/bootstrap/local.sls:
include:
  - metalk8s.archives.mounted
  - metalk8s.kubernetes.kubelet.standalone
  - metalk8s.internal.preflight
  - metalk8s.repo.installed
  - metalk8s.salt.master.certs.salt-api
  - metalk8s.salt.master.configured
  - metalk8s.salt.master.installed
  - metalk8s.kubectl

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'include', [u'metalk8s.archives.mounted', u'metalk8s.kubernetes.kubelet.standalone', u'metalk8s.internal.preflight', u'metalk8s.repo.installed', u'metalk8s.salt.master.certs.salt-api', u'metalk8s.salt.master.configured', u'metalk8s.salt.master.installed', u'metalk8s.kubectl'])])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/roles/bootstrap/local.sls' using 'yaml' renderer: 0.000586986541748
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/archives/mounted.sls' to resolve 'salt://metalk8s/archives/mounted.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/archives/mounted.sls' to resolve 'salt://metalk8s/archives/mounted.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/archives/mounted.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/archives/mounted.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/archives/mounted.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[WARNING ] Skip, invalid archive path /metalk8s.iso, should be an iso or a directory.
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/archives/mounted.sls' using 'jinja' renderer: 0.00701093673706
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/archives/mounted.sls:
include:
  - metalk8s.salt.minion.local

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'include', [u'metalk8s.salt.minion.local'])])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/archives/mounted.sls' using 'yaml' renderer: 0.00088906288147
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/salt/minion/local.sls' to resolve 'salt://metalk8s/salt/minion/local.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/minion/local.sls' to resolve 'salt://metalk8s/salt/minion/local.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/salt/minion/local.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/salt/minion/local.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/minion/local.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[WARNING ] Skip, invalid archive path /metalk8s.iso, should be an iso or a directory.
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/minion/local.sls' using 'jinja' renderer: 0.0586450099945
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/minion/local.sls:


Configure salt minion for local mode:
  file.serialize:
    - name: /etc/salt/minion.d/99-metalk8s-local.conf
    - user: root
    - group: root
    - mode: '0644'
    - formatter: yaml
    - makedirs: true
    - backup: false
    - dataset:
        log_level_logfile: info
        file_roots:
        pillar_roots:
        use_superseded:
          - module.run
        ext_pillar_first: true
        ext_pillar:
          - metalk8s: /etc/metalk8s/bootstrap.yaml
        retry_dns_count: 3

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'Configure salt minion for local mode', OrderedDict([(u'file.serialize', [OrderedDict([(u'name', u'/etc/salt/minion.d/99-metalk8s-local.conf')]), OrderedDict([(u'user', u'root')]), OrderedDict([(u'group', u'root')]), OrderedDict([(u'mode', u'0644')]), OrderedDict([(u'formatter', u'yaml')]), OrderedDict([(u'makedirs', True)]), OrderedDict([(u'backup', False)]), OrderedDict([(u'dataset', OrderedDict([(u'log_level_logfile', u'info'), (u'file_roots', None), (u'pillar_roots', None), (u'use_superseded', [u'module.run']), (u'ext_pillar_first', True), (u'ext_pillar', [OrderedDict([(u'metalk8s', u'/etc/metalk8s/bootstrap.yaml')])]), (u'retry_dns_count', 3)]))])])]))])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/minion/local.sls' using 'yaml' renderer: 0.00200700759888
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/kubernetes/kubelet/standalone.sls' to resolve 'salt://metalk8s/kubernetes/kubelet/standalone.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubernetes/kubelet/standalone.sls' to resolve 'salt://metalk8s/kubernetes/kubelet/standalone.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/kubernetes/kubelet/standalone.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/kubernetes/kubelet/standalone.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubernetes/kubelet/standalone.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubernetes/kubelet/standalone.sls' using 'jinja' renderer: 0.0662860870361
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubernetes/kubelet/standalone.sls:


include:
  - .running

Create kubelet service environment file:
  file.managed:
    - name: "/var/lib/kubelet/kubeadm-flags.env"
    - source: salt://metalk8s/kubernetes/kubelet/files/kubeadm.env
    - template: jinja
    - user: root
    - group: root
    - mode: 644
    - makedirs: True
    - dir_mode: 750
    - context:
    - context:
        options:
          container-runtime-endpoint: unix:///run/containerd/containerd.sock
          container-runtime: remote
          resolv-conf: /etc/resolv.conf
          node-ip: 10.0.3.15
          hostname-override: 10.0.2.15
          v: 0
    - require:
      - metalk8s_package_manager: Install kubelet
    - watch_in:
      - service: Ensure kubelet running

Create kubelet config file:
  file.serialize:
    - name: "/var/lib/kubelet/config.yaml"
    - user: root
    - group: root
    - mode: 644
    - makedirs: True
    - dir_mode: 750
    - formatter: yaml
    - dataset:
        address: 10.0.3.15
        kind: KubeletConfiguration
        apiVersion: kubelet.config.k8s.io/v1beta1
        staticPodPath: /etc/kubernetes/manifests
        authentication:
          anonymous:
            enabled: false
          webhook:
            cacheTTL: 2m0s
            enabled: true
          x509:
            clientCAFile: /etc/kubernetes/pki/ca.crt
        authorization:
          mode: Webhook
          webhook:
            cacheAuthorizedTTL: 5m0s
            cacheUnauthorizedTTL: 30s
        cgroupDriver: cgroupfs
        cgroupsPerQOS: true
        clusterDNS:
          - 192.168.128.10
        clusterDomain: cluster.local
        configMapAndSecretChangeDetectionStrategy: Watch
        containerLogMaxFiles: 5
        containerLogMaxSize: 10Mi
        contentType: application/vnd.kubernetes.protobuf
        cpuCFSQuota: true
        cpuCFSQuotaPeriod: 100ms
        cpuManagerPolicy: none
        cpuManagerReconcilePeriod: 10s
        enableControllerAttachDetach: true
        enableDebuggingHandlers: true
        enforceNodeAllocatable:
          - pods
        eventBurst: 10
        eventRecordQPS: 5
        evictionHard:
          imagefs.available: 15%
          memory.available: 100Mi
          nodefs.available: 10%
          nodefs.inodesFree: 5%
        evictionPressureTransitionPeriod: 5m0s
        failSwapOn: true
        fileCheckFrequency: 20s
        hairpinMode: promiscuous-bridge
        healthzBindAddress: 127.0.0.1
        healthzPort: 10248
        httpCheckFrequency: 20s
        imageGCHighThresholdPercent: 85
        imageGCLowThresholdPercent: 80
        imageMinimumGCAge: 2m0s
        iptablesDropBit: 15
        iptablesMasqueradeBit: 14
        kubeAPIBurst: 10
        kubeAPIQPS: 5
        makeIPTablesUtilChains: true
        maxOpenFiles: 1000000
        maxPods: 110
        nodeLeaseDurationSeconds: 40
        nodeStatusReportFrequency: 1m0s
        nodeStatusUpdateFrequency: 10s
        oomScoreAdj: -999
        podPidsLimit: -1
        port: 10250
        registryBurst: 10
        registryPullQPS: 5
        resolvConf: /etc/resolv.conf
        rotateCertificates: true
        runtimeRequestTimeout: 2m0s
        serializeImagePulls: true
        streamingConnectionIdleTimeout: 4h0m0s
        syncFrequency: 1m0s
        volumeStatsAggPeriod: 1m0s
    - require:
      - metalk8s_package_manager: Install kubelet
    - watch_in:
      - service: Ensure kubelet running

Configure kubelet service as standalone:
  file.managed:
    - name: /etc/systemd/system/kubelet.service.d/09-standalone.conf
    - source: salt://metalk8s/kubernetes/kubelet/files/service-standalone-systemd.conf
    - template: jinja
    - user: root
    - group: root
    - mode: 644
    - makedirs: True
    - dir_mode: 755
    - context:
        env_file: "/var/lib/kubelet/kubeadm-flags.env"
        manifest_path: "/etc/kubernetes/manifests"
    - require:
      - file: Create kubelet service environment file
      - file: Create kubelet config file
    - watch_in:
      - service: Ensure kubelet running

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'include', [u'.running']), (u'Create kubelet service environment file', OrderedDict([(u'file.managed', [OrderedDict([(u'name', u'/var/lib/kubelet/kubeadm-flags.env')]), OrderedDict([(u'source', u'salt://metalk8s/kubernetes/kubelet/files/kubeadm.env')]), OrderedDict([(u'template', u'jinja')]), OrderedDict([(u'user', u'root')]), OrderedDict([(u'group', u'root')]), OrderedDict([(u'mode', 644)]), OrderedDict([(u'makedirs', True)]), OrderedDict([(u'dir_mode', 750)]), OrderedDict([(u'context', None)]), OrderedDict([(u'context', OrderedDict([(u'options', OrderedDict([(u'container-runtime-endpoint', u'unix:///run/containerd/containerd.sock'), (u'container-runtime', u'remote'), (u'resolv-conf', u'/etc/resolv.conf'), (u'node-ip', u'10.0.3.15'), (u'hostname-override', u'10.0.2.15'), (u'v', 0)]))]))]), OrderedDict([(u'require', [OrderedDict([(u'metalk8s_package_manager', u'Install kubelet')])])]), OrderedDict([(u'watch_in', [OrderedDict([(u'service', u'Ensure kubelet running')])])])])])), (u'Create kubelet config file', OrderedDict([(u'file.serialize', [OrderedDict([(u'name', u'/var/lib/kubelet/config.yaml')]), OrderedDict([(u'user', u'root')]), OrderedDict([(u'group', u'root')]), OrderedDict([(u'mode', 644)]), OrderedDict([(u'makedirs', True)]), OrderedDict([(u'dir_mode', 750)]), OrderedDict([(u'formatter', u'yaml')]), OrderedDict([(u'dataset', OrderedDict([(u'address', u'10.0.3.15'), (u'kind', u'KubeletConfiguration'), (u'apiVersion', u'kubelet.config.k8s.io/v1beta1'), (u'staticPodPath', u'/etc/kubernetes/manifests'), (u'authentication', OrderedDict([(u'anonymous', OrderedDict([(u'enabled', False)])), (u'webhook', OrderedDict([(u'cacheTTL', u'2m0s'), (u'enabled', True)])), (u'x509', OrderedDict([(u'clientCAFile', u'/etc/kubernetes/pki/ca.crt')]))])), (u'authorization', OrderedDict([(u'mode', u'Webhook'), (u'webhook', OrderedDict([(u'cacheAuthorizedTTL', u'5m0s'), (u'cacheUnauthorizedTTL', u'30s')]))])), (u'cgroupDriver', u'cgroupfs'), (u'cgroupsPerQOS', True), (u'clusterDNS', [u'192.168.128.10']), (u'clusterDomain', u'cluster.local'), (u'configMapAndSecretChangeDetectionStrategy', u'Watch'), (u'containerLogMaxFiles', 5), (u'containerLogMaxSize', u'10Mi'), (u'contentType', u'application/vnd.kubernetes.protobuf'), (u'cpuCFSQuota', True), (u'cpuCFSQuotaPeriod', u'100ms'), (u'cpuManagerPolicy', u'none'), (u'cpuManagerReconcilePeriod', u'10s'), (u'enableControllerAttachDetach', True), (u'enableDebuggingHandlers', True), (u'enforceNodeAllocatable', [u'pods']), (u'eventBurst', 10), (u'eventRecordQPS', 5), (u'evictionHard', OrderedDict([(u'imagefs.available', u'15%'), (u'memory.available', u'100Mi'), (u'nodefs.available', u'10%'), (u'nodefs.inodesFree', u'5%')])), (u'evictionPressureTransitionPeriod', u'5m0s'), (u'failSwapOn', True), (u'fileCheckFrequency', u'20s'), (u'hairpinMode', u'promiscuous-bridge'), (u'healthzBindAddress', u'127.0.0.1'), (u'healthzPort', 10248), (u'httpCheckFrequency', u'20s'), (u'imageGCHighThresholdPercent', 85), (u'imageGCLowThresholdPercent', 80), (u'imageMinimumGCAge', u'2m0s'), (u'iptablesDropBit', 15), (u'iptablesMasqueradeBit', 14), (u'kubeAPIBurst', 10), (u'kubeAPIQPS', 5), (u'makeIPTablesUtilChains', True), (u'maxOpenFiles', 1000000), (u'maxPods', 110), (u'nodeLeaseDurationSeconds', 40), (u'nodeStatusReportFrequency', u'1m0s'), (u'nodeStatusUpdateFrequency', u'10s'), (u'oomScoreAdj', -999), (u'podPidsLimit', -1), (u'port', 10250), (u'registryBurst', 10), (u'registryPullQPS', 5), (u'resolvConf', u'/etc/resolv.conf'), (u'rotateCertificates', True), (u'runtimeRequestTimeout', u'2m0s'), (u'serializeImagePulls', True), (u'streamingConnectionIdleTimeout', u'4h0m0s'), (u'syncFrequency', u'1m0s'), (u'volumeStatsAggPeriod', u'1m0s')]))]), OrderedDict([(u'require', [OrderedDict([(u'metalk8s_package_manager', u'Install kubelet')])])]), OrderedDict([(u'watch_in', [OrderedDict([(u'service', u'Ensure kubelet running')])])])])])), (u'Configure kubelet service as standalone', OrderedDict([(u'file.managed', [OrderedDict([(u'name', u'/etc/systemd/system/kubelet.service.d/09-standalone.conf')]), OrderedDict([(u'source', u'salt://metalk8s/kubernetes/kubelet/files/service-standalone-systemd.conf')]), OrderedDict([(u'template', u'jinja')]), OrderedDict([(u'user', u'root')]), OrderedDict([(u'group', u'root')]), OrderedDict([(u'mode', 644)]), OrderedDict([(u'makedirs', True)]), OrderedDict([(u'dir_mode', 755)]), OrderedDict([(u'context', OrderedDict([(u'env_file', u'/var/lib/kubelet/kubeadm-flags.env'), (u'manifest_path', u'/etc/kubernetes/manifests')]))]), OrderedDict([(u'require', [OrderedDict([(u'file', u'Create kubelet service environment file')]), OrderedDict([(u'file', u'Create kubelet config file')])])]), OrderedDict([(u'watch_in', [OrderedDict([(u'service', u'Ensure kubelet running')])])])])]))])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubernetes/kubelet/standalone.sls' using 'yaml' renderer: 0.00624108314514
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/kubernetes/kubelet/running.sls' to resolve 'salt://metalk8s/kubernetes/kubelet/running.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubernetes/kubelet/running.sls' to resolve 'salt://metalk8s/kubernetes/kubelet/running.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/kubernetes/kubelet/running.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/kubernetes/kubelet/running.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubernetes/kubelet/running.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubernetes/kubelet/running.sls' using 'jinja' renderer: 0.000871896743774
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubernetes/kubelet/running.sls:
include:
  - .installed

Ensure kubelet running:
  service.running:
    - name: kubelet
    - enable: True
    - watch:
      - metalk8s_package_manager: Install kubelet
    - require:
      - module: Reload systemctl

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'include', [u'.installed']), (u'Ensure kubelet running', OrderedDict([(u'service.running', [OrderedDict([(u'name', u'kubelet')]), OrderedDict([(u'enable', True)]), OrderedDict([(u'watch', [OrderedDict([(u'metalk8s_package_manager', u'Install kubelet')])])]), OrderedDict([(u'require', [OrderedDict([(u'module', u'Reload systemctl')])])])])]))])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubernetes/kubelet/running.sls' using 'yaml' renderer: 0.000702142715454
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/kubernetes/kubelet/installed.sls' to resolve 'salt://metalk8s/kubernetes/kubelet/installed.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubernetes/kubelet/installed.sls' to resolve 'salt://metalk8s/kubernetes/kubelet/installed.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/kubernetes/kubelet/installed.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/kubernetes/kubelet/installed.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubernetes/kubelet/installed.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/macro.sls' to resolve 'salt://metalk8s/macro.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/macro.sls' to resolve 'salt://metalk8s/macro.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubernetes/kubelet/installed.sls' using 'jinja' renderer: 0.0728549957275
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubernetes/kubelet/installed.sls:


include:
  - metalk8s.repo
  - metalk8s.container-engine

Install kubelet:
  
  metalk8s_package_manager.installed:
    - name: kubelet
    - pkgs_info: {"kubectl": {"version": "1.17.9"}, "xfsprogs": {"version": null}, "httpd-tools": {"version": null}, "iproute": {"version": null}, "sos": {"version": null}, "yum-plugin-versionlock": {"version": null}, "socat": {"version": null}, "containerd": {"version": "1.2.13-2.el7"}, "coreutils": {"version": null}, "container-selinux": {"version": null}, "iptables": {"version": null}, "ebtables": {"version": null}, "salt-minion": {"version": "3000.3"}, "calico-cni-plugin": {"version": "3.12.0-1.el7"}, "yum-utils": {"version": null}, "kubelet": {"version": "1.17.9"}, "m2crypto": {"version": null}, "genisoimage": {"version": null}, "util-linux": {"version": null}, "metalk8s-sosreport": {"version": "2.6-1.el7"}, "cri-tools": {"version": null}, "ethtool": {"version": null}, "e2fsprogs": {"version": null}, "runc": {"version": null}, "kubernetes-cni": {"version": null}}
    - version: 1.17.9
    - hold: True
    - update_holds: True
    - ignore_epoch: True
    - reload_modules: True
    - require:
      - test: Repositories configured

# When upgrading kubelet on centos7 we have error when trying to restart or get
# status of the kubelet service
# $ systemctl status kubelet
# Failed to get properties: Access denied
# 
# Workaround: Reload systemctl
Reload systemctl:
  module.wait:
    - service.systemctl_reload: []
    - watch:
      - metalk8s_package_manager: Install kubelet

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'include', [u'metalk8s.repo', u'metalk8s.container-engine']), (u'Install kubelet', OrderedDict([(u'metalk8s_package_manager.installed', [OrderedDict([(u'name', u'kubelet')]), OrderedDict([(u'pkgs_info', OrderedDict([(u'kubectl', OrderedDict([(u'version', u'1.17.9')])), (u'xfsprogs', OrderedDict([(u'version', None)])), (u'httpd-tools', OrderedDict([(u'version', None)])), (u'iproute', OrderedDict([(u'version', None)])), (u'sos', OrderedDict([(u'version', None)])), (u'yum-plugin-versionlock', OrderedDict([(u'version', None)])), (u'socat', OrderedDict([(u'version', None)])), (u'containerd', OrderedDict([(u'version', u'1.2.13-2.el7')])), (u'coreutils', OrderedDict([(u'version', None)])), (u'container-selinux', OrderedDict([(u'version', None)])), (u'iptables', OrderedDict([(u'version', None)])), (u'ebtables', OrderedDict([(u'version', None)])), (u'salt-minion', OrderedDict([(u'version', u'3000.3')])), (u'calico-cni-plugin', OrderedDict([(u'version', u'3.12.0-1.el7')])), (u'yum-utils', OrderedDict([(u'version', None)])), (u'kubelet', OrderedDict([(u'version', u'1.17.9')])), (u'm2crypto', OrderedDict([(u'version', None)])), (u'genisoimage', OrderedDict([(u'version', None)])), (u'util-linux', OrderedDict([(u'version', None)])), (u'metalk8s-sosreport', OrderedDict([(u'version', u'2.6-1.el7')])), (u'cri-tools', OrderedDict([(u'version', None)])), (u'ethtool', OrderedDict([(u'version', None)])), (u'e2fsprogs', OrderedDict([(u'version', None)])), (u'runc', OrderedDict([(u'version', None)])), (u'kubernetes-cni', OrderedDict([(u'version', None)]))]))]), OrderedDict([(u'version', u'1.17.9')]), OrderedDict([(u'hold', True)]), OrderedDict([(u'update_holds', True)]), OrderedDict([(u'ignore_epoch', True)]), OrderedDict([(u'reload_modules', True)]), OrderedDict([(u'require', [OrderedDict([(u'test', u'Repositories configured')])])])])])), (u'Reload systemctl', OrderedDict([(u'module.wait', [OrderedDict([(u'service.systemctl_reload', [])]), OrderedDict([(u'watch', [OrderedDict([(u'metalk8s_package_manager', u'Install kubelet')])])])])]))])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubernetes/kubelet/installed.sls' using 'yaml' renderer: 0.00278496742249
[DEBUG   ] Could not find file 'salt://metalk8s/container-engine.sls' in saltenv 'metalk8s-2.6.0-dev'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/container-engine/init.sls' to resolve 'salt://metalk8s/container-engine/init.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/container-engine/init.sls' to resolve 'salt://metalk8s/container-engine/init.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/container-engine/init.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/container-engine/init.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/container-engine/init.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/container-engine/init.sls' using 'jinja' renderer: 0.0495798587799
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/container-engine/init.sls:


include:
  - .containerd

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'include', [u'.containerd'])])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/container-engine/init.sls' using 'yaml' renderer: 0.000372171401978
[DEBUG   ] Could not find file 'salt://metalk8s/container-engine/containerd.sls' in saltenv 'metalk8s-2.6.0-dev'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/container-engine/containerd/init.sls' to resolve 'salt://metalk8s/container-engine/containerd/init.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/container-engine/containerd/init.sls' to resolve 'salt://metalk8s/container-engine/containerd/init.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/container-engine/containerd/init.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/container-engine/containerd/init.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/container-engine/containerd/init.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/container-engine/containerd/init.sls' using 'jinja' renderer: 0.000636100769043
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/container-engine/containerd/init.sls:
include:
  - .configured

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'include', [u'.configured'])])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/container-engine/containerd/init.sls' using 'yaml' renderer: 0.000249147415161
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/container-engine/containerd/configured.sls' to resolve 'salt://metalk8s/container-engine/containerd/configured.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/container-engine/containerd/configured.sls' to resolve 'salt://metalk8s/container-engine/containerd/configured.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/container-engine/containerd/configured.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/container-engine/containerd/configured.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/container-engine/containerd/configured.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/container-engine/containerd/configured.sls' using 'jinja' renderer: 0.0478780269623
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/container-engine/containerd/configured.sls:


include:
  - .installed

Start and enable containerd:
  service.running:
    - name: containerd
    - enable: True
    - init_delay: 2
    - require:
      - metalk8s_package_manager: Install containerd
    - watch:
      - file: Configure registry IP in containerd conf
      - file: Create containerd service drop-in

Inject pause image:
  # The `containerd` states require the `cri` module, which requires `crictl`
  file.managed:
    - name: /tmp/pause-3.1.tar
    - source: salt://metalk8s/container-engine/containerd/files/pause-3.1.tar
    - unless: >-
        ctr -n k8s.io image ls -q | grep k8s.gcr.io/pause | grep 3\\.1
    - require:
      - service: Start and enable containerd
  containerd.image_managed:
    - name: k8s.gcr.io/pause:3.1
    - archive_path: /tmp/pause-3.1.tar
    - require:
      - file: Inject pause image
      - metalk8s_package_manager: Install and configure cri-tools

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'include', [u'.installed']), (u'Start and enable containerd', OrderedDict([(u'service.running', [OrderedDict([(u'name', u'containerd')]), OrderedDict([(u'enable', True)]), OrderedDict([(u'init_delay', 2)]), OrderedDict([(u'require', [OrderedDict([(u'metalk8s_package_manager', u'Install containerd')])])]), OrderedDict([(u'watch', [OrderedDict([(u'file', u'Configure registry IP in containerd conf')]), OrderedDict([(u'file', u'Create containerd service drop-in')])])])])])), (u'Inject pause image', OrderedDict([(u'file.managed', [OrderedDict([(u'name', u'/tmp/pause-3.1.tar')]), OrderedDict([(u'source', u'salt://metalk8s/container-engine/containerd/files/pause-3.1.tar')]), OrderedDict([(u'unless', u'ctr -n k8s.io image ls -q | grep k8s.gcr.io/pause | grep 3\\\\.1')]), OrderedDict([(u'require', [OrderedDict([(u'service', u'Start and enable containerd')])])])]), (u'containerd.image_managed', [OrderedDict([(u'name', u'k8s.gcr.io/pause:3.1')]), OrderedDict([(u'archive_path', u'/tmp/pause-3.1.tar')]), OrderedDict([(u'require', [OrderedDict([(u'file', u'Inject pause image')]), OrderedDict([(u'metalk8s_package_manager', u'Install and configure cri-tools')])])])])]))])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/container-engine/containerd/configured.sls' using 'yaml' renderer: 0.00176119804382
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/container-engine/containerd/installed.sls' to resolve 'salt://metalk8s/container-engine/containerd/installed.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/container-engine/containerd/installed.sls' to resolve 'salt://metalk8s/container-engine/containerd/installed.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/container-engine/containerd/installed.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/container-engine/containerd/installed.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/container-engine/containerd/installed.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/macro.sls' to resolve 'salt://metalk8s/macro.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/macro.sls' to resolve 'salt://metalk8s/macro.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/container-engine/containerd/installed.sls' using 'jinja' renderer: 0.141296863556
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/container-engine/containerd/installed.sls:


include:
  - metalk8s.repo
Install container-selinux:
  
  metalk8s_package_manager.installed:
    - name: container-selinux
    - pkgs_info: {"kubectl": {"version": "1.17.9"}, "xfsprogs": {"version": null}, "httpd-tools": {"version": null}, "iproute": {"version": null}, "sos": {"version": null}, "yum-plugin-versionlock": {"version": null}, "socat": {"version": null}, "containerd": {"version": "1.2.13-2.el7"}, "coreutils": {"version": null}, "container-selinux": {"version": null}, "iptables": {"version": null}, "ebtables": {"version": null}, "salt-minion": {"version": "3000.3"}, "calico-cni-plugin": {"version": "3.12.0-1.el7"}, "yum-utils": {"version": null}, "kubelet": {"version": "1.17.9"}, "m2crypto": {"version": null}, "genisoimage": {"version": null}, "util-linux": {"version": null}, "metalk8s-sosreport": {"version": "2.6-1.el7"}, "cri-tools": {"version": null}, "ethtool": {"version": null}, "e2fsprogs": {"version": null}, "runc": {"version": null}, "kubernetes-cni": {"version": null}}
    - reload_modules: True
    - require:
      - test: Repositories configured

Install runc:
  
  metalk8s_package_manager.installed:
    - name: runc
    - pkgs_info: {"kubectl": {"version": "1.17.9"}, "xfsprogs": {"version": null}, "httpd-tools": {"version": null}, "iproute": {"version": null}, "sos": {"version": null}, "yum-plugin-versionlock": {"version": null}, "socat": {"version": null}, "containerd": {"version": "1.2.13-2.el7"}, "coreutils": {"version": null}, "container-selinux": {"version": null}, "iptables": {"version": null}, "ebtables": {"version": null}, "salt-minion": {"version": "3000.3"}, "calico-cni-plugin": {"version": "3.12.0-1.el7"}, "yum-utils": {"version": null}, "kubelet": {"version": "1.17.9"}, "m2crypto": {"version": null}, "genisoimage": {"version": null}, "util-linux": {"version": null}, "metalk8s-sosreport": {"version": "2.6-1.el7"}, "cri-tools": {"version": null}, "ethtool": {"version": null}, "e2fsprogs": {"version": null}, "runc": {"version": null}, "kubernetes-cni": {"version": null}}
    - reload_modules: True
    - require:
      - test: Repositories configured
      - metalk8s_package_manager: Install container-selinux

Install containerd:
  
  metalk8s_package_manager.installed:
    - name: containerd
    - pkgs_info: {"kubectl": {"version": "1.17.9"}, "xfsprogs": {"version": null}, "httpd-tools": {"version": null}, "iproute": {"version": null}, "sos": {"version": null}, "yum-plugin-versionlock": {"version": null}, "socat": {"version": null}, "containerd": {"version": "1.2.13-2.el7"}, "coreutils": {"version": null}, "container-selinux": {"version": null}, "iptables": {"version": null}, "ebtables": {"version": null}, "salt-minion": {"version": "3000.3"}, "calico-cni-plugin": {"version": "3.12.0-1.el7"}, "yum-utils": {"version": null}, "kubelet": {"version": "1.17.9"}, "m2crypto": {"version": null}, "genisoimage": {"version": null}, "util-linux": {"version": null}, "metalk8s-sosreport": {"version": "2.6-1.el7"}, "cri-tools": {"version": null}, "ethtool": {"version": null}, "e2fsprogs": {"version": null}, "runc": {"version": null}, "kubernetes-cni": {"version": null}}
    - version: 1.2.13-2.el7
    - hold: True
    - update_holds: True
    - ignore_epoch: True
    - reload_modules: True
    - require:
      - test: Repositories configured
      - metalk8s_package_manager: Install runc
      - file: Create containerd service drop-in
      - file: Configure registry IP in containerd conf
      - metalk8s_package_manager: Install container-selinux

Create containerd service drop-in:
  file.managed:
    - name: /etc/systemd/system/containerd.service.d/50-metalk8s.conf
    - source: salt://metalk8s/container-engine/containerd/files/50-metalk8s.conf.j2
    - template: jinja
    - user: root
    - group: root
    - mode: 0644
    - makedirs: true
    - dir_mode: 0755
    - context:
        containerd_args:
          - --log-level
          - info
        environment:

Install and configure cri-tools:
  
  metalk8s_package_manager.installed:
    - name: cri-tools
    - pkgs_info: {"kubectl": {"version": "1.17.9"}, "xfsprogs": {"version": null}, "httpd-tools": {"version": null}, "iproute": {"version": null}, "sos": {"version": null}, "yum-plugin-versionlock": {"version": null}, "socat": {"version": null}, "containerd": {"version": "1.2.13-2.el7"}, "coreutils": {"version": null}, "container-selinux": {"version": null}, "iptables": {"version": null}, "ebtables": {"version": null}, "salt-minion": {"version": "3000.3"}, "calico-cni-plugin": {"version": "3.12.0-1.el7"}, "yum-utils": {"version": null}, "kubelet": {"version": "1.17.9"}, "m2crypto": {"version": null}, "genisoimage": {"version": null}, "util-linux": {"version": null}, "metalk8s-sosreport": {"version": "2.6-1.el7"}, "cri-tools": {"version": null}, "ethtool": {"version": null}, "e2fsprogs": {"version": null}, "runc": {"version": null}, "kubernetes-cni": {"version": null}}
    - reload_modules: True
    - require:
      - test: Repositories configured
  file.serialize:
    - name: /etc/crictl.yaml
    - dataset:
        runtime-endpoint: unix:///run/containerd/containerd.sock
        image-endpoint: unix:///run/containerd/containerd.sock
    - merge_if_exists: true
    - user: root
    - group: root
    - mode: '0644'
    - formatter: yaml

Configure registry IP in containerd conf:
  file.managed:
    - name: /etc/containerd/config.toml
    - makedirs: true
    - contents: |
        [plugins.cri.registry.mirrors."metalk8s-registry-from-config.invalid"]
        endpoint = ["http://10.0.3.15:8080"]

        [debug]
        level = "info"

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'include', [u'metalk8s.repo']), (u'Install container-selinux', OrderedDict([(u'metalk8s_package_manager.installed', [OrderedDict([(u'name', u'container-selinux')]), OrderedDict([(u'pkgs_info', OrderedDict([(u'kubectl', OrderedDict([(u'version', u'1.17.9')])), (u'xfsprogs', OrderedDict([(u'version', None)])), (u'httpd-tools', OrderedDict([(u'version', None)])), (u'iproute', OrderedDict([(u'version', None)])), (u'sos', OrderedDict([(u'version', None)])), (u'yum-plugin-versionlock', OrderedDict([(u'version', None)])), (u'socat', OrderedDict([(u'version', None)])), (u'containerd', OrderedDict([(u'version', u'1.2.13-2.el7')])), (u'coreutils', OrderedDict([(u'version', None)])), (u'container-selinux', OrderedDict([(u'version', None)])), (u'iptables', OrderedDict([(u'version', None)])), (u'ebtables', OrderedDict([(u'version', None)])), (u'salt-minion', OrderedDict([(u'version', u'3000.3')])), (u'calico-cni-plugin', OrderedDict([(u'version', u'3.12.0-1.el7')])), (u'yum-utils', OrderedDict([(u'version', None)])), (u'kubelet', OrderedDict([(u'version', u'1.17.9')])), (u'm2crypto', OrderedDict([(u'version', None)])), (u'genisoimage', OrderedDict([(u'version', None)])), (u'util-linux', OrderedDict([(u'version', None)])), (u'metalk8s-sosreport', OrderedDict([(u'version', u'2.6-1.el7')])), (u'cri-tools', OrderedDict([(u'version', None)])), (u'ethtool', OrderedDict([(u'version', None)])), (u'e2fsprogs', OrderedDict([(u'version', None)])), (u'runc', OrderedDict([(u'version', None)])), (u'kubernetes-cni', OrderedDict([(u'version', None)]))]))]), OrderedDict([(u'reload_modules', True)]), OrderedDict([(u'require', [OrderedDict([(u'test', u'Repositories configured')])])])])])), (u'Install runc', OrderedDict([(u'metalk8s_package_manager.installed', [OrderedDict([(u'name', u'runc')]), OrderedDict([(u'pkgs_info', OrderedDict([(u'kubectl', OrderedDict([(u'version', u'1.17.9')])), (u'xfsprogs', OrderedDict([(u'version', None)])), (u'httpd-tools', OrderedDict([(u'version', None)])), (u'iproute', OrderedDict([(u'version', None)])), (u'sos', OrderedDict([(u'version', None)])), (u'yum-plugin-versionlock', OrderedDict([(u'version', None)])), (u'socat', OrderedDict([(u'version', None)])), (u'containerd', OrderedDict([(u'version', u'1.2.13-2.el7')])), (u'coreutils', OrderedDict([(u'version', None)])), (u'container-selinux', OrderedDict([(u'version', None)])), (u'iptables', OrderedDict([(u'version', None)])), (u'ebtables', OrderedDict([(u'version', None)])), (u'salt-minion', OrderedDict([(u'version', u'3000.3')])), (u'calico-cni-plugin', OrderedDict([(u'version', u'3.12.0-1.el7')])), (u'yum-utils', OrderedDict([(u'version', None)])), (u'kubelet', OrderedDict([(u'version', u'1.17.9')])), (u'm2crypto', OrderedDict([(u'version', None)])), (u'genisoimage', OrderedDict([(u'version', None)])), (u'util-linux', OrderedDict([(u'version', None)])), (u'metalk8s-sosreport', OrderedDict([(u'version', u'2.6-1.el7')])), (u'cri-tools', OrderedDict([(u'version', None)])), (u'ethtool', OrderedDict([(u'version', None)])), (u'e2fsprogs', OrderedDict([(u'version', None)])), (u'runc', OrderedDict([(u'version', None)])), (u'kubernetes-cni', OrderedDict([(u'version', None)]))]))]), OrderedDict([(u'reload_modules', True)]), OrderedDict([(u'require', [OrderedDict([(u'test', u'Repositories configured')]), OrderedDict([(u'metalk8s_package_manager', u'Install container-selinux')])])])])])), (u'Install containerd', OrderedDict([(u'metalk8s_package_manager.installed', [OrderedDict([(u'name', u'containerd')]), OrderedDict([(u'pkgs_info', OrderedDict([(u'kubectl', OrderedDict([(u'version', u'1.17.9')])), (u'xfsprogs', OrderedDict([(u'version', None)])), (u'httpd-tools', OrderedDict([(u'version', None)])), (u'iproute', OrderedDict([(u'version', None)])), (u'sos', OrderedDict([(u'version', None)])), (u'yum-plugin-versionlock', OrderedDict([(u'version', None)])), (u'socat', OrderedDict([(u'version', None)])), (u'containerd', OrderedDict([(u'version', u'1.2.13-2.el7')])), (u'coreutils', OrderedDict([(u'version', None)])), (u'container-selinux', OrderedDict([(u'version', None)])), (u'iptables', OrderedDict([(u'version', None)])), (u'ebtables', OrderedDict([(u'version', None)])), (u'salt-minion', OrderedDict([(u'version', u'3000.3')])), (u'calico-cni-plugin', OrderedDict([(u'version', u'3.12.0-1.el7')])), (u'yum-utils', OrderedDict([(u'version', None)])), (u'kubelet', OrderedDict([(u'version', u'1.17.9')])), (u'm2crypto', OrderedDict([(u'version', None)])), (u'genisoimage', OrderedDict([(u'version', None)])), (u'util-linux', OrderedDict([(u'version', None)])), (u'metalk8s-sosreport', OrderedDict([(u'version', u'2.6-1.el7')])), (u'cri-tools', OrderedDict([(u'version', None)])), (u'ethtool', OrderedDict([(u'version', None)])), (u'e2fsprogs', OrderedDict([(u'version', None)])), (u'runc', OrderedDict([(u'version', None)])), (u'kubernetes-cni', OrderedDict([(u'version', None)]))]))]), OrderedDict([(u'version', u'1.2.13-2.el7')]), OrderedDict([(u'hold', True)]), OrderedDict([(u'update_holds', True)]), OrderedDict([(u'ignore_epoch', True)]), OrderedDict([(u'reload_modules', True)]), OrderedDict([(u'require', [OrderedDict([(u'test', u'Repositories configured')]), OrderedDict([(u'metalk8s_package_manager', u'Install runc')]), OrderedDict([(u'file', u'Create containerd service drop-in')]), OrderedDict([(u'file', u'Configure registry IP in containerd conf')]), OrderedDict([(u'metalk8s_package_manager', u'Install container-selinux')])])])])])), (u'Create containerd service drop-in', OrderedDict([(u'file.managed', [OrderedDict([(u'name', u'/etc/systemd/system/containerd.service.d/50-metalk8s.conf')]), OrderedDict([(u'source', u'salt://metalk8s/container-engine/containerd/files/50-metalk8s.conf.j2')]), OrderedDict([(u'template', u'jinja')]), OrderedDict([(u'user', u'root')]), OrderedDict([(u'group', u'root')]), OrderedDict([(u'mode', 644)]), OrderedDict([(u'makedirs', True)]), OrderedDict([(u'dir_mode', 755)]), OrderedDict([(u'context', OrderedDict([(u'containerd_args', [u'--log-level', u'info']), (u'environment', None)]))])])])), (u'Install and configure cri-tools', OrderedDict([(u'metalk8s_package_manager.installed', [OrderedDict([(u'name', u'cri-tools')]), OrderedDict([(u'pkgs_info', OrderedDict([(u'kubectl', OrderedDict([(u'version', u'1.17.9')])), (u'xfsprogs', OrderedDict([(u'version', None)])), (u'httpd-tools', OrderedDict([(u'version', None)])), (u'iproute', OrderedDict([(u'version', None)])), (u'sos', OrderedDict([(u'version', None)])), (u'yum-plugin-versionlock', OrderedDict([(u'version', None)])), (u'socat', OrderedDict([(u'version', None)])), (u'containerd', OrderedDict([(u'version', u'1.2.13-2.el7')])), (u'coreutils', OrderedDict([(u'version', None)])), (u'container-selinux', OrderedDict([(u'version', None)])), (u'iptables', OrderedDict([(u'version', None)])), (u'ebtables', OrderedDict([(u'version', None)])), (u'salt-minion', OrderedDict([(u'version', u'3000.3')])), (u'calico-cni-plugin', OrderedDict([(u'version', u'3.12.0-1.el7')])), (u'yum-utils', OrderedDict([(u'version', None)])), (u'kubelet', OrderedDict([(u'version', u'1.17.9')])), (u'm2crypto', OrderedDict([(u'version', None)])), (u'genisoimage', OrderedDict([(u'version', None)])), (u'util-linux', OrderedDict([(u'version', None)])), (u'metalk8s-sosreport', OrderedDict([(u'version', u'2.6-1.el7')])), (u'cri-tools', OrderedDict([(u'version', None)])), (u'ethtool', OrderedDict([(u'version', None)])), (u'e2fsprogs', OrderedDict([(u'version', None)])), (u'runc', OrderedDict([(u'version', None)])), (u'kubernetes-cni', OrderedDict([(u'version', None)]))]))]), OrderedDict([(u'reload_modules', True)]), OrderedDict([(u'require', [OrderedDict([(u'test', u'Repositories configured')])])])]), (u'file.serialize', [OrderedDict([(u'name', u'/etc/crictl.yaml')]), OrderedDict([(u'dataset', OrderedDict([(u'runtime-endpoint', u'unix:///run/containerd/containerd.sock'), (u'image-endpoint', u'unix:///run/containerd/containerd.sock')]))]), OrderedDict([(u'merge_if_exists', True)]), OrderedDict([(u'user', u'root')]), OrderedDict([(u'group', u'root')]), OrderedDict([(u'mode', u'0644')]), OrderedDict([(u'formatter', u'yaml')])])])), (u'Configure registry IP in containerd conf', OrderedDict([(u'file.managed', [OrderedDict([(u'name', u'/etc/containerd/config.toml')]), OrderedDict([(u'makedirs', True)]), OrderedDict([(u'contents', u'[plugins.cri.registry.mirrors."metalk8s-registry-from-config.invalid"]\nendpoint = ["http://10.0.3.15:8080"]\n\n[debug]\nlevel = "info"\n')])])]))])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/container-engine/containerd/installed.sls' using 'yaml' renderer: 0.0124778747559
[DEBUG   ] Could not find file 'salt://metalk8s/internal/preflight.sls' in saltenv 'metalk8s-2.6.0-dev'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/internal/preflight/init.sls' to resolve 'salt://metalk8s/internal/preflight/init.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/internal/preflight/init.sls' to resolve 'salt://metalk8s/internal/preflight/init.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/internal/preflight/init.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/internal/preflight/init.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/internal/preflight/init.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/internal/preflight/init.sls' using 'jinja' renderer: 0.00159502029419
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/internal/preflight/init.sls:
#
# State preparation for kubeadm init preflight phase.
#
# The goal is to satisfy the checks executed by preflight:
#
# https://kubernetes.io/docs/reference/setup-tools/kubeadm/implementation-details/#preflight-checks
#
# Available states
# ================
#
# * mandatory   -> prevent ERROR in preflight phase
# * recommended -> prevent WARNING in preflight phase
#
# List of checks
#
#

include:
  - .mandatory
  - .recommended

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'include', [u'.mandatory', u'.recommended'])])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/internal/preflight/init.sls' using 'yaml' renderer: 0.00134801864624
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/internal/preflight/mandatory.sls' to resolve 'salt://metalk8s/internal/preflight/mandatory.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/internal/preflight/mandatory.sls' to resolve 'salt://metalk8s/internal/preflight/mandatory.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/internal/preflight/mandatory.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/internal/preflight/mandatory.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/internal/preflight/mandatory.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/macro.sls' to resolve 'salt://metalk8s/macro.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/macro.sls' to resolve 'salt://metalk8s/macro.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/internal/preflight/mandatory.sls' using 'jinja' renderer: 0.109155893326
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/internal/preflight/mandatory.sls:


include:
  - metalk8s.repo
Install mandatory package "util-linux":
  
  metalk8s_package_manager.installed:
    - name: util-linux
    - pkgs_info: {"kubectl": {"version": "1.17.9"}, "xfsprogs": {"version": null}, "httpd-tools": {"version": null}, "iproute": {"version": null}, "sos": {"version": null}, "yum-plugin-versionlock": {"version": null}, "socat": {"version": null}, "containerd": {"version": "1.2.13-2.el7"}, "coreutils": {"version": null}, "container-selinux": {"version": null}, "iptables": {"version": null}, "ebtables": {"version": null}, "salt-minion": {"version": "3000.3"}, "calico-cni-plugin": {"version": "3.12.0-1.el7"}, "yum-utils": {"version": null}, "kubelet": {"version": "1.17.9"}, "m2crypto": {"version": null}, "genisoimage": {"version": null}, "util-linux": {"version": null}, "metalk8s-sosreport": {"version": "2.6-1.el7"}, "cri-tools": {"version": null}, "ethtool": {"version": null}, "e2fsprogs": {"version": null}, "runc": {"version": null}, "kubernetes-cni": {"version": null}}
    - reload_modules: True
    - require:
      - test: Repositories configured
Install mandatory package "iproute":
  
  metalk8s_package_manager.installed:
    - name: iproute
    - pkgs_info: {"kubectl": {"version": "1.17.9"}, "xfsprogs": {"version": null}, "httpd-tools": {"version": null}, "iproute": {"version": null}, "sos": {"version": null}, "yum-plugin-versionlock": {"version": null}, "socat": {"version": null}, "containerd": {"version": "1.2.13-2.el7"}, "coreutils": {"version": null}, "container-selinux": {"version": null}, "iptables": {"version": null}, "ebtables": {"version": null}, "salt-minion": {"version": "3000.3"}, "calico-cni-plugin": {"version": "3.12.0-1.el7"}, "yum-utils": {"version": null}, "kubelet": {"version": "1.17.9"}, "m2crypto": {"version": null}, "genisoimage": {"version": null}, "util-linux": {"version": null}, "metalk8s-sosreport": {"version": "2.6-1.el7"}, "cri-tools": {"version": null}, "ethtool": {"version": null}, "e2fsprogs": {"version": null}, "runc": {"version": null}, "kubernetes-cni": {"version": null}}
    - reload_modules: True
    - require:
      - test: Repositories configured
Install mandatory package "iptables":
  
  metalk8s_package_manager.installed:
    - name: iptables
    - pkgs_info: {"kubectl": {"version": "1.17.9"}, "xfsprogs": {"version": null}, "httpd-tools": {"version": null}, "iproute": {"version": null}, "sos": {"version": null}, "yum-plugin-versionlock": {"version": null}, "socat": {"version": null}, "containerd": {"version": "1.2.13-2.el7"}, "coreutils": {"version": null}, "container-selinux": {"version": null}, "iptables": {"version": null}, "ebtables": {"version": null}, "salt-minion": {"version": "3000.3"}, "calico-cni-plugin": {"version": "3.12.0-1.el7"}, "yum-utils": {"version": null}, "kubelet": {"version": "1.17.9"}, "m2crypto": {"version": null}, "genisoimage": {"version": null}, "util-linux": {"version": null}, "metalk8s-sosreport": {"version": "2.6-1.el7"}, "cri-tools": {"version": null}, "ethtool": {"version": null}, "e2fsprogs": {"version": null}, "runc": {"version": null}, "kubernetes-cni": {"version": null}}
    - reload_modules: True
    - require:
      - test: Repositories configured
Enable containerd service:
  service.running:
    - name: containerd
    - enable: true
    - require_in:
      - test: Check that the crictl socket answer

# required to set sysctl net.bridge.bridge-nf-call-iptables
Add the module br_netfilter to kernel:
  kmod.present:
    - name: br_netfilter
    - persist: True
Set sysctl net.bridge.bridge-nf-call-ip6tables value to 1:
  sysctl.present:
    - name: net.bridge.bridge-nf-call-ip6tables
    - value: 1
    - config: /etc/sysctl.d/60-metalk8s.conf
    - require:
      - kmod: Add the module br_netfilter to kernel
Set sysctl net.bridge.bridge-nf-call-iptables value to 1:
  sysctl.present:
    - name: net.bridge.bridge-nf-call-iptables
    - value: 1
    - config: /etc/sysctl.d/60-metalk8s.conf
    - require:
      - kmod: Add the module br_netfilter to kernel
Set sysctl net.ipv4.ip_forward value to 1:
  sysctl.present:
    - name: net.ipv4.ip_forward
    - value: 1
    - config: /etc/sysctl.d/60-metalk8s.conf
Disable swap device /dev/dm-1:
  module.run:
    - mount.swapoff:
      - name: /dev/dm-1

Prevent swap mount from fstab:
  file.comment:
    - name: /etc/fstab
    - regex: .+\s+.+\s+swap\s+.+
    - onlyif:
      # Add a condition to avoid the state failure
      # in case we don t have swap in /etc/fstab
      - test -n "$(awk '$3=="swap" {print}' /etc/fstab)"

Check that the crictl socket answer:
  # use test.succeed_without_changes instead of cmd.run for idempotency
  test.succeed_without_changes:
    - name: crictl --runtime-endpoint unix:///run/containerd/containerd.sock info
    - check_cmd:
      - crictl --runtime-endpoint unix:///run/containerd/containerd.sock info
The port 10250 is free:
  test.succeed_without_changes: []
The port 10251 is free:
  test.succeed_without_changes: []
The port 10252 is free:
  test.succeed_without_changes: []
The port 2379 is free:
  test.succeed_without_changes: []
The port 2380 is free:
  test.succeed_without_changes: []

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'include', [u'metalk8s.repo']), (u'Install mandatory package "util-linux"', OrderedDict([(u'metalk8s_package_manager.installed', [OrderedDict([(u'name', u'util-linux')]), OrderedDict([(u'pkgs_info', OrderedDict([(u'kubectl', OrderedDict([(u'version', u'1.17.9')])), (u'xfsprogs', OrderedDict([(u'version', None)])), (u'httpd-tools', OrderedDict([(u'version', None)])), (u'iproute', OrderedDict([(u'version', None)])), (u'sos', OrderedDict([(u'version', None)])), (u'yum-plugin-versionlock', OrderedDict([(u'version', None)])), (u'socat', OrderedDict([(u'version', None)])), (u'containerd', OrderedDict([(u'version', u'1.2.13-2.el7')])), (u'coreutils', OrderedDict([(u'version', None)])), (u'container-selinux', OrderedDict([(u'version', None)])), (u'iptables', OrderedDict([(u'version', None)])), (u'ebtables', OrderedDict([(u'version', None)])), (u'salt-minion', OrderedDict([(u'version', u'3000.3')])), (u'calico-cni-plugin', OrderedDict([(u'version', u'3.12.0-1.el7')])), (u'yum-utils', OrderedDict([(u'version', None)])), (u'kubelet', OrderedDict([(u'version', u'1.17.9')])), (u'm2crypto', OrderedDict([(u'version', None)])), (u'genisoimage', OrderedDict([(u'version', None)])), (u'util-linux', OrderedDict([(u'version', None)])), (u'metalk8s-sosreport', OrderedDict([(u'version', u'2.6-1.el7')])), (u'cri-tools', OrderedDict([(u'version', None)])), (u'ethtool', OrderedDict([(u'version', None)])), (u'e2fsprogs', OrderedDict([(u'version', None)])), (u'runc', OrderedDict([(u'version', None)])), (u'kubernetes-cni', OrderedDict([(u'version', None)]))]))]), OrderedDict([(u'reload_modules', True)]), OrderedDict([(u'require', [OrderedDict([(u'test', u'Repositories configured')])])])])])), (u'Install mandatory package "iproute"', OrderedDict([(u'metalk8s_package_manager.installed', [OrderedDict([(u'name', u'iproute')]), OrderedDict([(u'pkgs_info', OrderedDict([(u'kubectl', OrderedDict([(u'version', u'1.17.9')])), (u'xfsprogs', OrderedDict([(u'version', None)])), (u'httpd-tools', OrderedDict([(u'version', None)])), (u'iproute', OrderedDict([(u'version', None)])), (u'sos', OrderedDict([(u'version', None)])), (u'yum-plugin-versionlock', OrderedDict([(u'version', None)])), (u'socat', OrderedDict([(u'version', None)])), (u'containerd', OrderedDict([(u'version', u'1.2.13-2.el7')])), (u'coreutils', OrderedDict([(u'version', None)])), (u'container-selinux', OrderedDict([(u'version', None)])), (u'iptables', OrderedDict([(u'version', None)])), (u'ebtables', OrderedDict([(u'version', None)])), (u'salt-minion', OrderedDict([(u'version', u'3000.3')])), (u'calico-cni-plugin', OrderedDict([(u'version', u'3.12.0-1.el7')])), (u'yum-utils', OrderedDict([(u'version', None)])), (u'kubelet', OrderedDict([(u'version', u'1.17.9')])), (u'm2crypto', OrderedDict([(u'version', None)])), (u'genisoimage', OrderedDict([(u'version', None)])), (u'util-linux', OrderedDict([(u'version', None)])), (u'metalk8s-sosreport', OrderedDict([(u'version', u'2.6-1.el7')])), (u'cri-tools', OrderedDict([(u'version', None)])), (u'ethtool', OrderedDict([(u'version', None)])), (u'e2fsprogs', OrderedDict([(u'version', None)])), (u'runc', OrderedDict([(u'version', None)])), (u'kubernetes-cni', OrderedDict([(u'version', None)]))]))]), OrderedDict([(u'reload_modules', True)]), OrderedDict([(u'require', [OrderedDict([(u'test', u'Repositories configured')])])])])])), (u'Install mandatory package "iptables"', OrderedDict([(u'metalk8s_package_manager.installed', [OrderedDict([(u'name', u'iptables')]), OrderedDict([(u'pkgs_info', OrderedDict([(u'kubectl', OrderedDict([(u'version', u'1.17.9')])), (u'xfsprogs', OrderedDict([(u'version', None)])), (u'httpd-tools', OrderedDict([(u'version', None)])), (u'iproute', OrderedDict([(u'version', None)])), (u'sos', OrderedDict([(u'version', None)])), (u'yum-plugin-versionlock', OrderedDict([(u'version', None)])), (u'socat', OrderedDict([(u'version', None)])), (u'containerd', OrderedDict([(u'version', u'1.2.13-2.el7')])), (u'coreutils', OrderedDict([(u'version', None)])), (u'container-selinux', OrderedDict([(u'version', None)])), (u'iptables', OrderedDict([(u'version', None)])), (u'ebtables', OrderedDict([(u'version', None)])), (u'salt-minion', OrderedDict([(u'version', u'3000.3')])), (u'calico-cni-plugin', OrderedDict([(u'version', u'3.12.0-1.el7')])), (u'yum-utils', OrderedDict([(u'version', None)])), (u'kubelet', OrderedDict([(u'version', u'1.17.9')])), (u'm2crypto', OrderedDict([(u'version', None)])), (u'genisoimage', OrderedDict([(u'version', None)])), (u'util-linux', OrderedDict([(u'version', None)])), (u'metalk8s-sosreport', OrderedDict([(u'version', u'2.6-1.el7')])), (u'cri-tools', OrderedDict([(u'version', None)])), (u'ethtool', OrderedDict([(u'version', None)])), (u'e2fsprogs', OrderedDict([(u'version', None)])), (u'runc', OrderedDict([(u'version', None)])), (u'kubernetes-cni', OrderedDict([(u'version', None)]))]))]), OrderedDict([(u'reload_modules', True)]), OrderedDict([(u'require', [OrderedDict([(u'test', u'Repositories configured')])])])])])), (u'Enable containerd service', OrderedDict([(u'service.running', [OrderedDict([(u'name', u'containerd')]), OrderedDict([(u'enable', True)]), OrderedDict([(u'require_in', [OrderedDict([(u'test', u'Check that the crictl socket answer')])])])])])), (u'Add the module br_netfilter to kernel', OrderedDict([(u'kmod.present', [OrderedDict([(u'name', u'br_netfilter')]), OrderedDict([(u'persist', True)])])])), (u'Set sysctl net.bridge.bridge-nf-call-ip6tables value to 1', OrderedDict([(u'sysctl.present', [OrderedDict([(u'name', u'net.bridge.bridge-nf-call-ip6tables')]), OrderedDict([(u'value', 1)]), OrderedDict([(u'config', u'/etc/sysctl.d/60-metalk8s.conf')]), OrderedDict([(u'require', [OrderedDict([(u'kmod', u'Add the module br_netfilter to kernel')])])])])])), (u'Set sysctl net.bridge.bridge-nf-call-iptables value to 1', OrderedDict([(u'sysctl.present', [OrderedDict([(u'name', u'net.bridge.bridge-nf-call-iptables')]), OrderedDict([(u'value', 1)]), OrderedDict([(u'config', u'/etc/sysctl.d/60-metalk8s.conf')]), OrderedDict([(u'require', [OrderedDict([(u'kmod', u'Add the module br_netfilter to kernel')])])])])])), (u'Set sysctl net.ipv4.ip_forward value to 1', OrderedDict([(u'sysctl.present', [OrderedDict([(u'name', u'net.ipv4.ip_forward')]), OrderedDict([(u'value', 1)]), OrderedDict([(u'config', u'/etc/sysctl.d/60-metalk8s.conf')])])])), (u'Disable swap device /dev/dm-1', OrderedDict([(u'module.run', [OrderedDict([(u'mount.swapoff', [OrderedDict([(u'name', u'/dev/dm-1')])])])])])), (u'Prevent swap mount from fstab', OrderedDict([(u'file.comment', [OrderedDict([(u'name', u'/etc/fstab')]), OrderedDict([(u'regex', u'.+\\s+.+\\s+swap\\s+.+')]), OrderedDict([(u'onlyif', [u'test -n "$(awk \'$3=="swap" {print}\' /etc/fstab)"'])])])])), (u'Check that the crictl socket answer', OrderedDict([(u'test.succeed_without_changes', [OrderedDict([(u'name', u'crictl --runtime-endpoint unix:///run/containerd/containerd.sock info')]), OrderedDict([(u'check_cmd', [u'crictl --runtime-endpoint unix:///run/containerd/containerd.sock info'])])])])), (u'The port 10250 is free', OrderedDict([(u'test.succeed_without_changes', [])])), (u'The port 10251 is free', OrderedDict([(u'test.succeed_without_changes', [])])), (u'The port 10252 is free', OrderedDict([(u'test.succeed_without_changes', [])])), (u'The port 2379 is free', OrderedDict([(u'test.succeed_without_changes', [])])), (u'The port 2380 is free', OrderedDict([(u'test.succeed_without_changes', [])]))])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/internal/preflight/mandatory.sls' using 'yaml' renderer: 0.01043009758
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/internal/preflight/recommended.sls' to resolve 'salt://metalk8s/internal/preflight/recommended.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/internal/preflight/recommended.sls' to resolve 'salt://metalk8s/internal/preflight/recommended.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/internal/preflight/recommended.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/internal/preflight/recommended.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/internal/preflight/recommended.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/macro.sls' to resolve 'salt://metalk8s/macro.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/macro.sls' to resolve 'salt://metalk8s/macro.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/internal/preflight/recommended.sls' using 'jinja' renderer: 0.0760159492493
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/internal/preflight/recommended.sls:


include:
  - metalk8s.repo
Install recommended package "util-linux":
  
  metalk8s_package_manager.installed:
    - name: util-linux
    - pkgs_info: {"kubectl": {"version": "1.17.9"}, "xfsprogs": {"version": null}, "httpd-tools": {"version": null}, "iproute": {"version": null}, "sos": {"version": null}, "yum-plugin-versionlock": {"version": null}, "socat": {"version": null}, "containerd": {"version": "1.2.13-2.el7"}, "coreutils": {"version": null}, "container-selinux": {"version": null}, "iptables": {"version": null}, "ebtables": {"version": null}, "salt-minion": {"version": "3000.3"}, "calico-cni-plugin": {"version": "3.12.0-1.el7"}, "yum-utils": {"version": null}, "kubelet": {"version": "1.17.9"}, "m2crypto": {"version": null}, "genisoimage": {"version": null}, "util-linux": {"version": null}, "metalk8s-sosreport": {"version": "2.6-1.el7"}, "cri-tools": {"version": null}, "ethtool": {"version": null}, "e2fsprogs": {"version": null}, "runc": {"version": null}, "kubernetes-cni": {"version": null}}
    - reload_modules: True
    - require:
      - test: Repositories configured
Install recommended package "iproute":
  
  metalk8s_package_manager.installed:
    - name: iproute
    - pkgs_info: {"kubectl": {"version": "1.17.9"}, "xfsprogs": {"version": null}, "httpd-tools": {"version": null}, "iproute": {"version": null}, "sos": {"version": null}, "yum-plugin-versionlock": {"version": null}, "socat": {"version": null}, "containerd": {"version": "1.2.13-2.el7"}, "coreutils": {"version": null}, "container-selinux": {"version": null}, "iptables": {"version": null}, "ebtables": {"version": null}, "salt-minion": {"version": "3000.3"}, "calico-cni-plugin": {"version": "3.12.0-1.el7"}, "yum-utils": {"version": null}, "kubelet": {"version": "1.17.9"}, "m2crypto": {"version": null}, "genisoimage": {"version": null}, "util-linux": {"version": null}, "metalk8s-sosreport": {"version": "2.6-1.el7"}, "cri-tools": {"version": null}, "ethtool": {"version": null}, "e2fsprogs": {"version": null}, "runc": {"version": null}, "kubernetes-cni": {"version": null}}
    - reload_modules: True
    - require:
      - test: Repositories configured
Install recommended package "iptables":
  
  metalk8s_package_manager.installed:
    - name: iptables
    - pkgs_info: {"kubectl": {"version": "1.17.9"}, "xfsprogs": {"version": null}, "httpd-tools": {"version": null}, "iproute": {"version": null}, "sos": {"version": null}, "yum-plugin-versionlock": {"version": null}, "socat": {"version": null}, "containerd": {"version": "1.2.13-2.el7"}, "coreutils": {"version": null}, "container-selinux": {"version": null}, "iptables": {"version": null}, "ebtables": {"version": null}, "salt-minion": {"version": "3000.3"}, "calico-cni-plugin": {"version": "3.12.0-1.el7"}, "yum-utils": {"version": null}, "kubelet": {"version": "1.17.9"}, "m2crypto": {"version": null}, "genisoimage": {"version": null}, "util-linux": {"version": null}, "metalk8s-sosreport": {"version": "2.6-1.el7"}, "cri-tools": {"version": null}, "ethtool": {"version": null}, "e2fsprogs": {"version": null}, "runc": {"version": null}, "kubernetes-cni": {"version": null}}
    - reload_modules: True
    - require:
      - test: Repositories configured

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'include', [u'metalk8s.repo']), (u'Install recommended package "util-linux"', OrderedDict([(u'metalk8s_package_manager.installed', [OrderedDict([(u'name', u'util-linux')]), OrderedDict([(u'pkgs_info', OrderedDict([(u'kubectl', OrderedDict([(u'version', u'1.17.9')])), (u'xfsprogs', OrderedDict([(u'version', None)])), (u'httpd-tools', OrderedDict([(u'version', None)])), (u'iproute', OrderedDict([(u'version', None)])), (u'sos', OrderedDict([(u'version', None)])), (u'yum-plugin-versionlock', OrderedDict([(u'version', None)])), (u'socat', OrderedDict([(u'version', None)])), (u'containerd', OrderedDict([(u'version', u'1.2.13-2.el7')])), (u'coreutils', OrderedDict([(u'version', None)])), (u'container-selinux', OrderedDict([(u'version', None)])), (u'iptables', OrderedDict([(u'version', None)])), (u'ebtables', OrderedDict([(u'version', None)])), (u'salt-minion', OrderedDict([(u'version', u'3000.3')])), (u'calico-cni-plugin', OrderedDict([(u'version', u'3.12.0-1.el7')])), (u'yum-utils', OrderedDict([(u'version', None)])), (u'kubelet', OrderedDict([(u'version', u'1.17.9')])), (u'm2crypto', OrderedDict([(u'version', None)])), (u'genisoimage', OrderedDict([(u'version', None)])), (u'util-linux', OrderedDict([(u'version', None)])), (u'metalk8s-sosreport', OrderedDict([(u'version', u'2.6-1.el7')])), (u'cri-tools', OrderedDict([(u'version', None)])), (u'ethtool', OrderedDict([(u'version', None)])), (u'e2fsprogs', OrderedDict([(u'version', None)])), (u'runc', OrderedDict([(u'version', None)])), (u'kubernetes-cni', OrderedDict([(u'version', None)]))]))]), OrderedDict([(u'reload_modules', True)]), OrderedDict([(u'require', [OrderedDict([(u'test', u'Repositories configured')])])])])])), (u'Install recommended package "iproute"', OrderedDict([(u'metalk8s_package_manager.installed', [OrderedDict([(u'name', u'iproute')]), OrderedDict([(u'pkgs_info', OrderedDict([(u'kubectl', OrderedDict([(u'version', u'1.17.9')])), (u'xfsprogs', OrderedDict([(u'version', None)])), (u'httpd-tools', OrderedDict([(u'version', None)])), (u'iproute', OrderedDict([(u'version', None)])), (u'sos', OrderedDict([(u'version', None)])), (u'yum-plugin-versionlock', OrderedDict([(u'version', None)])), (u'socat', OrderedDict([(u'version', None)])), (u'containerd', OrderedDict([(u'version', u'1.2.13-2.el7')])), (u'coreutils', OrderedDict([(u'version', None)])), (u'container-selinux', OrderedDict([(u'version', None)])), (u'iptables', OrderedDict([(u'version', None)])), (u'ebtables', OrderedDict([(u'version', None)])), (u'salt-minion', OrderedDict([(u'version', u'3000.3')])), (u'calico-cni-plugin', OrderedDict([(u'version', u'3.12.0-1.el7')])), (u'yum-utils', OrderedDict([(u'version', None)])), (u'kubelet', OrderedDict([(u'version', u'1.17.9')])), (u'm2crypto', OrderedDict([(u'version', None)])), (u'genisoimage', OrderedDict([(u'version', None)])), (u'util-linux', OrderedDict([(u'version', None)])), (u'metalk8s-sosreport', OrderedDict([(u'version', u'2.6-1.el7')])), (u'cri-tools', OrderedDict([(u'version', None)])), (u'ethtool', OrderedDict([(u'version', None)])), (u'e2fsprogs', OrderedDict([(u'version', None)])), (u'runc', OrderedDict([(u'version', None)])), (u'kubernetes-cni', OrderedDict([(u'version', None)]))]))]), OrderedDict([(u'reload_modules', True)]), OrderedDict([(u'require', [OrderedDict([(u'test', u'Repositories configured')])])])])])), (u'Install recommended package "iptables"', OrderedDict([(u'metalk8s_package_manager.installed', [OrderedDict([(u'name', u'iptables')]), OrderedDict([(u'pkgs_info', OrderedDict([(u'kubectl', OrderedDict([(u'version', u'1.17.9')])), (u'xfsprogs', OrderedDict([(u'version', None)])), (u'httpd-tools', OrderedDict([(u'version', None)])), (u'iproute', OrderedDict([(u'version', None)])), (u'sos', OrderedDict([(u'version', None)])), (u'yum-plugin-versionlock', OrderedDict([(u'version', None)])), (u'socat', OrderedDict([(u'version', None)])), (u'containerd', OrderedDict([(u'version', u'1.2.13-2.el7')])), (u'coreutils', OrderedDict([(u'version', None)])), (u'container-selinux', OrderedDict([(u'version', None)])), (u'iptables', OrderedDict([(u'version', None)])), (u'ebtables', OrderedDict([(u'version', None)])), (u'salt-minion', OrderedDict([(u'version', u'3000.3')])), (u'calico-cni-plugin', OrderedDict([(u'version', u'3.12.0-1.el7')])), (u'yum-utils', OrderedDict([(u'version', None)])), (u'kubelet', OrderedDict([(u'version', u'1.17.9')])), (u'm2crypto', OrderedDict([(u'version', None)])), (u'genisoimage', OrderedDict([(u'version', None)])), (u'util-linux', OrderedDict([(u'version', None)])), (u'metalk8s-sosreport', OrderedDict([(u'version', u'2.6-1.el7')])), (u'cri-tools', OrderedDict([(u'version', None)])), (u'ethtool', OrderedDict([(u'version', None)])), (u'e2fsprogs', OrderedDict([(u'version', None)])), (u'runc', OrderedDict([(u'version', None)])), (u'kubernetes-cni', OrderedDict([(u'version', None)]))]))]), OrderedDict([(u'reload_modules', True)]), OrderedDict([(u'require', [OrderedDict([(u'test', u'Repositories configured')])])])])]))])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/internal/preflight/recommended.sls' using 'yaml' renderer: 0.00699210166931
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/repo/installed.sls' to resolve 'salt://metalk8s/repo/installed.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/repo/installed.sls' to resolve 'salt://metalk8s/repo/installed.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/repo/installed.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/repo/installed.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/repo/installed.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[WARNING ] Skip, invalid archive path /metalk8s.iso, should be an iso or a directory.
[ERROR   ] Rendering exception occurred
Traceback (most recent call last):
  File "/usr/lib/python2.7/site-packages/salt/utils/templates.py", line 169, in render_tmpl
    output = render_str(tmplstr, context, tmplpath)
  File "/usr/lib/python2.7/site-packages/salt/utils/templates.py", line 404, in render_jinja_tmpl
    buf=tmplstr)
SaltRenderError: Jinja variable 'dict object' has no attribute u'metalk8s-2.6.0-dev'
[CRITICAL] Rendering SLS 'metalk8s-2.6.0-dev:metalk8s.repo.installed' failed: Jinja variable 'dict object' has no attribute u'metalk8s-2.6.0-dev'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/salt/master/certs/salt-api.sls' to resolve 'salt://metalk8s/salt/master/certs/salt-api.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/master/certs/salt-api.sls' to resolve 'salt://metalk8s/salt/master/certs/salt-api.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/salt/master/certs/salt-api.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/salt/master/certs/salt-api.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/master/certs/salt-api.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[DEBUG   ] Trying to parse u'localhost.localdomain' as AF_INET
[DEBUG   ] Failed to parse u'localhost.localdomain' as AF_INET: illegal IP address string passed to inet_pton
[DEBUG   ] Trying to parse u'localhost.localdomain' as AF_INET6
[DEBUG   ] Failed to parse u'localhost.localdomain' as AF_INET6: illegal IP address string passed to inet_pton
[DEBUG   ] SAN field for u'localhost.localdomain' is "DNS:localhost.localdomain"
[DEBUG   ] Trying to parse u'salt-master' as AF_INET
[DEBUG   ] Failed to parse u'salt-master' as AF_INET: illegal IP address string passed to inet_pton
[DEBUG   ] Trying to parse u'salt-master' as AF_INET6
[DEBUG   ] Failed to parse u'salt-master' as AF_INET6: illegal IP address string passed to inet_pton
[DEBUG   ] SAN field for u'salt-master' is "DNS:salt-master"
[DEBUG   ] Trying to parse u'salt-master.kube-system' as AF_INET
[DEBUG   ] Failed to parse u'salt-master.kube-system' as AF_INET: illegal IP address string passed to inet_pton
[DEBUG   ] Trying to parse u'salt-master.kube-system' as AF_INET6
[DEBUG   ] Failed to parse u'salt-master.kube-system' as AF_INET6: illegal IP address string passed to inet_pton
[DEBUG   ] SAN field for u'salt-master.kube-system' is "DNS:salt-master.kube-system"
[DEBUG   ] Trying to parse u'salt-master.kube-system.svc' as AF_INET
[DEBUG   ] Failed to parse u'salt-master.kube-system.svc' as AF_INET: illegal IP address string passed to inet_pton
[DEBUG   ] Trying to parse u'salt-master.kube-system.svc' as AF_INET6
[DEBUG   ] Failed to parse u'salt-master.kube-system.svc' as AF_INET6: illegal IP address string passed to inet_pton
[DEBUG   ] SAN field for u'salt-master.kube-system.svc' is "DNS:salt-master.kube-system.svc"
[DEBUG   ] Trying to parse u'salt-master.kube-system.svc.cluster.local' as AF_INET
[DEBUG   ] Failed to parse u'salt-master.kube-system.svc.cluster.local' as AF_INET: illegal IP address string passed to inet_pton
[DEBUG   ] Trying to parse u'salt-master.kube-system.svc.cluster.local' as AF_INET6
[DEBUG   ] Failed to parse u'salt-master.kube-system.svc.cluster.local' as AF_INET6: illegal IP address string passed to inet_pton
[DEBUG   ] SAN field for u'salt-master.kube-system.svc.cluster.local' is "DNS:salt-master.kube-system.svc.cluster.local"
[DEBUG   ] Trying to parse u'10.0.3.15' as AF_INET
[DEBUG   ] Trying to unparse u'\n\x00\x03\x0f' as AF_INET
[DEBUG   ] SAN field for u'10.0.3.15' is "IP:10.0.3.15"
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/master/certs/salt-api.sls' using 'jinja' renderer: 0.0710778236389
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/master/certs/salt-api.sls:


include:
  - metalk8s.internal.m2crypto

Create Salt API private key:
  x509.private_key_managed:
    - name: /etc/salt/pki/api/salt-api.key
    - bits: 2048
    - verbose: False
    - user: root
    - group: root
    - mode: 600
    - makedirs: True
    - dir_mode: 755
    - require:
      - metalk8s_package_manager: Install m2crypto
    - unless:
      - test -f "/etc/salt/pki/api/salt-api.key"



Generate Salt API certificate:
  x509.certificate_managed:
    - name: /etc/salt/pki/api/salt-api.crt
    - public_key: /etc/salt/pki/api/salt-api.key
    - signing_policy: kube_apiserver_server_policy
    - CN: salt-api on 10.0.2.15
    - subjectAltName: "DNS:localhost.localdomain, DNS:salt-master, DNS:salt-master.kube-system, DNS:salt-master.kube-system.svc, DNS:salt-master.kube-system.svc.cluster.local, IP:10.0.3.15"
    - user: root
    - group: root
    - mode: 644
    - makedirs: True
    - dir_mode: 755
    - require:
      - x509: Create Salt API private key

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'include', [u'metalk8s.internal.m2crypto']), (u'Create Salt API private key', OrderedDict([(u'x509.private_key_managed', [OrderedDict([(u'name', u'/etc/salt/pki/api/salt-api.key')]), OrderedDict([(u'bits', 2048)]), OrderedDict([(u'verbose', False)]), OrderedDict([(u'user', u'root')]), OrderedDict([(u'group', u'root')]), OrderedDict([(u'mode', 600)]), OrderedDict([(u'makedirs', True)]), OrderedDict([(u'dir_mode', 755)]), OrderedDict([(u'require', [OrderedDict([(u'metalk8s_package_manager', u'Install m2crypto')])])]), OrderedDict([(u'unless', [u'test -f "/etc/salt/pki/api/salt-api.key"'])])])])), (u'Generate Salt API certificate', OrderedDict([(u'x509.certificate_managed', [OrderedDict([(u'name', u'/etc/salt/pki/api/salt-api.crt')]), OrderedDict([(u'public_key', u'/etc/salt/pki/api/salt-api.key')]), OrderedDict([(u'signing_policy', u'kube_apiserver_server_policy')]), OrderedDict([(u'CN', u'salt-api on 10.0.2.15')]), OrderedDict([(u'subjectAltName', u'DNS:localhost.localdomain, DNS:salt-master, DNS:salt-master.kube-system, DNS:salt-master.kube-system.svc, DNS:salt-master.kube-system.svc.cluster.local, IP:10.0.3.15')]), OrderedDict([(u'user', u'root')]), OrderedDict([(u'group', u'root')]), OrderedDict([(u'mode', 644)]), OrderedDict([(u'makedirs', True)]), OrderedDict([(u'dir_mode', 755)]), OrderedDict([(u'require', [OrderedDict([(u'x509', u'Create Salt API private key')])])])])]))])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/master/certs/salt-api.sls' using 'yaml' renderer: 0.00200796127319
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/salt/master/configured.sls' to resolve 'salt://metalk8s/salt/master/configured.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/master/configured.sls' to resolve 'salt://metalk8s/salt/master/configured.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/salt/master/configured.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/salt/master/configured.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/master/configured.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[WARNING ] Skip, invalid archive path /metalk8s.iso, should be an iso or a directory.
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/master/configured.sls' using 'jinja' renderer: 0.0661158561707
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/master/configured.sls:


Configure salt master:
  file.managed:
    - name: /etc/salt/master.d/99-metalk8s.conf
    - source: salt://metalk8s/salt/master/files/master-99-metalk8s.conf.j2
    - user: root
    - group: root
    - mode: '0644'
    - makedirs: true
    - backup: false
    - template: jinja
    - defaults:
        debug: False
        salt_ip: "10.0.3.15"
        kubeconfig: "/etc/salt/master-kubeconfig.conf"

Configure salt master roots paths:
  file.serialize:
    - name: /etc/salt/master.d/99-metalk8s-roots.conf
    - user: root
    - group: root
    - mode: '0644'
    - formatter: yaml
    - merge_if_exists: True
    - makedirs: true
    - backup: false
    - dataset:
        file_roots:
        pillar_roots:

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'Configure salt master', OrderedDict([(u'file.managed', [OrderedDict([(u'name', u'/etc/salt/master.d/99-metalk8s.conf')]), OrderedDict([(u'source', u'salt://metalk8s/salt/master/files/master-99-metalk8s.conf.j2')]), OrderedDict([(u'user', u'root')]), OrderedDict([(u'group', u'root')]), OrderedDict([(u'mode', u'0644')]), OrderedDict([(u'makedirs', True)]), OrderedDict([(u'backup', False)]), OrderedDict([(u'template', u'jinja')]), OrderedDict([(u'defaults', OrderedDict([(u'debug', False), (u'salt_ip', u'10.0.3.15'), (u'kubeconfig', u'/etc/salt/master-kubeconfig.conf')]))])])])), (u'Configure salt master roots paths', OrderedDict([(u'file.serialize', [OrderedDict([(u'name', u'/etc/salt/master.d/99-metalk8s-roots.conf')]), OrderedDict([(u'user', u'root')]), OrderedDict([(u'group', u'root')]), OrderedDict([(u'mode', u'0644')]), OrderedDict([(u'formatter', u'yaml')]), OrderedDict([(u'merge_if_exists', True)]), OrderedDict([(u'makedirs', True)]), OrderedDict([(u'backup', False)]), OrderedDict([(u'dataset', OrderedDict([(u'file_roots', None), (u'pillar_roots', None)]))])])]))])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/master/configured.sls' using 'yaml' renderer: 0.00144290924072
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/salt/master/installed.sls' to resolve 'salt://metalk8s/salt/master/installed.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/master/installed.sls' to resolve 'salt://metalk8s/salt/master/installed.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/salt/master/installed.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/salt/master/installed.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/master/installed.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/repo/macro.sls' to resolve 'salt://metalk8s/repo/macro.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/repo/macro.sls' to resolve 'salt://metalk8s/repo/macro.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/repo/macro.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/repo/macro.sls'
[WARNING ] Skip, invalid archive path /metalk8s.iso, should be an iso or a directory.
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/master/installed.sls' using 'jinja' renderer: 0.0929760932922
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/master/installed.sls:




include:
  - .configured

Create salt master directories:
  file.directory:
    - user: root
    - group: root
    - mode: '0700'
    - makedirs: true
    - names:
      - /etc/salt
      - /var/cache/salt
      - /var/run/salt

Install and start salt master manifest:
  metalk8s.static_pod_managed:
    - name: /etc/kubernetes/manifests/salt-master.yaml
    - source: salt://metalk8s/salt/master/files/salt-master-manifest.yaml.j2
    - config_files:
      - /etc/salt/master.d/99-metalk8s.conf
      - /etc/salt/master.d/99-metalk8s-roots.conf
    - context:
        debug: False
        image: metalk8s-registry-from-config.invalid/metalk8s-2.6.0-dev/salt-master:3000.3-1
        version: 3000.3-1
        archives: {}
        solution_archives: {}
        salt_ip: "10.0.3.15"
    - require:
      - file: Create salt master directories
      - file: /etc/salt/master.d/99-metalk8s.conf
      - file: /etc/salt/master.d/99-metalk8s-roots.conf

Delay after new pod deployment:
  module.wait:
    - test.sleep:
      - length: 10
    - watch:
      - metalk8s: Install and start salt master manifest

Make sure salt master container is up:
  module.wait:
    - cri.wait_container:
      - name: salt-master
      - state: running
    - watch:
      - metalk8s: Install and start salt master manifest
    - require:
      - module: Delay after new pod deployment

Wait for Salt API to answer:
  http.wait_for_successful_query:
    - name: https://10.0.3.15:4507/
    - ca_bundle: /etc/kubernetes/pki/ca.crt
    - status: 200
    - require:
      - module: Make sure salt master container is up

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'include', [u'.configured']), (u'Create salt master directories', OrderedDict([(u'file.directory', [OrderedDict([(u'user', u'root')]), OrderedDict([(u'group', u'root')]), OrderedDict([(u'mode', u'0700')]), OrderedDict([(u'makedirs', True)]), OrderedDict([(u'names', [u'/etc/salt', u'/var/cache/salt', u'/var/run/salt'])])])])), (u'Install and start salt master manifest', OrderedDict([(u'metalk8s.static_pod_managed', [OrderedDict([(u'name', u'/etc/kubernetes/manifests/salt-master.yaml')]), OrderedDict([(u'source', u'salt://metalk8s/salt/master/files/salt-master-manifest.yaml.j2')]), OrderedDict([(u'config_files', [u'/etc/salt/master.d/99-metalk8s.conf', u'/etc/salt/master.d/99-metalk8s-roots.conf'])]), OrderedDict([(u'context', OrderedDict([(u'debug', False), (u'image', u'metalk8s-registry-from-config.invalid/metalk8s-2.6.0-dev/salt-master:3000.3-1'), (u'version', u'3000.3-1'), (u'archives', OrderedDict()), (u'solution_archives', OrderedDict()), (u'salt_ip', u'10.0.3.15')]))]), OrderedDict([(u'require', [OrderedDict([(u'file', u'Create salt master directories')]), OrderedDict([(u'file', u'/etc/salt/master.d/99-metalk8s.conf')]), OrderedDict([(u'file', u'/etc/salt/master.d/99-metalk8s-roots.conf')])])])])])), (u'Delay after new pod deployment', OrderedDict([(u'module.wait', [OrderedDict([(u'test.sleep', [OrderedDict([(u'length', 10)])])]), OrderedDict([(u'watch', [OrderedDict([(u'metalk8s', u'Install and start salt master manifest')])])])])])), (u'Make sure salt master container is up', OrderedDict([(u'module.wait', [OrderedDict([(u'cri.wait_container', [OrderedDict([(u'name', u'salt-master')]), OrderedDict([(u'state', u'running')])])]), OrderedDict([(u'watch', [OrderedDict([(u'metalk8s', u'Install and start salt master manifest')])])]), OrderedDict([(u'require', [OrderedDict([(u'module', u'Delay after new pod deployment')])])])])])), (u'Wait for Salt API to answer', OrderedDict([(u'http.wait_for_successful_query', [OrderedDict([(u'name', u'https://10.0.3.15:4507/')]), OrderedDict([(u'ca_bundle', u'/etc/kubernetes/pki/ca.crt')]), OrderedDict([(u'status', 200)]), OrderedDict([(u'require', [OrderedDict([(u'module', u'Make sure salt master container is up')])])])])]))])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/master/installed.sls' using 'yaml' renderer: 0.00340008735657
[DEBUG   ] Could not find file 'salt://metalk8s/kubectl.sls' in saltenv 'metalk8s-2.6.0-dev'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/kubectl/init.sls' to resolve 'salt://metalk8s/kubectl/init.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubectl/init.sls' to resolve 'salt://metalk8s/kubectl/init.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/kubectl/init.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/kubectl/init.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubectl/init.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubectl/init.sls' using 'jinja' renderer: 0.00179505348206
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubectl/init.sls:
#
# State to manage kubectl.
#
# Available states
# ================
#
# * installed   -> Ensure kubectl is installed
#

include:
  - .installed

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'include', [u'.installed'])])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubectl/init.sls' using 'yaml' renderer: 0.000490188598633
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/kubectl/installed.sls' to resolve 'salt://metalk8s/kubectl/installed.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubectl/installed.sls' to resolve 'salt://metalk8s/kubectl/installed.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/kubectl/installed.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/kubectl/installed.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubectl/installed.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/macro.sls' to resolve 'salt://metalk8s/macro.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/macro.sls' to resolve 'salt://metalk8s/macro.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubectl/installed.sls' using 'jinja' renderer: 0.0910129547119
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubectl/installed.sls:


include :
  - metalk8s.repo

Install kubectl:
  
  metalk8s_package_manager.installed:
    - name: kubectl
    - pkgs_info: {"kubectl": {"version": "1.17.9"}, "xfsprogs": {"version": null}, "httpd-tools": {"version": null}, "iproute": {"version": null}, "sos": {"version": null}, "yum-plugin-versionlock": {"version": null}, "socat": {"version": null}, "containerd": {"version": "1.2.13-2.el7"}, "coreutils": {"version": null}, "container-selinux": {"version": null}, "iptables": {"version": null}, "ebtables": {"version": null}, "salt-minion": {"version": "3000.3"}, "calico-cni-plugin": {"version": "3.12.0-1.el7"}, "yum-utils": {"version": null}, "kubelet": {"version": "1.17.9"}, "m2crypto": {"version": null}, "genisoimage": {"version": null}, "util-linux": {"version": null}, "metalk8s-sosreport": {"version": "2.6-1.el7"}, "cri-tools": {"version": null}, "ethtool": {"version": null}, "e2fsprogs": {"version": null}, "runc": {"version": null}, "kubernetes-cni": {"version": null}}
    - version: 1.17.9
    - hold: True
    - update_holds: True
    - ignore_epoch: True
    - reload_modules: True
    - require:
      - test: Repositories configured

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'include', [u'metalk8s.repo']), (u'Install kubectl', OrderedDict([(u'metalk8s_package_manager.installed', [OrderedDict([(u'name', u'kubectl')]), OrderedDict([(u'pkgs_info', OrderedDict([(u'kubectl', OrderedDict([(u'version', u'1.17.9')])), (u'xfsprogs', OrderedDict([(u'version', None)])), (u'httpd-tools', OrderedDict([(u'version', None)])), (u'iproute', OrderedDict([(u'version', None)])), (u'sos', OrderedDict([(u'version', None)])), (u'yum-plugin-versionlock', OrderedDict([(u'version', None)])), (u'socat', OrderedDict([(u'version', None)])), (u'containerd', OrderedDict([(u'version', u'1.2.13-2.el7')])), (u'coreutils', OrderedDict([(u'version', None)])), (u'container-selinux', OrderedDict([(u'version', None)])), (u'iptables', OrderedDict([(u'version', None)])), (u'ebtables', OrderedDict([(u'version', None)])), (u'salt-minion', OrderedDict([(u'version', u'3000.3')])), (u'calico-cni-plugin', OrderedDict([(u'version', u'3.12.0-1.el7')])), (u'yum-utils', OrderedDict([(u'version', None)])), (u'kubelet', OrderedDict([(u'version', u'1.17.9')])), (u'm2crypto', OrderedDict([(u'version', None)])), (u'genisoimage', OrderedDict([(u'version', None)])), (u'util-linux', OrderedDict([(u'version', None)])), (u'metalk8s-sosreport', OrderedDict([(u'version', u'2.6-1.el7')])), (u'cri-tools', OrderedDict([(u'version', None)])), (u'ethtool', OrderedDict([(u'version', None)])), (u'e2fsprogs', OrderedDict([(u'version', None)])), (u'runc', OrderedDict([(u'version', None)])), (u'kubernetes-cni', OrderedDict([(u'version', None)]))]))]), OrderedDict([(u'version', u'1.17.9')]), OrderedDict([(u'hold', True)]), OrderedDict([(u'update_holds', True)]), OrderedDict([(u'ignore_epoch', True)]), OrderedDict([(u'reload_modules', True)]), OrderedDict([(u'require', [OrderedDict([(u'test', u'Repositories configured')])])])])]))])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubectl/installed.sls' using 'yaml' renderer: 0.00400495529175
[DEBUG   ] Could not find file 'salt://metalk8s/roles/minion.sls' in saltenv 'metalk8s-2.6.0-dev'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/roles/minion/init.sls' to resolve 'salt://metalk8s/roles/minion/init.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/roles/minion/init.sls' to resolve 'salt://metalk8s/roles/minion/init.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/roles/minion/init.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/roles/minion/init.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/roles/minion/init.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/roles/minion/init.sls' using 'jinja' renderer: 0.000892162322998
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/roles/minion/init.sls:
include:
  - metalk8s.salt.minion.configured
  - metalk8s.sreport.installed

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'include', [u'metalk8s.salt.minion.configured', u'metalk8s.sreport.installed'])])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/roles/minion/init.sls' using 'yaml' renderer: 0.000277996063232
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/salt/minion/configured.sls' to resolve 'salt://metalk8s/salt/minion/configured.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/minion/configured.sls' to resolve 'salt://metalk8s/salt/minion/configured.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/salt/minion/configured.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/salt/minion/configured.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/minion/configured.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/minion/configured.sls' using 'jinja' renderer: 0.0654029846191
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/minion/configured.sls:


include:
  - .installed
  - .running

Configure salt minion:
  file.managed:
    - name: /etc/salt/minion.d/99-metalk8s.conf
    - source: salt://metalk8s/salt/minion/files/minion-99-metalk8s.conf.j2
    - template: jinja
    - user: root
    - group: root
    - mode: '0644'
    - makedirs: true
    - backup: false
    - defaults:
        debug: False
        master_hostname: 10.0.3.15
        minion_id: 10.0.2.15
        saltenv: metalk8s-2.6.0-dev
    - watch_in:
      - cmd: Restart salt-minion

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'include', [u'.installed', u'.running']), (u'Configure salt minion', OrderedDict([(u'file.managed', [OrderedDict([(u'name', u'/etc/salt/minion.d/99-metalk8s.conf')]), OrderedDict([(u'source', u'salt://metalk8s/salt/minion/files/minion-99-metalk8s.conf.j2')]), OrderedDict([(u'template', u'jinja')]), OrderedDict([(u'user', u'root')]), OrderedDict([(u'group', u'root')]), OrderedDict([(u'mode', u'0644')]), OrderedDict([(u'makedirs', True)]), OrderedDict([(u'backup', False)]), OrderedDict([(u'defaults', OrderedDict([(u'debug', False), (u'master_hostname', u'10.0.3.15'), (u'minion_id', u'10.0.2.15'), (u'saltenv', u'metalk8s-2.6.0-dev')]))]), OrderedDict([(u'watch_in', [OrderedDict([(u'cmd', u'Restart salt-minion')])])])])]))])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/minion/configured.sls' using 'yaml' renderer: 0.00179815292358
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/salt/minion/installed.sls' to resolve 'salt://metalk8s/salt/minion/installed.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/minion/installed.sls' to resolve 'salt://metalk8s/salt/minion/installed.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/salt/minion/installed.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/salt/minion/installed.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/minion/installed.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/macro.sls' to resolve 'salt://metalk8s/macro.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/macro.sls' to resolve 'salt://metalk8s/macro.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/minion/installed.sls' using 'jinja' renderer: 0.0621700286865
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/minion/installed.sls:


include :
  - metalk8s.repo
  - .running

Install salt-minion:
  
  metalk8s_package_manager.installed:
    - name: salt-minion
    - pkgs_info: {"kubectl": {"version": "1.17.9"}, "xfsprogs": {"version": null}, "httpd-tools": {"version": null}, "iproute": {"version": null}, "sos": {"version": null}, "yum-plugin-versionlock": {"version": null}, "socat": {"version": null}, "containerd": {"version": "1.2.13-2.el7"}, "coreutils": {"version": null}, "container-selinux": {"version": null}, "iptables": {"version": null}, "ebtables": {"version": null}, "salt-minion": {"version": "3000.3"}, "calico-cni-plugin": {"version": "3.12.0-1.el7"}, "yum-utils": {"version": null}, "kubelet": {"version": "1.17.9"}, "m2crypto": {"version": null}, "genisoimage": {"version": null}, "util-linux": {"version": null}, "metalk8s-sosreport": {"version": "2.6-1.el7"}, "cri-tools": {"version": null}, "ethtool": {"version": null}, "e2fsprogs": {"version": null}, "runc": {"version": null}, "kubernetes-cni": {"version": null}}
    - version: 3000.3
    - hold: True
    - update_holds: True
    - ignore_epoch: True
    - reload_modules: True
    # NOTE: launch `salt-minion` installation/upgrade/downgrade at the
    # end as this may have impact on the running salt states
    - order: last
    - require:
      - test: Repositories configured
    - require_in:
      - cmd: Restart salt-minion

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'include', [u'metalk8s.repo', u'.running']), (u'Install salt-minion', OrderedDict([(u'metalk8s_package_manager.installed', [OrderedDict([(u'name', u'salt-minion')]), OrderedDict([(u'pkgs_info', OrderedDict([(u'kubectl', OrderedDict([(u'version', u'1.17.9')])), (u'xfsprogs', OrderedDict([(u'version', None)])), (u'httpd-tools', OrderedDict([(u'version', None)])), (u'iproute', OrderedDict([(u'version', None)])), (u'sos', OrderedDict([(u'version', None)])), (u'yum-plugin-versionlock', OrderedDict([(u'version', None)])), (u'socat', OrderedDict([(u'version', None)])), (u'containerd', OrderedDict([(u'version', u'1.2.13-2.el7')])), (u'coreutils', OrderedDict([(u'version', None)])), (u'container-selinux', OrderedDict([(u'version', None)])), (u'iptables', OrderedDict([(u'version', None)])), (u'ebtables', OrderedDict([(u'version', None)])), (u'salt-minion', OrderedDict([(u'version', u'3000.3')])), (u'calico-cni-plugin', OrderedDict([(u'version', u'3.12.0-1.el7')])), (u'yum-utils', OrderedDict([(u'version', None)])), (u'kubelet', OrderedDict([(u'version', u'1.17.9')])), (u'm2crypto', OrderedDict([(u'version', None)])), (u'genisoimage', OrderedDict([(u'version', None)])), (u'util-linux', OrderedDict([(u'version', None)])), (u'metalk8s-sosreport', OrderedDict([(u'version', u'2.6-1.el7')])), (u'cri-tools', OrderedDict([(u'version', None)])), (u'ethtool', OrderedDict([(u'version', None)])), (u'e2fsprogs', OrderedDict([(u'version', None)])), (u'runc', OrderedDict([(u'version', None)])), (u'kubernetes-cni', OrderedDict([(u'version', None)]))]))]), OrderedDict([(u'version', 3000.3)]), OrderedDict([(u'hold', True)]), OrderedDict([(u'update_holds', True)]), OrderedDict([(u'ignore_epoch', True)]), OrderedDict([(u'reload_modules', True)]), OrderedDict([(u'order', u'last')]), OrderedDict([(u'require', [OrderedDict([(u'test', u'Repositories configured')])])]), OrderedDict([(u'require_in', [OrderedDict([(u'cmd', u'Restart salt-minion')])])])])]))])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/minion/installed.sls' using 'yaml' renderer: 0.0035879611969
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/salt/minion/running.sls' to resolve 'salt://metalk8s/salt/minion/running.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/minion/running.sls' to resolve 'salt://metalk8s/salt/minion/running.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/salt/minion/running.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/salt/minion/running.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/minion/running.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/minion/running.sls' using 'jinja' renderer: 0.00105810165405
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/minion/running.sls:
Restart salt-minion:
  cmd.wait:
    - name: 'salt-call --local service.restart salt-minion > /dev/null'
    - bg: true

Wait until salt-minion restarted:
  test.configurable_test_state:
    - changes: False
    - result: __slot__:salt:test.sleep(10)
    - comment: Wait a bit for 'salt-minion' to restart
    - onchanges:
      - cmd: Restart salt-minion

Ensure salt-minion running:
  service.running:
    - name: salt-minion
    - enable: True
    - require:
      - test: Wait until salt-minion restarted
  test.configurable_test_state:
    - changes: False
    - result: __slot__:salt:test.ping()
    - comment: Ran 'test.ping'
    - require:
      - service: Ensure salt-minion running

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'Restart salt-minion', OrderedDict([(u'cmd.wait', [OrderedDict([(u'name', u'salt-call --local service.restart salt-minion > /dev/null')]), OrderedDict([(u'bg', True)])])])), (u'Wait until salt-minion restarted', OrderedDict([(u'test.configurable_test_state', [OrderedDict([(u'changes', False)]), OrderedDict([(u'result', u'__slot__:salt:test.sleep(10)')]), OrderedDict([(u'comment', u"Wait a bit for 'salt-minion' to restart")]), OrderedDict([(u'onchanges', [OrderedDict([(u'cmd', u'Restart salt-minion')])])])])])), (u'Ensure salt-minion running', OrderedDict([(u'service.running', [OrderedDict([(u'name', u'salt-minion')]), OrderedDict([(u'enable', True)]), OrderedDict([(u'require', [OrderedDict([(u'test', u'Wait until salt-minion restarted')])])])]), (u'test.configurable_test_state', [OrderedDict([(u'changes', False)]), OrderedDict([(u'result', u'__slot__:salt:test.ping()')]), OrderedDict([(u'comment', u"Ran 'test.ping'")]), OrderedDict([(u'require', [OrderedDict([(u'service', u'Ensure salt-minion running')])])])])]))])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/minion/running.sls' using 'yaml' renderer: 0.00163507461548
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/sreport/installed.sls' to resolve 'salt://metalk8s/sreport/installed.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/sreport/installed.sls' to resolve 'salt://metalk8s/sreport/installed.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/sreport/installed.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/sreport/installed.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/sreport/installed.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/macro.sls' to resolve 'salt://metalk8s/macro.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/macro.sls' to resolve 'salt://metalk8s/macro.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/sreport/installed.sls' using 'jinja' renderer: 0.103574037552
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/sreport/installed.sls:


include:
  - metalk8s.repo

Install sos report and custom plugins:
  
  metalk8s_package_manager.installed:
    - name: metalk8s-sosreport
    - pkgs_info: {"kubectl": {"version": "1.17.9"}, "xfsprogs": {"version": null}, "httpd-tools": {"version": null}, "iproute": {"version": null}, "sos": {"version": null}, "yum-plugin-versionlock": {"version": null}, "socat": {"version": null}, "containerd": {"version": "1.2.13-2.el7"}, "coreutils": {"version": null}, "container-selinux": {"version": null}, "iptables": {"version": null}, "ebtables": {"version": null}, "salt-minion": {"version": "3000.3"}, "calico-cni-plugin": {"version": "3.12.0-1.el7"}, "yum-utils": {"version": null}, "kubelet": {"version": "1.17.9"}, "m2crypto": {"version": null}, "genisoimage": {"version": null}, "util-linux": {"version": null}, "metalk8s-sosreport": {"version": "2.6-1.el7"}, "cri-tools": {"version": null}, "ethtool": {"version": null}, "e2fsprogs": {"version": null}, "runc": {"version": null}, "kubernetes-cni": {"version": null}}
    - version: 2.6-1.el7
    - hold: True
    - update_holds: True
    - ignore_epoch: True
    - reload_modules: True
    - require:
      - test: Repositories configured

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'include', [u'metalk8s.repo']), (u'Install sos report and custom plugins', OrderedDict([(u'metalk8s_package_manager.installed', [OrderedDict([(u'name', u'metalk8s-sosreport')]), OrderedDict([(u'pkgs_info', OrderedDict([(u'kubectl', OrderedDict([(u'version', u'1.17.9')])), (u'xfsprogs', OrderedDict([(u'version', None)])), (u'httpd-tools', OrderedDict([(u'version', None)])), (u'iproute', OrderedDict([(u'version', None)])), (u'sos', OrderedDict([(u'version', None)])), (u'yum-plugin-versionlock', OrderedDict([(u'version', None)])), (u'socat', OrderedDict([(u'version', None)])), (u'containerd', OrderedDict([(u'version', u'1.2.13-2.el7')])), (u'coreutils', OrderedDict([(u'version', None)])), (u'container-selinux', OrderedDict([(u'version', None)])), (u'iptables', OrderedDict([(u'version', None)])), (u'ebtables', OrderedDict([(u'version', None)])), (u'salt-minion', OrderedDict([(u'version', u'3000.3')])), (u'calico-cni-plugin', OrderedDict([(u'version', u'3.12.0-1.el7')])), (u'yum-utils', OrderedDict([(u'version', None)])), (u'kubelet', OrderedDict([(u'version', u'1.17.9')])), (u'm2crypto', OrderedDict([(u'version', None)])), (u'genisoimage', OrderedDict([(u'version', None)])), (u'util-linux', OrderedDict([(u'version', None)])), (u'metalk8s-sosreport', OrderedDict([(u'version', u'2.6-1.el7')])), (u'cri-tools', OrderedDict([(u'version', None)])), (u'ethtool', OrderedDict([(u'version', None)])), (u'e2fsprogs', OrderedDict([(u'version', None)])), (u'runc', OrderedDict([(u'version', None)])), (u'kubernetes-cni', OrderedDict([(u'version', None)]))]))]), OrderedDict([(u'version', u'2.6-1.el7')]), OrderedDict([(u'hold', True)]), OrderedDict([(u'update_holds', True)]), OrderedDict([(u'ignore_epoch', True)]), OrderedDict([(u'reload_modules', True)]), OrderedDict([(u'require', [OrderedDict([(u'test', u'Repositories configured')])])])])]))])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/sreport/installed.sls' using 'yaml' renderer: 0.00247001647949
[DEBUG   ] LazyLoaded highstate.output
[TRACE   ] data = {u'local': [u"Rendering SLS 'metalk8s-2.6.0-dev:metalk8s.repo.redhat' failed: Jinja variable 'dict object' has no attribute u'metalk8s-2.6.0-dev'", u"Rendering SLS 'metalk8s-2.6.0-dev:metalk8s.repo.installed' failed: Jinja variable 'dict object' has no attribute u'metalk8s-2.6.0-dev'"]}
local:
    Data failed to compile:
----------
    Rendering SLS 'metalk8s-2.6.0-dev:metalk8s.repo.redhat' failed: Jinja variable 'dict object' has no attribute u'metalk8s-2.6.0-dev'
----------
    Rendering SLS 'metalk8s-2.6.0-dev:metalk8s.repo.installed' failed: Jinja variable 'dict object' has no attribute u'metalk8s-2.6.0-dev'
+ local RC=1
+ set -e
+ local end
++ date +%s
+ end=1602754149
+ local duration=4
+ '[' 1 -eq 0 ']'
+ echo ' fail [4s]'
 fail [4s]
+ cat

Failure while running step 'Deploying early-stage bootstrap node in local mode (this may take a while)'

Command: salt-call --local --state-output=mixed --retcode-passthrough state.sls metalk8s.roles.internal.early-stage-bootstrap saltenv=metalk8s-2.6.0-dev pillarenv=metalk8s-2.6.0-dev pillar={   'repo': {'local_mode': True},   'metalk8s': {     'endpoints': {       'repositories': {          'ip': 10.0.3.15,          'ports': {'http': 8080}       },       'salt-master': {'ip': 10.0.3.15}     }   } } -l trace

Output:

<< BEGIN >>
+ cat /tmp/tmp.SDSHkRiDts/out
[DEBUG   ] Reading configuration from /etc/salt/minion
[DEBUG   ] Including configuration from '/etc/salt/minion.d/99-metalk8s-local.conf'
[DEBUG   ] Reading configuration from /etc/salt/minion.d/99-metalk8s-local.conf
[DEBUG   ] Using cached minion ID from /etc/salt/minion_id: 10.0.2.15
[TRACE   ] The required configuration section, 'fluent_handler', was not found the in the configuration. Not loading the fluent logging handlers module.
[TRACE   ] None of the required configuration sections, 'logstash_udp_handler' and 'logstash_zmq_handler', were found in the configuration. Not loading the Logstash logging handlers module.
[DEBUG   ] Configuration file path: /etc/salt/minion
[WARNING ] Insecure logging configuration detected! Sensitive data may be logged.
[DEBUG   ] Grains refresh requested. Refreshing grains.
[DEBUG   ] Reading configuration from /etc/salt/minion
[DEBUG   ] Including configuration from '/etc/salt/minion.d/99-metalk8s-local.conf'
[DEBUG   ] Reading configuration from /etc/salt/minion.d/99-metalk8s-local.conf
[TRACE   ] 'dig' could not be found in the following search path: '[u'/usr/local/sbin', u'/usr/local/bin', u'/usr/sbin', u'/usr/bin', u'/root/bin', u'/sbin', u'/bin']'
[TRACE   ] 'drill' could not be found in the following search path: '[u'/usr/local/sbin', u'/usr/local/bin', u'/usr/sbin', u'/usr/bin', u'/root/bin', u'/sbin', u'/bin']'
[TRACE   ] 'host' could not be found in the following search path: '[u'/usr/local/sbin', u'/usr/local/bin', u'/usr/sbin', u'/usr/bin', u'/root/bin', u'/sbin', u'/bin']'
[TRACE   ] 'nslookup' could not be found in the following search path: '[u'/usr/local/sbin', u'/usr/local/bin', u'/usr/sbin', u'/usr/bin', u'/root/bin', u'/sbin', u'/bin']'
[TRACE   ] 'esxcli' could not be found in the following search path: '[u'/usr/local/sbin', u'/usr/local/bin', u'/usr/sbin', u'/usr/bin', u'/root/bin', u'/sbin', u'/bin']'
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False, False) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False, False) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False, False) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False, False) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False, False) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False, False) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False, False) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False, False) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Depends decorator instantiated with dep list of (False,) and kwargs {}
[TRACE   ] Error loading grains.napalm: "napalm"" (/usr/lib/python2.7/site-packages/salt/grains/napalm.pyc) cannot be loaded: NAPALM is not installed: ``pip install napalm``
[TRACE   ] Loading core.append_domain grain
[TRACE   ] Loading core.cwd grain
[TRACE   ] Loading core.default_gateway grain
[TRACE   ] Loading core.dns grain
[TRACE   ] Loading core.fqdns grain
[TRACE   ] Loading core.get_machine_id grain
[TRACE   ] Loading core.get_master grain
[TRACE   ] Loading core.get_server_id grain
[TRACE   ] Loading core.hostname grain
[TRACE   ] Loading core.hwaddr_interfaces grain
[TRACE   ] Loading core.id_ grain
[TRACE   ] Loading core.ip4_interfaces grain
[TRACE   ] Loading core.ip6_interfaces grain
[TRACE   ] Loading core.ip_fqdn grain
[TRACE   ] Loading core.ip_interfaces grain
[TRACE   ] Loading core.linux_distribution grain
[TRACE   ] Loading core.locale_info grain
[TRACE   ] Loading core.os_data grain
[TRACE   ] Adding selinux grains
[TRACE   ] Adding systemd grains
[TRACE   ] Adding init grain
[TRACE   ] Getting lsb_release distro information
[TRACE   ] lsb_release python bindings not available
[TRACE   ] Attempting to parse /etc/lsb-release
[TRACE   ] Failed to parse /etc/lsb-release: [Errno 2] No such file or directory: u'/etc/lsb-release'
[TRACE   ] Failed to get lsb_distrib_id, trying to parse os-release
[TRACE   ] Getting OS name, release, and codename from platform.linux_distribution()
[TRACE   ] Loading core.path grain
[TRACE   ] Loading core.pythonexecutable grain
[TRACE   ] Loading core.pythonpath grain
[TRACE   ] Loading core.pythonversion grain
[TRACE   ] Loading core.saltpath grain
[TRACE   ] Loading core.saltversion grain
[TRACE   ] Loading core.saltversioninfo grain
[TRACE   ] Loading core.zmqversion grain
[TRACE   ] Loading disks.disks grain
[TRACE   ] Device sda reports itself as an HDD
[TRACE   ] Device dm-0 reports itself as an HDD
[TRACE   ] Device dm-1 reports itself as an HDD
[TRACE   ] Loading extra.config grain
[DEBUG   ] Loading static grains from /etc/salt/grains
[TRACE   ] Loading extra.shell grain
[TRACE   ] Loading mdadm.mdadm grain
[TRACE   ] Loading minion_process.grains grain
[TRACE   ] Loading opts.opts grain
[TRACE   ] Loading zfs.zfs grain
[DEBUG   ] LazyLoaded zfs.is_supported
[TRACE   ] 'zfs-fuse' could not be found in the following search path: '[u'/usr/local/sbin', u'/usr/local/bin', u'/usr/sbin', u'/usr/bin', u'/root/bin', u'/sbin', u'/bin']'
[TRACE   ] 'zpool' could not be found in the following search path: '[u'/usr/local/sbin', u'/usr/local/bin', u'/usr/sbin', u'/usr/bin', u'/root/bin', u'/sbin', u'/bin']'
[DEBUG   ] Determining pillar cache
[DEBUG   ] LazyLoaded jinja.render
[DEBUG   ] LazyLoaded yaml.render
[DEBUG   ] compile template: /srv/scality/metalk8s-2.6.0-dev/pillar/top.sls
[DEBUG   ] Jinja search path: [u'/srv/scality/metalk8s-2.6.0-dev/pillar']
[PROFILE ] Time (in seconds) to render '/srv/scality/metalk8s-2.6.0-dev/pillar/top.sls' using 'jinja' renderer: 0.0151019096375
[DEBUG   ] Rendered data from file: /srv/scality/metalk8s-2.6.0-dev/pillar/top.sls:
# The mechanics of this file are very similar to those of `salt/top.sls(.in)`.
# Please refer to the comments in that file for more background.

metalk8s-2.6.0-dev:
  I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev:
    - match: compound
    - metalk8s.roles.minion

  # Specific case for ca as we need signing_policy at the very beginning
  I@metalk8s:ca:minion:10.0.2.15:
    - match: compound
    - metalk8s.roles.ca


  I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:bootstrap:
    - match: compound
    - metalk8s.roles.bootstrap

  I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:etcd:
    - match: compound
    - metalk8s.roles.etcd

  I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:master:
    - match: compound
    - metalk8s.roles.master

  I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:node:
    - match: compound
    - metalk8s.roles.node


[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'metalk8s-2.6.0-dev', OrderedDict([(u'I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev', [OrderedDict([(u'match', u'compound')]), u'metalk8s.roles.minion']), (u'I@metalk8s:ca:minion:10.0.2.15', [OrderedDict([(u'match', u'compound')]), u'metalk8s.roles.ca']), (u'I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:bootstrap', [OrderedDict([(u'match', u'compound')]), u'metalk8s.roles.bootstrap']), (u'I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:etcd', [OrderedDict([(u'match', u'compound')]), u'metalk8s.roles.etcd']), (u'I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:master', [OrderedDict([(u'match', u'compound')]), u'metalk8s.roles.master']), (u'I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:node', [OrderedDict([(u'match', u'compound')]), u'metalk8s.roles.node'])]))])
[PROFILE ] Time (in seconds) to render '/srv/scality/metalk8s-2.6.0-dev/pillar/top.sls' using 'yaml' renderer: 0.00103092193604
[DEBUG   ] LazyLoaded metalk8s.ext_pillar
[DEBUG   ] Loading MetalK8s configuration from /etc/metalk8s/bootstrap.yaml
[DEBUG   ] LazyLoaded pillar_utils.assert_equals
[DEBUG   ] LazyLoaded jinja.render
[DEBUG   ] LazyLoaded yaml.render
[DEBUG   ] LazyLoaded confirm_top.confirm_top
[DEBUG   ] LazyLoaded compound_match.match
[DEBUG   ] compound_match: 10.0.2.15 ? I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev
[DEBUG   ] LazyLoaded pillar_match.match
[DEBUG   ] pillar target: metalk8s:nodes:10.0.2.15:version:2.6.0-dev
[DEBUG   ] Attempting to match '2.6.0-dev' in 'metalk8s:nodes:10.0.2.15:version' using delimiter ':'
[DEBUG   ] Attempting to match 'version:2.6.0-dev' in 'metalk8s:nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:version:2.6.0-dev' in 'metalk8s:nodes' using delimiter ':'
[DEBUG   ] Attempting to match 'nodes:10.0.2.15:version:2.6.0-dev' in 'metalk8s' using delimiter ':'
[DEBUG   ] Attempting to match '2.6.0-dev' in 'nodes:10.0.2.15:version' using delimiter ':'
[DEBUG   ] Attempting to match 'version:2.6.0-dev' in 'nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:version:2.6.0-dev' in 'nodes' using delimiter ':'
[DEBUG   ] compound_match 10.0.2.15 ? "I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev" => "False"
[DEBUG   ] LazyLoaded compound_match.match
[DEBUG   ] compound_match: 10.0.2.15 ? I@metalk8s:ca:minion:10.0.2.15
[DEBUG   ] LazyLoaded pillar_match.match
[DEBUG   ] pillar target: metalk8s:ca:minion:10.0.2.15
[DEBUG   ] Attempting to match '10.0.2.15' in 'metalk8s:ca:minion' using delimiter ':'
[DEBUG   ] compound_match 10.0.2.15 ? "I@metalk8s:ca:minion:10.0.2.15" => "True"
[DEBUG   ] LazyLoaded compound_match.match
[DEBUG   ] compound_match: 10.0.2.15 ? I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:bootstrap
[DEBUG   ] LazyLoaded pillar_match.match
[DEBUG   ] pillar target: metalk8s:nodes:10.0.2.15:version:2.6.0-dev
[DEBUG   ] Attempting to match '2.6.0-dev' in 'metalk8s:nodes:10.0.2.15:version' using delimiter ':'
[DEBUG   ] Attempting to match 'version:2.6.0-dev' in 'metalk8s:nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:version:2.6.0-dev' in 'metalk8s:nodes' using delimiter ':'
[DEBUG   ] Attempting to match 'nodes:10.0.2.15:version:2.6.0-dev' in 'metalk8s' using delimiter ':'
[DEBUG   ] Attempting to match '2.6.0-dev' in 'nodes:10.0.2.15:version' using delimiter ':'
[DEBUG   ] Attempting to match 'version:2.6.0-dev' in 'nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:version:2.6.0-dev' in 'nodes' using delimiter ':'
[DEBUG   ] pillar target: metalk8s:nodes:10.0.2.15:roles:bootstrap
[DEBUG   ] Attempting to match 'bootstrap' in 'metalk8s:nodes:10.0.2.15:roles' using delimiter ':'
[DEBUG   ] Attempting to match 'roles:bootstrap' in 'metalk8s:nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:roles:bootstrap' in 'metalk8s:nodes' using delimiter ':'
[DEBUG   ] Attempting to match 'nodes:10.0.2.15:roles:bootstrap' in 'metalk8s' using delimiter ':'
[DEBUG   ] Attempting to match 'bootstrap' in 'nodes:10.0.2.15:roles' using delimiter ':'
[DEBUG   ] Attempting to match 'roles:bootstrap' in 'nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:roles:bootstrap' in 'nodes' using delimiter ':'
[DEBUG   ] compound_match 10.0.2.15 ? "I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:bootstrap" => "False and False"
[DEBUG   ] LazyLoaded compound_match.match
[DEBUG   ] compound_match: 10.0.2.15 ? I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:etcd
[DEBUG   ] LazyLoaded pillar_match.match
[DEBUG   ] pillar target: metalk8s:nodes:10.0.2.15:version:2.6.0-dev
[DEBUG   ] Attempting to match '2.6.0-dev' in 'metalk8s:nodes:10.0.2.15:version' using delimiter ':'
[DEBUG   ] Attempting to match 'version:2.6.0-dev' in 'metalk8s:nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:version:2.6.0-dev' in 'metalk8s:nodes' using delimiter ':'
[DEBUG   ] Attempting to match 'nodes:10.0.2.15:version:2.6.0-dev' in 'metalk8s' using delimiter ':'
[DEBUG   ] Attempting to match '2.6.0-dev' in 'nodes:10.0.2.15:version' using delimiter ':'
[DEBUG   ] Attempting to match 'version:2.6.0-dev' in 'nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:version:2.6.0-dev' in 'nodes' using delimiter ':'
[DEBUG   ] pillar target: metalk8s:nodes:10.0.2.15:roles:etcd
[DEBUG   ] Attempting to match 'etcd' in 'metalk8s:nodes:10.0.2.15:roles' using delimiter ':'
[DEBUG   ] Attempting to match 'roles:etcd' in 'metalk8s:nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:roles:etcd' in 'metalk8s:nodes' using delimiter ':'
[DEBUG   ] Attempting to match 'nodes:10.0.2.15:roles:etcd' in 'metalk8s' using delimiter ':'
[DEBUG   ] Attempting to match 'etcd' in 'nodes:10.0.2.15:roles' using delimiter ':'
[DEBUG   ] Attempting to match 'roles:etcd' in 'nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:roles:etcd' in 'nodes' using delimiter ':'
[DEBUG   ] compound_match 10.0.2.15 ? "I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:etcd" => "False and False"
[DEBUG   ] LazyLoaded compound_match.match
[DEBUG   ] compound_match: 10.0.2.15 ? I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:master
[DEBUG   ] LazyLoaded pillar_match.match
[DEBUG   ] pillar target: metalk8s:nodes:10.0.2.15:version:2.6.0-dev
[DEBUG   ] Attempting to match '2.6.0-dev' in 'metalk8s:nodes:10.0.2.15:version' using delimiter ':'
[DEBUG   ] Attempting to match 'version:2.6.0-dev' in 'metalk8s:nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:version:2.6.0-dev' in 'metalk8s:nodes' using delimiter ':'
[DEBUG   ] Attempting to match 'nodes:10.0.2.15:version:2.6.0-dev' in 'metalk8s' using delimiter ':'
[DEBUG   ] Attempting to match '2.6.0-dev' in 'nodes:10.0.2.15:version' using delimiter ':'
[DEBUG   ] Attempting to match 'version:2.6.0-dev' in 'nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:version:2.6.0-dev' in 'nodes' using delimiter ':'
[DEBUG   ] pillar target: metalk8s:nodes:10.0.2.15:roles:master
[DEBUG   ] Attempting to match 'master' in 'metalk8s:nodes:10.0.2.15:roles' using delimiter ':'
[DEBUG   ] Attempting to match 'roles:master' in 'metalk8s:nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:roles:master' in 'metalk8s:nodes' using delimiter ':'
[DEBUG   ] Attempting to match 'nodes:10.0.2.15:roles:master' in 'metalk8s' using delimiter ':'
[DEBUG   ] Attempting to match 'master' in 'nodes:10.0.2.15:roles' using delimiter ':'
[DEBUG   ] Attempting to match 'roles:master' in 'nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:roles:master' in 'nodes' using delimiter ':'
[DEBUG   ] compound_match 10.0.2.15 ? "I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:master" => "False and False"
[DEBUG   ] LazyLoaded compound_match.match
[DEBUG   ] compound_match: 10.0.2.15 ? I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:node
[DEBUG   ] LazyLoaded pillar_match.match
[DEBUG   ] pillar target: metalk8s:nodes:10.0.2.15:version:2.6.0-dev
[DEBUG   ] Attempting to match '2.6.0-dev' in 'metalk8s:nodes:10.0.2.15:version' using delimiter ':'
[DEBUG   ] Attempting to match 'version:2.6.0-dev' in 'metalk8s:nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:version:2.6.0-dev' in 'metalk8s:nodes' using delimiter ':'
[DEBUG   ] Attempting to match 'nodes:10.0.2.15:version:2.6.0-dev' in 'metalk8s' using delimiter ':'
[DEBUG   ] Attempting to match '2.6.0-dev' in 'nodes:10.0.2.15:version' using delimiter ':'
[DEBUG   ] Attempting to match 'version:2.6.0-dev' in 'nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:version:2.6.0-dev' in 'nodes' using delimiter ':'
[DEBUG   ] pillar target: metalk8s:nodes:10.0.2.15:roles:node
[DEBUG   ] Attempting to match 'node' in 'metalk8s:nodes:10.0.2.15:roles' using delimiter ':'
[DEBUG   ] Attempting to match 'roles:node' in 'metalk8s:nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:roles:node' in 'metalk8s:nodes' using delimiter ':'
[DEBUG   ] Attempting to match 'nodes:10.0.2.15:roles:node' in 'metalk8s' using delimiter ':'
[DEBUG   ] Attempting to match 'node' in 'nodes:10.0.2.15:roles' using delimiter ':'
[DEBUG   ] Attempting to match 'roles:node' in 'nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:roles:node' in 'nodes' using delimiter ':'
[DEBUG   ] compound_match 10.0.2.15 ? "I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:node" => "False and False"
[DEBUG   ] compile template: /srv/scality/metalk8s-2.6.0-dev/pillar/metalk8s/roles/ca.sls
[DEBUG   ] Jinja search path: [u'/srv/scality/metalk8s-2.6.0-dev/pillar']
[PROFILE ] Time (in seconds) to render '/srv/scality/metalk8s-2.6.0-dev/pillar/metalk8s/roles/ca.sls' using 'jinja' renderer: 0.0032172203064
[DEBUG   ] Rendered data from file: /srv/scality/metalk8s-2.6.0-dev/pillar/metalk8s/roles/ca.sls:
mine_functions:
  kubernetes_root_ca_b64:
    - mine_function: hashutil.base64_encodefile
    - /etc/kubernetes/pki/ca.crt

  kubernetes_etcd_ca_b64:
    - mine_function: hashutil.base64_encodefile
    - /etc/kubernetes/pki/etcd/ca.crt

  kubernetes_front_proxy_ca_b64:
    - mine_function: hashutil.base64_encodefile
    - /etc/kubernetes/pki/front-proxy-ca.crt

  kubernetes_sa_pub_key_b64:
    - mine_function: hashutil.base64_encodefile
    - /etc/kubernetes/pki/sa.pub

  dex_ca_b64:
    - mine_function: hashutil.base64_encodefile
    - /etc/metalk8s/pki/dex/ca.crt

  ingress_ca_b64:
    - mine_function: hashutil.base64_encodefile
    - /etc/metalk8s/pki/nginx-ingress/ca.crt

x509_signing_policies:
  kube_apiserver_client_policy:
    - minions: '*'
    - signing_private_key: /etc/kubernetes/pki/ca.key
    - signing_cert: /etc/kubernetes/pki/ca.crt
    - keyUsage: critical digitalSignature, keyEncipherment
    - extendedKeyUsage: clientAuth
    - days_valid: 365
  kube_apiserver_server_policy:
    - minions: '*'
    - signing_private_key: /etc/kubernetes/pki/ca.key
    - signing_cert: /etc/kubernetes/pki/ca.crt
    - keyUsage: critical digitalSignature, keyEncipherment
    - extendedKeyUsage: serverAuth
    - days_valid: 365
  etcd_client_policy:
    - minions: '*'
    - signing_private_key: /etc/kubernetes/pki/etcd/ca.key
    - signing_cert: /etc/kubernetes/pki/etcd/ca.crt
    - keyUsage: critical digitalSignature, keyEncipherment
    - extendedKeyUsage: clientAuth
    - days_valid: 365
  etcd_server_client_policy:
    - minions: '*'
    - signing_private_key: /etc/kubernetes/pki/etcd/ca.key
    - signing_cert: /etc/kubernetes/pki/etcd/ca.crt
    - keyUsage: critical digitalSignature, keyEncipherment
    - extendedKeyUsage: serverAuth, clientAuth
    - days_valid: 365
  front_proxy_client_policy:
    - minions: '*'
    - signing_private_key: /etc/kubernetes/pki/front-proxy-ca.key
    - signing_cert: /etc/kubernetes/pki/front-proxy-ca.crt
    - keyUsage: critical digitalSignature, keyEncipherment
    - extendedKeyUsage: clientAuth
    - days_valid: 365
  ingress_server_policy:
    - minions: '*'
    - signing_private_key: /etc/metalk8s/pki/nginx-ingress/ca.key
    - signing_cert: /etc/metalk8s/pki/nginx-ingress/ca.crt
    - keyUsage: critical digitalSignature, keyEncipherment
    - extendedKeyUsage: serverAuth
    - days_valid: 365
  dex_server_policy:
    - minions: '*'
    - signing_private_key: /etc/metalk8s/pki/dex/ca.key
    - signing_cert: /etc/metalk8s/pki/dex/ca.crt
    - keyUsage: critical digitalSignature, keyEncipherment
    - extendedKeyUsage: serverAuth
    - days_valid: 365

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'mine_functions', OrderedDict([(u'kubernetes_root_ca_b64', [OrderedDict([(u'mine_function', u'hashutil.base64_encodefile')]), u'/etc/kubernetes/pki/ca.crt']), (u'kubernetes_etcd_ca_b64', [OrderedDict([(u'mine_function', u'hashutil.base64_encodefile')]), u'/etc/kubernetes/pki/etcd/ca.crt']), (u'kubernetes_front_proxy_ca_b64', [OrderedDict([(u'mine_function', u'hashutil.base64_encodefile')]), u'/etc/kubernetes/pki/front-proxy-ca.crt']), (u'kubernetes_sa_pub_key_b64', [OrderedDict([(u'mine_function', u'hashutil.base64_encodefile')]), u'/etc/kubernetes/pki/sa.pub']), (u'dex_ca_b64', [OrderedDict([(u'mine_function', u'hashutil.base64_encodefile')]), u'/etc/metalk8s/pki/dex/ca.crt']), (u'ingress_ca_b64', [OrderedDict([(u'mine_function', u'hashutil.base64_encodefile')]), u'/etc/metalk8s/pki/nginx-ingress/ca.crt'])])), (u'x509_signing_policies', OrderedDict([(u'kube_apiserver_client_policy', [OrderedDict([(u'minions', u'*')]), OrderedDict([(u'signing_private_key', u'/etc/kubernetes/pki/ca.key')]), OrderedDict([(u'signing_cert', u'/etc/kubernetes/pki/ca.crt')]), OrderedDict([(u'keyUsage', u'critical digitalSignature, keyEncipherment')]), OrderedDict([(u'extendedKeyUsage', u'clientAuth')]), OrderedDict([(u'days_valid', 365)])]), (u'kube_apiserver_server_policy', [OrderedDict([(u'minions', u'*')]), OrderedDict([(u'signing_private_key', u'/etc/kubernetes/pki/ca.key')]), OrderedDict([(u'signing_cert', u'/etc/kubernetes/pki/ca.crt')]), OrderedDict([(u'keyUsage', u'critical digitalSignature, keyEncipherment')]), OrderedDict([(u'extendedKeyUsage', u'serverAuth')]), OrderedDict([(u'days_valid', 365)])]), (u'etcd_client_policy', [OrderedDict([(u'minions', u'*')]), OrderedDict([(u'signing_private_key', u'/etc/kubernetes/pki/etcd/ca.key')]), OrderedDict([(u'signing_cert', u'/etc/kubernetes/pki/etcd/ca.crt')]), OrderedDict([(u'keyUsage', u'critical digitalSignature, keyEncipherment')]), OrderedDict([(u'extendedKeyUsage', u'clientAuth')]), OrderedDict([(u'days_valid', 365)])]), (u'etcd_server_client_policy', [OrderedDict([(u'minions', u'*')]), OrderedDict([(u'signing_private_key', u'/etc/kubernetes/pki/etcd/ca.key')]), OrderedDict([(u'signing_cert', u'/etc/kubernetes/pki/etcd/ca.crt')]), OrderedDict([(u'keyUsage', u'critical digitalSignature, keyEncipherment')]), OrderedDict([(u'extendedKeyUsage', u'serverAuth, clientAuth')]), OrderedDict([(u'days_valid', 365)])]), (u'front_proxy_client_policy', [OrderedDict([(u'minions', u'*')]), OrderedDict([(u'signing_private_key', u'/etc/kubernetes/pki/front-proxy-ca.key')]), OrderedDict([(u'signing_cert', u'/etc/kubernetes/pki/front-proxy-ca.crt')]), OrderedDict([(u'keyUsage', u'critical digitalSignature, keyEncipherment')]), OrderedDict([(u'extendedKeyUsage', u'clientAuth')]), OrderedDict([(u'days_valid', 365)])]), (u'ingress_server_policy', [OrderedDict([(u'minions', u'*')]), OrderedDict([(u'signing_private_key', u'/etc/metalk8s/pki/nginx-ingress/ca.key')]), OrderedDict([(u'signing_cert', u'/etc/metalk8s/pki/nginx-ingress/ca.crt')]), OrderedDict([(u'keyUsage', u'critical digitalSignature, keyEncipherment')]), OrderedDict([(u'extendedKeyUsage', u'serverAuth')]), OrderedDict([(u'days_valid', 365)])]), (u'dex_server_policy', [OrderedDict([(u'minions', u'*')]), OrderedDict([(u'signing_private_key', u'/etc/metalk8s/pki/dex/ca.key')]), OrderedDict([(u'signing_cert', u'/etc/metalk8s/pki/dex/ca.crt')]), OrderedDict([(u'keyUsage', u'critical digitalSignature, keyEncipherment')]), OrderedDict([(u'extendedKeyUsage', u'serverAuth')]), OrderedDict([(u'days_valid', 365)])])]))])
[PROFILE ] Time (in seconds) to render '/srv/scality/metalk8s-2.6.0-dev/pillar/metalk8s/roles/ca.sls' using 'yaml' renderer: 0.01176404953
[DEBUG   ] LazyLoaded jinja.render
[DEBUG   ] LazyLoaded yaml.render
[DEBUG   ] LazyLoaded state.sls
[DEBUG   ] LazyLoaded direct_call.execute
[DEBUG   ] LazyLoaded saltutil.is_running
[DEBUG   ] LazyLoaded grains.get
[DEBUG   ] LazyLoaded config.get
[DEBUG   ] key: test, ret: _|-
[DEBUG   ] Updating roots fileserver cache
[DEBUG   ] Returning file list from cache: age=2 cache_time=20 /var/cache/salt/minion/file_lists/roots/metalk8s-2.6.0-dev.p
[DEBUG   ] Gathering pillar data for state run
[DEBUG   ] Determining pillar cache
[DEBUG   ] LazyLoaded jinja.render
[DEBUG   ] LazyLoaded yaml.render
[DEBUG   ] compile template: /srv/scality/metalk8s-2.6.0-dev/pillar/top.sls
[DEBUG   ] Jinja search path: [u'/srv/scality/metalk8s-2.6.0-dev/pillar']
[PROFILE ] Time (in seconds) to render '/srv/scality/metalk8s-2.6.0-dev/pillar/top.sls' using 'jinja' renderer: 0.00492286682129
[DEBUG   ] Rendered data from file: /srv/scality/metalk8s-2.6.0-dev/pillar/top.sls:
# The mechanics of this file are very similar to those of `salt/top.sls(.in)`.
# Please refer to the comments in that file for more background.

metalk8s-2.6.0-dev:
  I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev:
    - match: compound
    - metalk8s.roles.minion

  # Specific case for ca as we need signing_policy at the very beginning
  I@metalk8s:ca:minion:10.0.2.15:
    - match: compound
    - metalk8s.roles.ca


  I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:bootstrap:
    - match: compound
    - metalk8s.roles.bootstrap

  I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:etcd:
    - match: compound
    - metalk8s.roles.etcd

  I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:master:
    - match: compound
    - metalk8s.roles.master

  I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:node:
    - match: compound
    - metalk8s.roles.node


[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'metalk8s-2.6.0-dev', OrderedDict([(u'I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev', [OrderedDict([(u'match', u'compound')]), u'metalk8s.roles.minion']), (u'I@metalk8s:ca:minion:10.0.2.15', [OrderedDict([(u'match', u'compound')]), u'metalk8s.roles.ca']), (u'I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:bootstrap', [OrderedDict([(u'match', u'compound')]), u'metalk8s.roles.bootstrap']), (u'I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:etcd', [OrderedDict([(u'match', u'compound')]), u'metalk8s.roles.etcd']), (u'I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:master', [OrderedDict([(u'match', u'compound')]), u'metalk8s.roles.master']), (u'I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:node', [OrderedDict([(u'match', u'compound')]), u'metalk8s.roles.node'])]))])
[PROFILE ] Time (in seconds) to render '/srv/scality/metalk8s-2.6.0-dev/pillar/top.sls' using 'yaml' renderer: 0.00121998786926
[DEBUG   ] LazyLoaded metalk8s.ext_pillar
[DEBUG   ] Loading MetalK8s configuration from /etc/metalk8s/bootstrap.yaml
[DEBUG   ] LazyLoaded pillar_utils.assert_equals
[DEBUG   ] LazyLoaded jinja.render
[DEBUG   ] LazyLoaded yaml.render
[DEBUG   ] LazyLoaded confirm_top.confirm_top
[DEBUG   ] LazyLoaded compound_match.match
[DEBUG   ] compound_match: 10.0.2.15 ? I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev
[DEBUG   ] LazyLoaded pillar_match.match
[DEBUG   ] pillar target: metalk8s:nodes:10.0.2.15:version:2.6.0-dev
[DEBUG   ] Attempting to match '2.6.0-dev' in 'metalk8s:nodes:10.0.2.15:version' using delimiter ':'
[DEBUG   ] Attempting to match 'version:2.6.0-dev' in 'metalk8s:nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:version:2.6.0-dev' in 'metalk8s:nodes' using delimiter ':'
[DEBUG   ] Attempting to match 'nodes:10.0.2.15:version:2.6.0-dev' in 'metalk8s' using delimiter ':'
[DEBUG   ] Attempting to match '2.6.0-dev' in 'nodes:10.0.2.15:version' using delimiter ':'
[DEBUG   ] Attempting to match 'version:2.6.0-dev' in 'nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:version:2.6.0-dev' in 'nodes' using delimiter ':'
[DEBUG   ] compound_match 10.0.2.15 ? "I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev" => "False"
[DEBUG   ] LazyLoaded compound_match.match
[DEBUG   ] compound_match: 10.0.2.15 ? I@metalk8s:ca:minion:10.0.2.15
[DEBUG   ] LazyLoaded pillar_match.match
[DEBUG   ] pillar target: metalk8s:ca:minion:10.0.2.15
[DEBUG   ] Attempting to match '10.0.2.15' in 'metalk8s:ca:minion' using delimiter ':'
[DEBUG   ] compound_match 10.0.2.15 ? "I@metalk8s:ca:minion:10.0.2.15" => "True"
[DEBUG   ] LazyLoaded compound_match.match
[DEBUG   ] compound_match: 10.0.2.15 ? I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:bootstrap
[DEBUG   ] LazyLoaded pillar_match.match
[DEBUG   ] pillar target: metalk8s:nodes:10.0.2.15:version:2.6.0-dev
[DEBUG   ] Attempting to match '2.6.0-dev' in 'metalk8s:nodes:10.0.2.15:version' using delimiter ':'
[DEBUG   ] Attempting to match 'version:2.6.0-dev' in 'metalk8s:nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:version:2.6.0-dev' in 'metalk8s:nodes' using delimiter ':'
[DEBUG   ] Attempting to match 'nodes:10.0.2.15:version:2.6.0-dev' in 'metalk8s' using delimiter ':'
[DEBUG   ] Attempting to match '2.6.0-dev' in 'nodes:10.0.2.15:version' using delimiter ':'
[DEBUG   ] Attempting to match 'version:2.6.0-dev' in 'nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:version:2.6.0-dev' in 'nodes' using delimiter ':'
[DEBUG   ] pillar target: metalk8s:nodes:10.0.2.15:roles:bootstrap
[DEBUG   ] Attempting to match 'bootstrap' in 'metalk8s:nodes:10.0.2.15:roles' using delimiter ':'
[DEBUG   ] Attempting to match 'roles:bootstrap' in 'metalk8s:nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:roles:bootstrap' in 'metalk8s:nodes' using delimiter ':'
[DEBUG   ] Attempting to match 'nodes:10.0.2.15:roles:bootstrap' in 'metalk8s' using delimiter ':'
[DEBUG   ] Attempting to match 'bootstrap' in 'nodes:10.0.2.15:roles' using delimiter ':'
[DEBUG   ] Attempting to match 'roles:bootstrap' in 'nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:roles:bootstrap' in 'nodes' using delimiter ':'
[DEBUG   ] compound_match 10.0.2.15 ? "I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:bootstrap" => "False and False"
[DEBUG   ] LazyLoaded compound_match.match
[DEBUG   ] compound_match: 10.0.2.15 ? I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:etcd
[DEBUG   ] LazyLoaded pillar_match.match
[DEBUG   ] pillar target: metalk8s:nodes:10.0.2.15:version:2.6.0-dev
[DEBUG   ] Attempting to match '2.6.0-dev' in 'metalk8s:nodes:10.0.2.15:version' using delimiter ':'
[DEBUG   ] Attempting to match 'version:2.6.0-dev' in 'metalk8s:nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:version:2.6.0-dev' in 'metalk8s:nodes' using delimiter ':'
[DEBUG   ] Attempting to match 'nodes:10.0.2.15:version:2.6.0-dev' in 'metalk8s' using delimiter ':'
[DEBUG   ] Attempting to match '2.6.0-dev' in 'nodes:10.0.2.15:version' using delimiter ':'
[DEBUG   ] Attempting to match 'version:2.6.0-dev' in 'nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:version:2.6.0-dev' in 'nodes' using delimiter ':'
[DEBUG   ] pillar target: metalk8s:nodes:10.0.2.15:roles:etcd
[DEBUG   ] Attempting to match 'etcd' in 'metalk8s:nodes:10.0.2.15:roles' using delimiter ':'
[DEBUG   ] Attempting to match 'roles:etcd' in 'metalk8s:nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:roles:etcd' in 'metalk8s:nodes' using delimiter ':'
[DEBUG   ] Attempting to match 'nodes:10.0.2.15:roles:etcd' in 'metalk8s' using delimiter ':'
[DEBUG   ] Attempting to match 'etcd' in 'nodes:10.0.2.15:roles' using delimiter ':'
[DEBUG   ] Attempting to match 'roles:etcd' in 'nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:roles:etcd' in 'nodes' using delimiter ':'
[DEBUG   ] compound_match 10.0.2.15 ? "I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:etcd" => "False and False"
[DEBUG   ] LazyLoaded compound_match.match
[DEBUG   ] compound_match: 10.0.2.15 ? I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:master
[DEBUG   ] LazyLoaded pillar_match.match
[DEBUG   ] pillar target: metalk8s:nodes:10.0.2.15:version:2.6.0-dev
[DEBUG   ] Attempting to match '2.6.0-dev' in 'metalk8s:nodes:10.0.2.15:version' using delimiter ':'
[DEBUG   ] Attempting to match 'version:2.6.0-dev' in 'metalk8s:nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:version:2.6.0-dev' in 'metalk8s:nodes' using delimiter ':'
[DEBUG   ] Attempting to match 'nodes:10.0.2.15:version:2.6.0-dev' in 'metalk8s' using delimiter ':'
[DEBUG   ] Attempting to match '2.6.0-dev' in 'nodes:10.0.2.15:version' using delimiter ':'
[DEBUG   ] Attempting to match 'version:2.6.0-dev' in 'nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:version:2.6.0-dev' in 'nodes' using delimiter ':'
[DEBUG   ] pillar target: metalk8s:nodes:10.0.2.15:roles:master
[DEBUG   ] Attempting to match 'master' in 'metalk8s:nodes:10.0.2.15:roles' using delimiter ':'
[DEBUG   ] Attempting to match 'roles:master' in 'metalk8s:nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:roles:master' in 'metalk8s:nodes' using delimiter ':'
[DEBUG   ] Attempting to match 'nodes:10.0.2.15:roles:master' in 'metalk8s' using delimiter ':'
[DEBUG   ] Attempting to match 'master' in 'nodes:10.0.2.15:roles' using delimiter ':'
[DEBUG   ] Attempting to match 'roles:master' in 'nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:roles:master' in 'nodes' using delimiter ':'
[DEBUG   ] compound_match 10.0.2.15 ? "I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:master" => "False and False"
[DEBUG   ] LazyLoaded compound_match.match
[DEBUG   ] compound_match: 10.0.2.15 ? I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:node
[DEBUG   ] LazyLoaded pillar_match.match
[DEBUG   ] pillar target: metalk8s:nodes:10.0.2.15:version:2.6.0-dev
[DEBUG   ] Attempting to match '2.6.0-dev' in 'metalk8s:nodes:10.0.2.15:version' using delimiter ':'
[DEBUG   ] Attempting to match 'version:2.6.0-dev' in 'metalk8s:nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:version:2.6.0-dev' in 'metalk8s:nodes' using delimiter ':'
[DEBUG   ] Attempting to match 'nodes:10.0.2.15:version:2.6.0-dev' in 'metalk8s' using delimiter ':'
[DEBUG   ] Attempting to match '2.6.0-dev' in 'nodes:10.0.2.15:version' using delimiter ':'
[DEBUG   ] Attempting to match 'version:2.6.0-dev' in 'nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:version:2.6.0-dev' in 'nodes' using delimiter ':'
[DEBUG   ] pillar target: metalk8s:nodes:10.0.2.15:roles:node
[DEBUG   ] Attempting to match 'node' in 'metalk8s:nodes:10.0.2.15:roles' using delimiter ':'
[DEBUG   ] Attempting to match 'roles:node' in 'metalk8s:nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:roles:node' in 'metalk8s:nodes' using delimiter ':'
[DEBUG   ] Attempting to match 'nodes:10.0.2.15:roles:node' in 'metalk8s' using delimiter ':'
[DEBUG   ] Attempting to match 'node' in 'nodes:10.0.2.15:roles' using delimiter ':'
[DEBUG   ] Attempting to match 'roles:node' in 'nodes:10.0.2.15' using delimiter ':'
[DEBUG   ] Attempting to match '10.0.2.15:roles:node' in 'nodes' using delimiter ':'
[DEBUG   ] compound_match 10.0.2.15 ? "I@metalk8s:nodes:10.0.2.15:version:2.6.0-dev and I@metalk8s:nodes:10.0.2.15:roles:node" => "False and False"
[DEBUG   ] compile template: /srv/scality/metalk8s-2.6.0-dev/pillar/metalk8s/roles/ca.sls
[DEBUG   ] Jinja search path: [u'/srv/scality/metalk8s-2.6.0-dev/pillar']
[PROFILE ] Time (in seconds) to render '/srv/scality/metalk8s-2.6.0-dev/pillar/metalk8s/roles/ca.sls' using 'jinja' renderer: 0.00233602523804
[DEBUG   ] Rendered data from file: /srv/scality/metalk8s-2.6.0-dev/pillar/metalk8s/roles/ca.sls:
mine_functions:
  kubernetes_root_ca_b64:
    - mine_function: hashutil.base64_encodefile
    - /etc/kubernetes/pki/ca.crt

  kubernetes_etcd_ca_b64:
    - mine_function: hashutil.base64_encodefile
    - /etc/kubernetes/pki/etcd/ca.crt

  kubernetes_front_proxy_ca_b64:
    - mine_function: hashutil.base64_encodefile
    - /etc/kubernetes/pki/front-proxy-ca.crt

  kubernetes_sa_pub_key_b64:
    - mine_function: hashutil.base64_encodefile
    - /etc/kubernetes/pki/sa.pub

  dex_ca_b64:
    - mine_function: hashutil.base64_encodefile
    - /etc/metalk8s/pki/dex/ca.crt

  ingress_ca_b64:
    - mine_function: hashutil.base64_encodefile
    - /etc/metalk8s/pki/nginx-ingress/ca.crt

x509_signing_policies:
  kube_apiserver_client_policy:
    - minions: '*'
    - signing_private_key: /etc/kubernetes/pki/ca.key
    - signing_cert: /etc/kubernetes/pki/ca.crt
    - keyUsage: critical digitalSignature, keyEncipherment
    - extendedKeyUsage: clientAuth
    - days_valid: 365
  kube_apiserver_server_policy:
    - minions: '*'
    - signing_private_key: /etc/kubernetes/pki/ca.key
    - signing_cert: /etc/kubernetes/pki/ca.crt
    - keyUsage: critical digitalSignature, keyEncipherment
    - extendedKeyUsage: serverAuth
    - days_valid: 365
  etcd_client_policy:
    - minions: '*'
    - signing_private_key: /etc/kubernetes/pki/etcd/ca.key
    - signing_cert: /etc/kubernetes/pki/etcd/ca.crt
    - keyUsage: critical digitalSignature, keyEncipherment
    - extendedKeyUsage: clientAuth
    - days_valid: 365
  etcd_server_client_policy:
    - minions: '*'
    - signing_private_key: /etc/kubernetes/pki/etcd/ca.key
    - signing_cert: /etc/kubernetes/pki/etcd/ca.crt
    - keyUsage: critical digitalSignature, keyEncipherment
    - extendedKeyUsage: serverAuth, clientAuth
    - days_valid: 365
  front_proxy_client_policy:
    - minions: '*'
    - signing_private_key: /etc/kubernetes/pki/front-proxy-ca.key
    - signing_cert: /etc/kubernetes/pki/front-proxy-ca.crt
    - keyUsage: critical digitalSignature, keyEncipherment
    - extendedKeyUsage: clientAuth
    - days_valid: 365
  ingress_server_policy:
    - minions: '*'
    - signing_private_key: /etc/metalk8s/pki/nginx-ingress/ca.key
    - signing_cert: /etc/metalk8s/pki/nginx-ingress/ca.crt
    - keyUsage: critical digitalSignature, keyEncipherment
    - extendedKeyUsage: serverAuth
    - days_valid: 365
  dex_server_policy:
    - minions: '*'
    - signing_private_key: /etc/metalk8s/pki/dex/ca.key
    - signing_cert: /etc/metalk8s/pki/dex/ca.crt
    - keyUsage: critical digitalSignature, keyEncipherment
    - extendedKeyUsage: serverAuth
    - days_valid: 365

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'mine_functions', OrderedDict([(u'kubernetes_root_ca_b64', [OrderedDict([(u'mine_function', u'hashutil.base64_encodefile')]), u'/etc/kubernetes/pki/ca.crt']), (u'kubernetes_etcd_ca_b64', [OrderedDict([(u'mine_function', u'hashutil.base64_encodefile')]), u'/etc/kubernetes/pki/etcd/ca.crt']), (u'kubernetes_front_proxy_ca_b64', [OrderedDict([(u'mine_function', u'hashutil.base64_encodefile')]), u'/etc/kubernetes/pki/front-proxy-ca.crt']), (u'kubernetes_sa_pub_key_b64', [OrderedDict([(u'mine_function', u'hashutil.base64_encodefile')]), u'/etc/kubernetes/pki/sa.pub']), (u'dex_ca_b64', [OrderedDict([(u'mine_function', u'hashutil.base64_encodefile')]), u'/etc/metalk8s/pki/dex/ca.crt']), (u'ingress_ca_b64', [OrderedDict([(u'mine_function', u'hashutil.base64_encodefile')]), u'/etc/metalk8s/pki/nginx-ingress/ca.crt'])])), (u'x509_signing_policies', OrderedDict([(u'kube_apiserver_client_policy', [OrderedDict([(u'minions', u'*')]), OrderedDict([(u'signing_private_key', u'/etc/kubernetes/pki/ca.key')]), OrderedDict([(u'signing_cert', u'/etc/kubernetes/pki/ca.crt')]), OrderedDict([(u'keyUsage', u'critical digitalSignature, keyEncipherment')]), OrderedDict([(u'extendedKeyUsage', u'clientAuth')]), OrderedDict([(u'days_valid', 365)])]), (u'kube_apiserver_server_policy', [OrderedDict([(u'minions', u'*')]), OrderedDict([(u'signing_private_key', u'/etc/kubernetes/pki/ca.key')]), OrderedDict([(u'signing_cert', u'/etc/kubernetes/pki/ca.crt')]), OrderedDict([(u'keyUsage', u'critical digitalSignature, keyEncipherment')]), OrderedDict([(u'extendedKeyUsage', u'serverAuth')]), OrderedDict([(u'days_valid', 365)])]), (u'etcd_client_policy', [OrderedDict([(u'minions', u'*')]), OrderedDict([(u'signing_private_key', u'/etc/kubernetes/pki/etcd/ca.key')]), OrderedDict([(u'signing_cert', u'/etc/kubernetes/pki/etcd/ca.crt')]), OrderedDict([(u'keyUsage', u'critical digitalSignature, keyEncipherment')]), OrderedDict([(u'extendedKeyUsage', u'clientAuth')]), OrderedDict([(u'days_valid', 365)])]), (u'etcd_server_client_policy', [OrderedDict([(u'minions', u'*')]), OrderedDict([(u'signing_private_key', u'/etc/kubernetes/pki/etcd/ca.key')]), OrderedDict([(u'signing_cert', u'/etc/kubernetes/pki/etcd/ca.crt')]), OrderedDict([(u'keyUsage', u'critical digitalSignature, keyEncipherment')]), OrderedDict([(u'extendedKeyUsage', u'serverAuth, clientAuth')]), OrderedDict([(u'days_valid', 365)])]), (u'front_proxy_client_policy', [OrderedDict([(u'minions', u'*')]), OrderedDict([(u'signing_private_key', u'/etc/kubernetes/pki/front-proxy-ca.key')]), OrderedDict([(u'signing_cert', u'/etc/kubernetes/pki/front-proxy-ca.crt')]), OrderedDict([(u'keyUsage', u'critical digitalSignature, keyEncipherment')]), OrderedDict([(u'extendedKeyUsage', u'clientAuth')]), OrderedDict([(u'days_valid', 365)])]), (u'ingress_server_policy', [OrderedDict([(u'minions', u'*')]), OrderedDict([(u'signing_private_key', u'/etc/metalk8s/pki/nginx-ingress/ca.key')]), OrderedDict([(u'signing_cert', u'/etc/metalk8s/pki/nginx-ingress/ca.crt')]), OrderedDict([(u'keyUsage', u'critical digitalSignature, keyEncipherment')]), OrderedDict([(u'extendedKeyUsage', u'serverAuth')]), OrderedDict([(u'days_valid', 365)])]), (u'dex_server_policy', [OrderedDict([(u'minions', u'*')]), OrderedDict([(u'signing_private_key', u'/etc/metalk8s/pki/dex/ca.key')]), OrderedDict([(u'signing_cert', u'/etc/metalk8s/pki/dex/ca.crt')]), OrderedDict([(u'keyUsage', u'critical digitalSignature, keyEncipherment')]), OrderedDict([(u'extendedKeyUsage', u'serverAuth')]), OrderedDict([(u'days_valid', 365)])])]))])
[PROFILE ] Time (in seconds) to render '/srv/scality/metalk8s-2.6.0-dev/pillar/metalk8s/roles/ca.sls' using 'yaml' renderer: 0.00472211837769
[DEBUG   ] Finished gathering pillar data for state run
[INFO    ] Loading fresh modules for state activity
[DEBUG   ] LazyLoaded jinja.render
[DEBUG   ] LazyLoaded yaml.render
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/roles/internal/early-stage-bootstrap.sls' to resolve 'salt://metalk8s/roles/internal/early-stage-bootstrap.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/roles/internal/early-stage-bootstrap.sls' to resolve 'salt://metalk8s/roles/internal/early-stage-bootstrap.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/roles/internal/early-stage-bootstrap.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/roles/internal/early-stage-bootstrap.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/roles/internal/early-stage-bootstrap.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/roles/internal/early-stage-bootstrap.sls' using 'jinja' renderer: 0.0224039554596
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/roles/internal/early-stage-bootstrap.sls:
include:
  - metalk8s.kubernetes.ca.kubernetes.installed
  - metalk8s.roles.bootstrap.local
  - metalk8s.roles.minion

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'include', [u'metalk8s.kubernetes.ca.kubernetes.installed', u'metalk8s.roles.bootstrap.local', u'metalk8s.roles.minion'])])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/roles/internal/early-stage-bootstrap.sls' using 'yaml' renderer: 0.000895977020264
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/kubernetes/ca/kubernetes/installed.sls' to resolve 'salt://metalk8s/kubernetes/ca/kubernetes/installed.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubernetes/ca/kubernetes/installed.sls' to resolve 'salt://metalk8s/kubernetes/ca/kubernetes/installed.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/kubernetes/ca/kubernetes/installed.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/kubernetes/ca/kubernetes/installed.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubernetes/ca/kubernetes/installed.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[DEBUG   ] LazyLoaded grains.filter_by
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubernetes/ca/kubernetes/installed.sls' using 'jinja' renderer: 0.0845069885254
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubernetes/ca/kubernetes/installed.sls:


include:
  - metalk8s.internal.m2crypto

Create CA private key:
  x509.private_key_managed:
    - name: /etc/kubernetes/pki/ca.key
    - bits: 4096
    - verbose: False
    - user: root
    - group: root
    - mode: 600
    - makedirs: True
    - dir_mode: 755
    - require:
      - metalk8s_package_manager: Install m2crypto
    - unless:
      - test -f "/etc/kubernetes/pki/ca.key"

Generate CA certificate:
  x509.certificate_managed:
    - name: /etc/kubernetes/pki/ca.crt
    - signing_private_key: /etc/kubernetes/pki/ca.key
    - CN: kubernetes
    - keyUsage: "critical digitalSignature, keyEncipherment, keyCertSign"
    - basicConstraints: "critical CA:true"
    - days_valid: 3650
    - user: root
    - group: root
    - mode: 644
    - makedirs: True
    - dir_mode: 755
    - require:
      - x509: Create CA private key

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'include', [u'metalk8s.internal.m2crypto']), (u'Create CA private key', OrderedDict([(u'x509.private_key_managed', [OrderedDict([(u'name', u'/etc/kubernetes/pki/ca.key')]), OrderedDict([(u'bits', 4096)]), OrderedDict([(u'verbose', False)]), OrderedDict([(u'user', u'root')]), OrderedDict([(u'group', u'root')]), OrderedDict([(u'mode', 600)]), OrderedDict([(u'makedirs', True)]), OrderedDict([(u'dir_mode', 755)]), OrderedDict([(u'require', [OrderedDict([(u'metalk8s_package_manager', u'Install m2crypto')])])]), OrderedDict([(u'unless', [u'test -f "/etc/kubernetes/pki/ca.key"'])])])])), (u'Generate CA certificate', OrderedDict([(u'x509.certificate_managed', [OrderedDict([(u'name', u'/etc/kubernetes/pki/ca.crt')]), OrderedDict([(u'signing_private_key', u'/etc/kubernetes/pki/ca.key')]), OrderedDict([(u'CN', u'kubernetes')]), OrderedDict([(u'keyUsage', u'critical digitalSignature, keyEncipherment, keyCertSign')]), OrderedDict([(u'basicConstraints', u'critical CA:true')]), OrderedDict([(u'days_valid', 3650)]), OrderedDict([(u'user', u'root')]), OrderedDict([(u'group', u'root')]), OrderedDict([(u'mode', 644)]), OrderedDict([(u'makedirs', True)]), OrderedDict([(u'dir_mode', 755)]), OrderedDict([(u'require', [OrderedDict([(u'x509', u'Create CA private key')])])])])]))])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubernetes/ca/kubernetes/installed.sls' using 'yaml' renderer: 0.00204992294312
[DEBUG   ] Could not find file 'salt://metalk8s/internal/m2crypto.sls' in saltenv 'metalk8s-2.6.0-dev'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/internal/m2crypto/init.sls' to resolve 'salt://metalk8s/internal/m2crypto/init.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/internal/m2crypto/init.sls' to resolve 'salt://metalk8s/internal/m2crypto/init.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/internal/m2crypto/init.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/internal/m2crypto/init.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/internal/m2crypto/init.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/internal/m2crypto/init.sls' using 'jinja' renderer: 0.000852823257446
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/internal/m2crypto/init.sls:
#
# Install m2crypto to manage x509 certs
#
# Available states
# ================
#
# * installed   -> Install m2crypto
# * absent      -> Uninstall m2crypto
#
include:
  - .installed

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'include', [u'.installed'])])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/internal/m2crypto/init.sls' using 'yaml' renderer: 0.000478029251099
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/internal/m2crypto/installed.sls' to resolve 'salt://metalk8s/internal/m2crypto/installed.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/internal/m2crypto/installed.sls' to resolve 'salt://metalk8s/internal/m2crypto/installed.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/internal/m2crypto/installed.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/internal/m2crypto/installed.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/internal/m2crypto/installed.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/macro.sls' to resolve 'salt://metalk8s/macro.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/macro.sls' to resolve 'salt://metalk8s/macro.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/macro.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/macro.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/internal/m2crypto/installed.sls' using 'jinja' renderer: 0.07408618927
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/internal/m2crypto/installed.sls:


include:
  - metalk8s.repo

Install m2crypto:
  
  metalk8s_package_manager.installed:
    - name: m2crypto
    - pkgs_info: {"kubectl": {"version": "1.17.9"}, "xfsprogs": {"version": null}, "httpd-tools": {"version": null}, "iproute": {"version": null}, "sos": {"version": null}, "yum-plugin-versionlock": {"version": null}, "socat": {"version": null}, "containerd": {"version": "1.2.13-2.el7"}, "coreutils": {"version": null}, "container-selinux": {"version": null}, "iptables": {"version": null}, "ebtables": {"version": null}, "salt-minion": {"version": "3000.3"}, "calico-cni-plugin": {"version": "3.12.0-1.el7"}, "yum-utils": {"version": null}, "kubelet": {"version": "1.17.9"}, "m2crypto": {"version": null}, "genisoimage": {"version": null}, "util-linux": {"version": null}, "metalk8s-sosreport": {"version": "2.6-1.el7"}, "cri-tools": {"version": null}, "ethtool": {"version": null}, "e2fsprogs": {"version": null}, "runc": {"version": null}, "kubernetes-cni": {"version": null}}
    - reload_modules: True
    - require:
      - test: Repositories configured

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'include', [u'metalk8s.repo']), (u'Install m2crypto', OrderedDict([(u'metalk8s_package_manager.installed', [OrderedDict([(u'name', u'm2crypto')]), OrderedDict([(u'pkgs_info', OrderedDict([(u'kubectl', OrderedDict([(u'version', u'1.17.9')])), (u'xfsprogs', OrderedDict([(u'version', None)])), (u'httpd-tools', OrderedDict([(u'version', None)])), (u'iproute', OrderedDict([(u'version', None)])), (u'sos', OrderedDict([(u'version', None)])), (u'yum-plugin-versionlock', OrderedDict([(u'version', None)])), (u'socat', OrderedDict([(u'version', None)])), (u'containerd', OrderedDict([(u'version', u'1.2.13-2.el7')])), (u'coreutils', OrderedDict([(u'version', None)])), (u'container-selinux', OrderedDict([(u'version', None)])), (u'iptables', OrderedDict([(u'version', None)])), (u'ebtables', OrderedDict([(u'version', None)])), (u'salt-minion', OrderedDict([(u'version', u'3000.3')])), (u'calico-cni-plugin', OrderedDict([(u'version', u'3.12.0-1.el7')])), (u'yum-utils', OrderedDict([(u'version', None)])), (u'kubelet', OrderedDict([(u'version', u'1.17.9')])), (u'm2crypto', OrderedDict([(u'version', None)])), (u'genisoimage', OrderedDict([(u'version', None)])), (u'util-linux', OrderedDict([(u'version', None)])), (u'metalk8s-sosreport', OrderedDict([(u'version', u'2.6-1.el7')])), (u'cri-tools', OrderedDict([(u'version', None)])), (u'ethtool', OrderedDict([(u'version', None)])), (u'e2fsprogs', OrderedDict([(u'version', None)])), (u'runc', OrderedDict([(u'version', None)])), (u'kubernetes-cni', OrderedDict([(u'version', None)]))]))]), OrderedDict([(u'reload_modules', True)]), OrderedDict([(u'require', [OrderedDict([(u'test', u'Repositories configured')])])])])]))])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/internal/m2crypto/installed.sls' using 'yaml' renderer: 0.00337600708008
[DEBUG   ] Could not find file 'salt://metalk8s/repo.sls' in saltenv 'metalk8s-2.6.0-dev'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/repo/init.sls' to resolve 'salt://metalk8s/repo/init.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/repo/init.sls' to resolve 'salt://metalk8s/repo/init.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/repo/init.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/repo/init.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/repo/init.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/repo/init.sls' using 'jinja' renderer: 0.00188493728638
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/repo/init.sls:
include:
  - .redhat

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'include', [u'.redhat'])])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/repo/init.sls' using 'yaml' renderer: 0.000715970993042
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/repo/redhat.sls' to resolve 'salt://metalk8s/repo/redhat.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/repo/redhat.sls' to resolve 'salt://metalk8s/repo/redhat.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/repo/redhat.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[WARNING ] Skip, invalid archive path /metalk8s.iso, should be an iso or a directory.
[ERROR   ] Rendering exception occurred
Traceback (most recent call last):
  File "/usr/lib/python2.7/site-packages/salt/utils/templates.py", line 169, in render_tmpl
    output = render_str(tmplstr, context, tmplpath)
  File "/usr/lib/python2.7/site-packages/salt/utils/templates.py", line 404, in render_jinja_tmpl
    buf=tmplstr)
SaltRenderError: Jinja variable 'dict object' has no attribute u'metalk8s-2.6.0-dev'
[CRITICAL] Rendering SLS 'metalk8s-2.6.0-dev:metalk8s.repo.redhat' failed: Jinja variable 'dict object' has no attribute u'metalk8s-2.6.0-dev'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/roles/bootstrap/local.sls' to resolve 'salt://metalk8s/roles/bootstrap/local.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/roles/bootstrap/local.sls' to resolve 'salt://metalk8s/roles/bootstrap/local.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/roles/bootstrap/local.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/roles/bootstrap/local.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/roles/bootstrap/local.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/roles/bootstrap/local.sls' using 'jinja' renderer: 0.000948905944824
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/roles/bootstrap/local.sls:
include:
  - metalk8s.archives.mounted
  - metalk8s.kubernetes.kubelet.standalone
  - metalk8s.internal.preflight
  - metalk8s.repo.installed
  - metalk8s.salt.master.certs.salt-api
  - metalk8s.salt.master.configured
  - metalk8s.salt.master.installed
  - metalk8s.kubectl

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'include', [u'metalk8s.archives.mounted', u'metalk8s.kubernetes.kubelet.standalone', u'metalk8s.internal.preflight', u'metalk8s.repo.installed', u'metalk8s.salt.master.certs.salt-api', u'metalk8s.salt.master.configured', u'metalk8s.salt.master.installed', u'metalk8s.kubectl'])])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/roles/bootstrap/local.sls' using 'yaml' renderer: 0.000586986541748
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/archives/mounted.sls' to resolve 'salt://metalk8s/archives/mounted.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/archives/mounted.sls' to resolve 'salt://metalk8s/archives/mounted.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/archives/mounted.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/archives/mounted.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/archives/mounted.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[WARNING ] Skip, invalid archive path /metalk8s.iso, should be an iso or a directory.
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/archives/mounted.sls' using 'jinja' renderer: 0.00701093673706
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/archives/mounted.sls:
include:
  - metalk8s.salt.minion.local

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'include', [u'metalk8s.salt.minion.local'])])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/archives/mounted.sls' using 'yaml' renderer: 0.00088906288147
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/salt/minion/local.sls' to resolve 'salt://metalk8s/salt/minion/local.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/minion/local.sls' to resolve 'salt://metalk8s/salt/minion/local.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/salt/minion/local.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/salt/minion/local.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/minion/local.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[WARNING ] Skip, invalid archive path /metalk8s.iso, should be an iso or a directory.
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/minion/local.sls' using 'jinja' renderer: 0.0586450099945
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/minion/local.sls:


Configure salt minion for local mode:
  file.serialize:
    - name: /etc/salt/minion.d/99-metalk8s-local.conf
    - user: root
    - group: root
    - mode: '0644'
    - formatter: yaml
    - makedirs: true
    - backup: false
    - dataset:
        log_level_logfile: info
        file_roots:
        pillar_roots:
        use_superseded:
          - module.run
        ext_pillar_first: true
        ext_pillar:
          - metalk8s: /etc/metalk8s/bootstrap.yaml
        retry_dns_count: 3

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'Configure salt minion for local mode', OrderedDict([(u'file.serialize', [OrderedDict([(u'name', u'/etc/salt/minion.d/99-metalk8s-local.conf')]), OrderedDict([(u'user', u'root')]), OrderedDict([(u'group', u'root')]), OrderedDict([(u'mode', u'0644')]), OrderedDict([(u'formatter', u'yaml')]), OrderedDict([(u'makedirs', True)]), OrderedDict([(u'backup', False)]), OrderedDict([(u'dataset', OrderedDict([(u'log_level_logfile', u'info'), (u'file_roots', None), (u'pillar_roots', None), (u'use_superseded', [u'module.run']), (u'ext_pillar_first', True), (u'ext_pillar', [OrderedDict([(u'metalk8s', u'/etc/metalk8s/bootstrap.yaml')])]), (u'retry_dns_count', 3)]))])])]))])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/minion/local.sls' using 'yaml' renderer: 0.00200700759888
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/kubernetes/kubelet/standalone.sls' to resolve 'salt://metalk8s/kubernetes/kubelet/standalone.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubernetes/kubelet/standalone.sls' to resolve 'salt://metalk8s/kubernetes/kubelet/standalone.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/kubernetes/kubelet/standalone.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/kubernetes/kubelet/standalone.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubernetes/kubelet/standalone.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubernetes/kubelet/standalone.sls' using 'jinja' renderer: 0.0662860870361
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubernetes/kubelet/standalone.sls:


include:
  - .running

Create kubelet service environment file:
  file.managed:
    - name: "/var/lib/kubelet/kubeadm-flags.env"
    - source: salt://metalk8s/kubernetes/kubelet/files/kubeadm.env
    - template: jinja
    - user: root
    - group: root
    - mode: 644
    - makedirs: True
    - dir_mode: 750
    - context:
    - context:
        options:
          container-runtime-endpoint: unix:///run/containerd/containerd.sock
          container-runtime: remote
          resolv-conf: /etc/resolv.conf
          node-ip: 10.0.3.15
          hostname-override: 10.0.2.15
          v: 0
    - require:
      - metalk8s_package_manager: Install kubelet
    - watch_in:
      - service: Ensure kubelet running

Create kubelet config file:
  file.serialize:
    - name: "/var/lib/kubelet/config.yaml"
    - user: root
    - group: root
    - mode: 644
    - makedirs: True
    - dir_mode: 750
    - formatter: yaml
    - dataset:
        address: 10.0.3.15
        kind: KubeletConfiguration
        apiVersion: kubelet.config.k8s.io/v1beta1
        staticPodPath: /etc/kubernetes/manifests
        authentication:
          anonymous:
            enabled: false
          webhook:
            cacheTTL: 2m0s
            enabled: true
          x509:
            clientCAFile: /etc/kubernetes/pki/ca.crt
        authorization:
          mode: Webhook
          webhook:
            cacheAuthorizedTTL: 5m0s
            cacheUnauthorizedTTL: 30s
        cgroupDriver: cgroupfs
        cgroupsPerQOS: true
        clusterDNS:
          - 192.168.128.10
        clusterDomain: cluster.local
        configMapAndSecretChangeDetectionStrategy: Watch
        containerLogMaxFiles: 5
        containerLogMaxSize: 10Mi
        contentType: application/vnd.kubernetes.protobuf
        cpuCFSQuota: true
        cpuCFSQuotaPeriod: 100ms
        cpuManagerPolicy: none
        cpuManagerReconcilePeriod: 10s
        enableControllerAttachDetach: true
        enableDebuggingHandlers: true
        enforceNodeAllocatable:
          - pods
        eventBurst: 10
        eventRecordQPS: 5
        evictionHard:
          imagefs.available: 15%
          memory.available: 100Mi
          nodefs.available: 10%
          nodefs.inodesFree: 5%
        evictionPressureTransitionPeriod: 5m0s
        failSwapOn: true
        fileCheckFrequency: 20s
        hairpinMode: promiscuous-bridge
        healthzBindAddress: 127.0.0.1
        healthzPort: 10248
        httpCheckFrequency: 20s
        imageGCHighThresholdPercent: 85
        imageGCLowThresholdPercent: 80
        imageMinimumGCAge: 2m0s
        iptablesDropBit: 15
        iptablesMasqueradeBit: 14
        kubeAPIBurst: 10
        kubeAPIQPS: 5
        makeIPTablesUtilChains: true
        maxOpenFiles: 1000000
        maxPods: 110
        nodeLeaseDurationSeconds: 40
        nodeStatusReportFrequency: 1m0s
        nodeStatusUpdateFrequency: 10s
        oomScoreAdj: -999
        podPidsLimit: -1
        port: 10250
        registryBurst: 10
        registryPullQPS: 5
        resolvConf: /etc/resolv.conf
        rotateCertificates: true
        runtimeRequestTimeout: 2m0s
        serializeImagePulls: true
        streamingConnectionIdleTimeout: 4h0m0s
        syncFrequency: 1m0s
        volumeStatsAggPeriod: 1m0s
    - require:
      - metalk8s_package_manager: Install kubelet
    - watch_in:
      - service: Ensure kubelet running

Configure kubelet service as standalone:
  file.managed:
    - name: /etc/systemd/system/kubelet.service.d/09-standalone.conf
    - source: salt://metalk8s/kubernetes/kubelet/files/service-standalone-systemd.conf
    - template: jinja
    - user: root
    - group: root
    - mode: 644
    - makedirs: True
    - dir_mode: 755
    - context:
        env_file: "/var/lib/kubelet/kubeadm-flags.env"
        manifest_path: "/etc/kubernetes/manifests"
    - require:
      - file: Create kubelet service environment file
      - file: Create kubelet config file
    - watch_in:
      - service: Ensure kubelet running

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'include', [u'.running']), (u'Create kubelet service environment file', OrderedDict([(u'file.managed', [OrderedDict([(u'name', u'/var/lib/kubelet/kubeadm-flags.env')]), OrderedDict([(u'source', u'salt://metalk8s/kubernetes/kubelet/files/kubeadm.env')]), OrderedDict([(u'template', u'jinja')]), OrderedDict([(u'user', u'root')]), OrderedDict([(u'group', u'root')]), OrderedDict([(u'mode', 644)]), OrderedDict([(u'makedirs', True)]), OrderedDict([(u'dir_mode', 750)]), OrderedDict([(u'context', None)]), OrderedDict([(u'context', OrderedDict([(u'options', OrderedDict([(u'container-runtime-endpoint', u'unix:///run/containerd/containerd.sock'), (u'container-runtime', u'remote'), (u'resolv-conf', u'/etc/resolv.conf'), (u'node-ip', u'10.0.3.15'), (u'hostname-override', u'10.0.2.15'), (u'v', 0)]))]))]), OrderedDict([(u'require', [OrderedDict([(u'metalk8s_package_manager', u'Install kubelet')])])]), OrderedDict([(u'watch_in', [OrderedDict([(u'service', u'Ensure kubelet running')])])])])])), (u'Create kubelet config file', OrderedDict([(u'file.serialize', [OrderedDict([(u'name', u'/var/lib/kubelet/config.yaml')]), OrderedDict([(u'user', u'root')]), OrderedDict([(u'group', u'root')]), OrderedDict([(u'mode', 644)]), OrderedDict([(u'makedirs', True)]), OrderedDict([(u'dir_mode', 750)]), OrderedDict([(u'formatter', u'yaml')]), OrderedDict([(u'dataset', OrderedDict([(u'address', u'10.0.3.15'), (u'kind', u'KubeletConfiguration'), (u'apiVersion', u'kubelet.config.k8s.io/v1beta1'), (u'staticPodPath', u'/etc/kubernetes/manifests'), (u'authentication', OrderedDict([(u'anonymous', OrderedDict([(u'enabled', False)])), (u'webhook', OrderedDict([(u'cacheTTL', u'2m0s'), (u'enabled', True)])), (u'x509', OrderedDict([(u'clientCAFile', u'/etc/kubernetes/pki/ca.crt')]))])), (u'authorization', OrderedDict([(u'mode', u'Webhook'), (u'webhook', OrderedDict([(u'cacheAuthorizedTTL', u'5m0s'), (u'cacheUnauthorizedTTL', u'30s')]))])), (u'cgroupDriver', u'cgroupfs'), (u'cgroupsPerQOS', True), (u'clusterDNS', [u'192.168.128.10']), (u'clusterDomain', u'cluster.local'), (u'configMapAndSecretChangeDetectionStrategy', u'Watch'), (u'containerLogMaxFiles', 5), (u'containerLogMaxSize', u'10Mi'), (u'contentType', u'application/vnd.kubernetes.protobuf'), (u'cpuCFSQuota', True), (u'cpuCFSQuotaPeriod', u'100ms'), (u'cpuManagerPolicy', u'none'), (u'cpuManagerReconcilePeriod', u'10s'), (u'enableControllerAttachDetach', True), (u'enableDebuggingHandlers', True), (u'enforceNodeAllocatable', [u'pods']), (u'eventBurst', 10), (u'eventRecordQPS', 5), (u'evictionHard', OrderedDict([(u'imagefs.available', u'15%'), (u'memory.available', u'100Mi'), (u'nodefs.available', u'10%'), (u'nodefs.inodesFree', u'5%')])), (u'evictionPressureTransitionPeriod', u'5m0s'), (u'failSwapOn', True), (u'fileCheckFrequency', u'20s'), (u'hairpinMode', u'promiscuous-bridge'), (u'healthzBindAddress', u'127.0.0.1'), (u'healthzPort', 10248), (u'httpCheckFrequency', u'20s'), (u'imageGCHighThresholdPercent', 85), (u'imageGCLowThresholdPercent', 80), (u'imageMinimumGCAge', u'2m0s'), (u'iptablesDropBit', 15), (u'iptablesMasqueradeBit', 14), (u'kubeAPIBurst', 10), (u'kubeAPIQPS', 5), (u'makeIPTablesUtilChains', True), (u'maxOpenFiles', 1000000), (u'maxPods', 110), (u'nodeLeaseDurationSeconds', 40), (u'nodeStatusReportFrequency', u'1m0s'), (u'nodeStatusUpdateFrequency', u'10s'), (u'oomScoreAdj', -999), (u'podPidsLimit', -1), (u'port', 10250), (u'registryBurst', 10), (u'registryPullQPS', 5), (u'resolvConf', u'/etc/resolv.conf'), (u'rotateCertificates', True), (u'runtimeRequestTimeout', u'2m0s'), (u'serializeImagePulls', True), (u'streamingConnectionIdleTimeout', u'4h0m0s'), (u'syncFrequency', u'1m0s'), (u'volumeStatsAggPeriod', u'1m0s')]))]), OrderedDict([(u'require', [OrderedDict([(u'metalk8s_package_manager', u'Install kubelet')])])]), OrderedDict([(u'watch_in', [OrderedDict([(u'service', u'Ensure kubelet running')])])])])])), (u'Configure kubelet service as standalone', OrderedDict([(u'file.managed', [OrderedDict([(u'name', u'/etc/systemd/system/kubelet.service.d/09-standalone.conf')]), OrderedDict([(u'source', u'salt://metalk8s/kubernetes/kubelet/files/service-standalone-systemd.conf')]), OrderedDict([(u'template', u'jinja')]), OrderedDict([(u'user', u'root')]), OrderedDict([(u'group', u'root')]), OrderedDict([(u'mode', 644)]), OrderedDict([(u'makedirs', True)]), OrderedDict([(u'dir_mode', 755)]), OrderedDict([(u'context', OrderedDict([(u'env_file', u'/var/lib/kubelet/kubeadm-flags.env'), (u'manifest_path', u'/etc/kubernetes/manifests')]))]), OrderedDict([(u'require', [OrderedDict([(u'file', u'Create kubelet service environment file')]), OrderedDict([(u'file', u'Create kubelet config file')])])]), OrderedDict([(u'watch_in', [OrderedDict([(u'service', u'Ensure kubelet running')])])])])]))])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubernetes/kubelet/standalone.sls' using 'yaml' renderer: 0.00624108314514
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/kubernetes/kubelet/running.sls' to resolve 'salt://metalk8s/kubernetes/kubelet/running.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubernetes/kubelet/running.sls' to resolve 'salt://metalk8s/kubernetes/kubelet/running.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/kubernetes/kubelet/running.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/kubernetes/kubelet/running.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubernetes/kubelet/running.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubernetes/kubelet/running.sls' using 'jinja' renderer: 0.000871896743774
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubernetes/kubelet/running.sls:
include:
  - .installed

Ensure kubelet running:
  service.running:
    - name: kubelet
    - enable: True
    - watch:
      - metalk8s_package_manager: Install kubelet
    - require:
      - module: Reload systemctl

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'include', [u'.installed']), (u'Ensure kubelet running', OrderedDict([(u'service.running', [OrderedDict([(u'name', u'kubelet')]), OrderedDict([(u'enable', True)]), OrderedDict([(u'watch', [OrderedDict([(u'metalk8s_package_manager', u'Install kubelet')])])]), OrderedDict([(u'require', [OrderedDict([(u'module', u'Reload systemctl')])])])])]))])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubernetes/kubelet/running.sls' using 'yaml' renderer: 0.000702142715454
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/kubernetes/kubelet/installed.sls' to resolve 'salt://metalk8s/kubernetes/kubelet/installed.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubernetes/kubelet/installed.sls' to resolve 'salt://metalk8s/kubernetes/kubelet/installed.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/kubernetes/kubelet/installed.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/kubernetes/kubelet/installed.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubernetes/kubelet/installed.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/macro.sls' to resolve 'salt://metalk8s/macro.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/macro.sls' to resolve 'salt://metalk8s/macro.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubernetes/kubelet/installed.sls' using 'jinja' renderer: 0.0728549957275
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubernetes/kubelet/installed.sls:


include:
  - metalk8s.repo
  - metalk8s.container-engine

Install kubelet:
  
  metalk8s_package_manager.installed:
    - name: kubelet
    - pkgs_info: {"kubectl": {"version": "1.17.9"}, "xfsprogs": {"version": null}, "httpd-tools": {"version": null}, "iproute": {"version": null}, "sos": {"version": null}, "yum-plugin-versionlock": {"version": null}, "socat": {"version": null}, "containerd": {"version": "1.2.13-2.el7"}, "coreutils": {"version": null}, "container-selinux": {"version": null}, "iptables": {"version": null}, "ebtables": {"version": null}, "salt-minion": {"version": "3000.3"}, "calico-cni-plugin": {"version": "3.12.0-1.el7"}, "yum-utils": {"version": null}, "kubelet": {"version": "1.17.9"}, "m2crypto": {"version": null}, "genisoimage": {"version": null}, "util-linux": {"version": null}, "metalk8s-sosreport": {"version": "2.6-1.el7"}, "cri-tools": {"version": null}, "ethtool": {"version": null}, "e2fsprogs": {"version": null}, "runc": {"version": null}, "kubernetes-cni": {"version": null}}
    - version: 1.17.9
    - hold: True
    - update_holds: True
    - ignore_epoch: True
    - reload_modules: True
    - require:
      - test: Repositories configured

# When upgrading kubelet on centos7 we have error when trying to restart or get
# status of the kubelet service
# $ systemctl status kubelet
# Failed to get properties: Access denied
# 
# Workaround: Reload systemctl
Reload systemctl:
  module.wait:
    - service.systemctl_reload: []
    - watch:
      - metalk8s_package_manager: Install kubelet

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'include', [u'metalk8s.repo', u'metalk8s.container-engine']), (u'Install kubelet', OrderedDict([(u'metalk8s_package_manager.installed', [OrderedDict([(u'name', u'kubelet')]), OrderedDict([(u'pkgs_info', OrderedDict([(u'kubectl', OrderedDict([(u'version', u'1.17.9')])), (u'xfsprogs', OrderedDict([(u'version', None)])), (u'httpd-tools', OrderedDict([(u'version', None)])), (u'iproute', OrderedDict([(u'version', None)])), (u'sos', OrderedDict([(u'version', None)])), (u'yum-plugin-versionlock', OrderedDict([(u'version', None)])), (u'socat', OrderedDict([(u'version', None)])), (u'containerd', OrderedDict([(u'version', u'1.2.13-2.el7')])), (u'coreutils', OrderedDict([(u'version', None)])), (u'container-selinux', OrderedDict([(u'version', None)])), (u'iptables', OrderedDict([(u'version', None)])), (u'ebtables', OrderedDict([(u'version', None)])), (u'salt-minion', OrderedDict([(u'version', u'3000.3')])), (u'calico-cni-plugin', OrderedDict([(u'version', u'3.12.0-1.el7')])), (u'yum-utils', OrderedDict([(u'version', None)])), (u'kubelet', OrderedDict([(u'version', u'1.17.9')])), (u'm2crypto', OrderedDict([(u'version', None)])), (u'genisoimage', OrderedDict([(u'version', None)])), (u'util-linux', OrderedDict([(u'version', None)])), (u'metalk8s-sosreport', OrderedDict([(u'version', u'2.6-1.el7')])), (u'cri-tools', OrderedDict([(u'version', None)])), (u'ethtool', OrderedDict([(u'version', None)])), (u'e2fsprogs', OrderedDict([(u'version', None)])), (u'runc', OrderedDict([(u'version', None)])), (u'kubernetes-cni', OrderedDict([(u'version', None)]))]))]), OrderedDict([(u'version', u'1.17.9')]), OrderedDict([(u'hold', True)]), OrderedDict([(u'update_holds', True)]), OrderedDict([(u'ignore_epoch', True)]), OrderedDict([(u'reload_modules', True)]), OrderedDict([(u'require', [OrderedDict([(u'test', u'Repositories configured')])])])])])), (u'Reload systemctl', OrderedDict([(u'module.wait', [OrderedDict([(u'service.systemctl_reload', [])]), OrderedDict([(u'watch', [OrderedDict([(u'metalk8s_package_manager', u'Install kubelet')])])])])]))])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubernetes/kubelet/installed.sls' using 'yaml' renderer: 0.00278496742249
[DEBUG   ] Could not find file 'salt://metalk8s/container-engine.sls' in saltenv 'metalk8s-2.6.0-dev'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/container-engine/init.sls' to resolve 'salt://metalk8s/container-engine/init.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/container-engine/init.sls' to resolve 'salt://metalk8s/container-engine/init.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/container-engine/init.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/container-engine/init.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/container-engine/init.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/container-engine/init.sls' using 'jinja' renderer: 0.0495798587799
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/container-engine/init.sls:


include:
  - .containerd

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'include', [u'.containerd'])])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/container-engine/init.sls' using 'yaml' renderer: 0.000372171401978
[DEBUG   ] Could not find file 'salt://metalk8s/container-engine/containerd.sls' in saltenv 'metalk8s-2.6.0-dev'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/container-engine/containerd/init.sls' to resolve 'salt://metalk8s/container-engine/containerd/init.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/container-engine/containerd/init.sls' to resolve 'salt://metalk8s/container-engine/containerd/init.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/container-engine/containerd/init.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/container-engine/containerd/init.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/container-engine/containerd/init.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/container-engine/containerd/init.sls' using 'jinja' renderer: 0.000636100769043
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/container-engine/containerd/init.sls:
include:
  - .configured

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'include', [u'.configured'])])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/container-engine/containerd/init.sls' using 'yaml' renderer: 0.000249147415161
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/container-engine/containerd/configured.sls' to resolve 'salt://metalk8s/container-engine/containerd/configured.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/container-engine/containerd/configured.sls' to resolve 'salt://metalk8s/container-engine/containerd/configured.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/container-engine/containerd/configured.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/container-engine/containerd/configured.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/container-engine/containerd/configured.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/container-engine/containerd/configured.sls' using 'jinja' renderer: 0.0478780269623
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/container-engine/containerd/configured.sls:


include:
  - .installed

Start and enable containerd:
  service.running:
    - name: containerd
    - enable: True
    - init_delay: 2
    - require:
      - metalk8s_package_manager: Install containerd
    - watch:
      - file: Configure registry IP in containerd conf
      - file: Create containerd service drop-in

Inject pause image:
  # The `containerd` states require the `cri` module, which requires `crictl`
  file.managed:
    - name: /tmp/pause-3.1.tar
    - source: salt://metalk8s/container-engine/containerd/files/pause-3.1.tar
    - unless: >-
        ctr -n k8s.io image ls -q | grep k8s.gcr.io/pause | grep 3\\.1
    - require:
      - service: Start and enable containerd
  containerd.image_managed:
    - name: k8s.gcr.io/pause:3.1
    - archive_path: /tmp/pause-3.1.tar
    - require:
      - file: Inject pause image
      - metalk8s_package_manager: Install and configure cri-tools

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'include', [u'.installed']), (u'Start and enable containerd', OrderedDict([(u'service.running', [OrderedDict([(u'name', u'containerd')]), OrderedDict([(u'enable', True)]), OrderedDict([(u'init_delay', 2)]), OrderedDict([(u'require', [OrderedDict([(u'metalk8s_package_manager', u'Install containerd')])])]), OrderedDict([(u'watch', [OrderedDict([(u'file', u'Configure registry IP in containerd conf')]), OrderedDict([(u'file', u'Create containerd service drop-in')])])])])])), (u'Inject pause image', OrderedDict([(u'file.managed', [OrderedDict([(u'name', u'/tmp/pause-3.1.tar')]), OrderedDict([(u'source', u'salt://metalk8s/container-engine/containerd/files/pause-3.1.tar')]), OrderedDict([(u'unless', u'ctr -n k8s.io image ls -q | grep k8s.gcr.io/pause | grep 3\\\\.1')]), OrderedDict([(u'require', [OrderedDict([(u'service', u'Start and enable containerd')])])])]), (u'containerd.image_managed', [OrderedDict([(u'name', u'k8s.gcr.io/pause:3.1')]), OrderedDict([(u'archive_path', u'/tmp/pause-3.1.tar')]), OrderedDict([(u'require', [OrderedDict([(u'file', u'Inject pause image')]), OrderedDict([(u'metalk8s_package_manager', u'Install and configure cri-tools')])])])])]))])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/container-engine/containerd/configured.sls' using 'yaml' renderer: 0.00176119804382
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/container-engine/containerd/installed.sls' to resolve 'salt://metalk8s/container-engine/containerd/installed.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/container-engine/containerd/installed.sls' to resolve 'salt://metalk8s/container-engine/containerd/installed.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/container-engine/containerd/installed.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/container-engine/containerd/installed.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/container-engine/containerd/installed.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/macro.sls' to resolve 'salt://metalk8s/macro.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/macro.sls' to resolve 'salt://metalk8s/macro.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/container-engine/containerd/installed.sls' using 'jinja' renderer: 0.141296863556
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/container-engine/containerd/installed.sls:


include:
  - metalk8s.repo
Install container-selinux:
  
  metalk8s_package_manager.installed:
    - name: container-selinux
    - pkgs_info: {"kubectl": {"version": "1.17.9"}, "xfsprogs": {"version": null}, "httpd-tools": {"version": null}, "iproute": {"version": null}, "sos": {"version": null}, "yum-plugin-versionlock": {"version": null}, "socat": {"version": null}, "containerd": {"version": "1.2.13-2.el7"}, "coreutils": {"version": null}, "container-selinux": {"version": null}, "iptables": {"version": null}, "ebtables": {"version": null}, "salt-minion": {"version": "3000.3"}, "calico-cni-plugin": {"version": "3.12.0-1.el7"}, "yum-utils": {"version": null}, "kubelet": {"version": "1.17.9"}, "m2crypto": {"version": null}, "genisoimage": {"version": null}, "util-linux": {"version": null}, "metalk8s-sosreport": {"version": "2.6-1.el7"}, "cri-tools": {"version": null}, "ethtool": {"version": null}, "e2fsprogs": {"version": null}, "runc": {"version": null}, "kubernetes-cni": {"version": null}}
    - reload_modules: True
    - require:
      - test: Repositories configured

Install runc:
  
  metalk8s_package_manager.installed:
    - name: runc
    - pkgs_info: {"kubectl": {"version": "1.17.9"}, "xfsprogs": {"version": null}, "httpd-tools": {"version": null}, "iproute": {"version": null}, "sos": {"version": null}, "yum-plugin-versionlock": {"version": null}, "socat": {"version": null}, "containerd": {"version": "1.2.13-2.el7"}, "coreutils": {"version": null}, "container-selinux": {"version": null}, "iptables": {"version": null}, "ebtables": {"version": null}, "salt-minion": {"version": "3000.3"}, "calico-cni-plugin": {"version": "3.12.0-1.el7"}, "yum-utils": {"version": null}, "kubelet": {"version": "1.17.9"}, "m2crypto": {"version": null}, "genisoimage": {"version": null}, "util-linux": {"version": null}, "metalk8s-sosreport": {"version": "2.6-1.el7"}, "cri-tools": {"version": null}, "ethtool": {"version": null}, "e2fsprogs": {"version": null}, "runc": {"version": null}, "kubernetes-cni": {"version": null}}
    - reload_modules: True
    - require:
      - test: Repositories configured
      - metalk8s_package_manager: Install container-selinux

Install containerd:
  
  metalk8s_package_manager.installed:
    - name: containerd
    - pkgs_info: {"kubectl": {"version": "1.17.9"}, "xfsprogs": {"version": null}, "httpd-tools": {"version": null}, "iproute": {"version": null}, "sos": {"version": null}, "yum-plugin-versionlock": {"version": null}, "socat": {"version": null}, "containerd": {"version": "1.2.13-2.el7"}, "coreutils": {"version": null}, "container-selinux": {"version": null}, "iptables": {"version": null}, "ebtables": {"version": null}, "salt-minion": {"version": "3000.3"}, "calico-cni-plugin": {"version": "3.12.0-1.el7"}, "yum-utils": {"version": null}, "kubelet": {"version": "1.17.9"}, "m2crypto": {"version": null}, "genisoimage": {"version": null}, "util-linux": {"version": null}, "metalk8s-sosreport": {"version": "2.6-1.el7"}, "cri-tools": {"version": null}, "ethtool": {"version": null}, "e2fsprogs": {"version": null}, "runc": {"version": null}, "kubernetes-cni": {"version": null}}
    - version: 1.2.13-2.el7
    - hold: True
    - update_holds: True
    - ignore_epoch: True
    - reload_modules: True
    - require:
      - test: Repositories configured
      - metalk8s_package_manager: Install runc
      - file: Create containerd service drop-in
      - file: Configure registry IP in containerd conf
      - metalk8s_package_manager: Install container-selinux

Create containerd service drop-in:
  file.managed:
    - name: /etc/systemd/system/containerd.service.d/50-metalk8s.conf
    - source: salt://metalk8s/container-engine/containerd/files/50-metalk8s.conf.j2
    - template: jinja
    - user: root
    - group: root
    - mode: 0644
    - makedirs: true
    - dir_mode: 0755
    - context:
        containerd_args:
          - --log-level
          - info
        environment:

Install and configure cri-tools:
  
  metalk8s_package_manager.installed:
    - name: cri-tools
    - pkgs_info: {"kubectl": {"version": "1.17.9"}, "xfsprogs": {"version": null}, "httpd-tools": {"version": null}, "iproute": {"version": null}, "sos": {"version": null}, "yum-plugin-versionlock": {"version": null}, "socat": {"version": null}, "containerd": {"version": "1.2.13-2.el7"}, "coreutils": {"version": null}, "container-selinux": {"version": null}, "iptables": {"version": null}, "ebtables": {"version": null}, "salt-minion": {"version": "3000.3"}, "calico-cni-plugin": {"version": "3.12.0-1.el7"}, "yum-utils": {"version": null}, "kubelet": {"version": "1.17.9"}, "m2crypto": {"version": null}, "genisoimage": {"version": null}, "util-linux": {"version": null}, "metalk8s-sosreport": {"version": "2.6-1.el7"}, "cri-tools": {"version": null}, "ethtool": {"version": null}, "e2fsprogs": {"version": null}, "runc": {"version": null}, "kubernetes-cni": {"version": null}}
    - reload_modules: True
    - require:
      - test: Repositories configured
  file.serialize:
    - name: /etc/crictl.yaml
    - dataset:
        runtime-endpoint: unix:///run/containerd/containerd.sock
        image-endpoint: unix:///run/containerd/containerd.sock
    - merge_if_exists: true
    - user: root
    - group: root
    - mode: '0644'
    - formatter: yaml

Configure registry IP in containerd conf:
  file.managed:
    - name: /etc/containerd/config.toml
    - makedirs: true
    - contents: |
        [plugins.cri.registry.mirrors."metalk8s-registry-from-config.invalid"]
        endpoint = ["http://10.0.3.15:8080"]

        [debug]
        level = "info"

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'include', [u'metalk8s.repo']), (u'Install container-selinux', OrderedDict([(u'metalk8s_package_manager.installed', [OrderedDict([(u'name', u'container-selinux')]), OrderedDict([(u'pkgs_info', OrderedDict([(u'kubectl', OrderedDict([(u'version', u'1.17.9')])), (u'xfsprogs', OrderedDict([(u'version', None)])), (u'httpd-tools', OrderedDict([(u'version', None)])), (u'iproute', OrderedDict([(u'version', None)])), (u'sos', OrderedDict([(u'version', None)])), (u'yum-plugin-versionlock', OrderedDict([(u'version', None)])), (u'socat', OrderedDict([(u'version', None)])), (u'containerd', OrderedDict([(u'version', u'1.2.13-2.el7')])), (u'coreutils', OrderedDict([(u'version', None)])), (u'container-selinux', OrderedDict([(u'version', None)])), (u'iptables', OrderedDict([(u'version', None)])), (u'ebtables', OrderedDict([(u'version', None)])), (u'salt-minion', OrderedDict([(u'version', u'3000.3')])), (u'calico-cni-plugin', OrderedDict([(u'version', u'3.12.0-1.el7')])), (u'yum-utils', OrderedDict([(u'version', None)])), (u'kubelet', OrderedDict([(u'version', u'1.17.9')])), (u'm2crypto', OrderedDict([(u'version', None)])), (u'genisoimage', OrderedDict([(u'version', None)])), (u'util-linux', OrderedDict([(u'version', None)])), (u'metalk8s-sosreport', OrderedDict([(u'version', u'2.6-1.el7')])), (u'cri-tools', OrderedDict([(u'version', None)])), (u'ethtool', OrderedDict([(u'version', None)])), (u'e2fsprogs', OrderedDict([(u'version', None)])), (u'runc', OrderedDict([(u'version', None)])), (u'kubernetes-cni', OrderedDict([(u'version', None)]))]))]), OrderedDict([(u'reload_modules', True)]), OrderedDict([(u'require', [OrderedDict([(u'test', u'Repositories configured')])])])])])), (u'Install runc', OrderedDict([(u'metalk8s_package_manager.installed', [OrderedDict([(u'name', u'runc')]), OrderedDict([(u'pkgs_info', OrderedDict([(u'kubectl', OrderedDict([(u'version', u'1.17.9')])), (u'xfsprogs', OrderedDict([(u'version', None)])), (u'httpd-tools', OrderedDict([(u'version', None)])), (u'iproute', OrderedDict([(u'version', None)])), (u'sos', OrderedDict([(u'version', None)])), (u'yum-plugin-versionlock', OrderedDict([(u'version', None)])), (u'socat', OrderedDict([(u'version', None)])), (u'containerd', OrderedDict([(u'version', u'1.2.13-2.el7')])), (u'coreutils', OrderedDict([(u'version', None)])), (u'container-selinux', OrderedDict([(u'version', None)])), (u'iptables', OrderedDict([(u'version', None)])), (u'ebtables', OrderedDict([(u'version', None)])), (u'salt-minion', OrderedDict([(u'version', u'3000.3')])), (u'calico-cni-plugin', OrderedDict([(u'version', u'3.12.0-1.el7')])), (u'yum-utils', OrderedDict([(u'version', None)])), (u'kubelet', OrderedDict([(u'version', u'1.17.9')])), (u'm2crypto', OrderedDict([(u'version', None)])), (u'genisoimage', OrderedDict([(u'version', None)])), (u'util-linux', OrderedDict([(u'version', None)])), (u'metalk8s-sosreport', OrderedDict([(u'version', u'2.6-1.el7')])), (u'cri-tools', OrderedDict([(u'version', None)])), (u'ethtool', OrderedDict([(u'version', None)])), (u'e2fsprogs', OrderedDict([(u'version', None)])), (u'runc', OrderedDict([(u'version', None)])), (u'kubernetes-cni', OrderedDict([(u'version', None)]))]))]), OrderedDict([(u'reload_modules', True)]), OrderedDict([(u'require', [OrderedDict([(u'test', u'Repositories configured')]), OrderedDict([(u'metalk8s_package_manager', u'Install container-selinux')])])])])])), (u'Install containerd', OrderedDict([(u'metalk8s_package_manager.installed', [OrderedDict([(u'name', u'containerd')]), OrderedDict([(u'pkgs_info', OrderedDict([(u'kubectl', OrderedDict([(u'version', u'1.17.9')])), (u'xfsprogs', OrderedDict([(u'version', None)])), (u'httpd-tools', OrderedDict([(u'version', None)])), (u'iproute', OrderedDict([(u'version', None)])), (u'sos', OrderedDict([(u'version', None)])), (u'yum-plugin-versionlock', OrderedDict([(u'version', None)])), (u'socat', OrderedDict([(u'version', None)])), (u'containerd', OrderedDict([(u'version', u'1.2.13-2.el7')])), (u'coreutils', OrderedDict([(u'version', None)])), (u'container-selinux', OrderedDict([(u'version', None)])), (u'iptables', OrderedDict([(u'version', None)])), (u'ebtables', OrderedDict([(u'version', None)])), (u'salt-minion', OrderedDict([(u'version', u'3000.3')])), (u'calico-cni-plugin', OrderedDict([(u'version', u'3.12.0-1.el7')])), (u'yum-utils', OrderedDict([(u'version', None)])), (u'kubelet', OrderedDict([(u'version', u'1.17.9')])), (u'm2crypto', OrderedDict([(u'version', None)])), (u'genisoimage', OrderedDict([(u'version', None)])), (u'util-linux', OrderedDict([(u'version', None)])), (u'metalk8s-sosreport', OrderedDict([(u'version', u'2.6-1.el7')])), (u'cri-tools', OrderedDict([(u'version', None)])), (u'ethtool', OrderedDict([(u'version', None)])), (u'e2fsprogs', OrderedDict([(u'version', None)])), (u'runc', OrderedDict([(u'version', None)])), (u'kubernetes-cni', OrderedDict([(u'version', None)]))]))]), OrderedDict([(u'version', u'1.2.13-2.el7')]), OrderedDict([(u'hold', True)]), OrderedDict([(u'update_holds', True)]), OrderedDict([(u'ignore_epoch', True)]), OrderedDict([(u'reload_modules', True)]), OrderedDict([(u'require', [OrderedDict([(u'test', u'Repositories configured')]), OrderedDict([(u'metalk8s_package_manager', u'Install runc')]), OrderedDict([(u'file', u'Create containerd service drop-in')]), OrderedDict([(u'file', u'Configure registry IP in containerd conf')]), OrderedDict([(u'metalk8s_package_manager', u'Install container-selinux')])])])])])), (u'Create containerd service drop-in', OrderedDict([(u'file.managed', [OrderedDict([(u'name', u'/etc/systemd/system/containerd.service.d/50-metalk8s.conf')]), OrderedDict([(u'source', u'salt://metalk8s/container-engine/containerd/files/50-metalk8s.conf.j2')]), OrderedDict([(u'template', u'jinja')]), OrderedDict([(u'user', u'root')]), OrderedDict([(u'group', u'root')]), OrderedDict([(u'mode', 644)]), OrderedDict([(u'makedirs', True)]), OrderedDict([(u'dir_mode', 755)]), OrderedDict([(u'context', OrderedDict([(u'containerd_args', [u'--log-level', u'info']), (u'environment', None)]))])])])), (u'Install and configure cri-tools', OrderedDict([(u'metalk8s_package_manager.installed', [OrderedDict([(u'name', u'cri-tools')]), OrderedDict([(u'pkgs_info', OrderedDict([(u'kubectl', OrderedDict([(u'version', u'1.17.9')])), (u'xfsprogs', OrderedDict([(u'version', None)])), (u'httpd-tools', OrderedDict([(u'version', None)])), (u'iproute', OrderedDict([(u'version', None)])), (u'sos', OrderedDict([(u'version', None)])), (u'yum-plugin-versionlock', OrderedDict([(u'version', None)])), (u'socat', OrderedDict([(u'version', None)])), (u'containerd', OrderedDict([(u'version', u'1.2.13-2.el7')])), (u'coreutils', OrderedDict([(u'version', None)])), (u'container-selinux', OrderedDict([(u'version', None)])), (u'iptables', OrderedDict([(u'version', None)])), (u'ebtables', OrderedDict([(u'version', None)])), (u'salt-minion', OrderedDict([(u'version', u'3000.3')])), (u'calico-cni-plugin', OrderedDict([(u'version', u'3.12.0-1.el7')])), (u'yum-utils', OrderedDict([(u'version', None)])), (u'kubelet', OrderedDict([(u'version', u'1.17.9')])), (u'm2crypto', OrderedDict([(u'version', None)])), (u'genisoimage', OrderedDict([(u'version', None)])), (u'util-linux', OrderedDict([(u'version', None)])), (u'metalk8s-sosreport', OrderedDict([(u'version', u'2.6-1.el7')])), (u'cri-tools', OrderedDict([(u'version', None)])), (u'ethtool', OrderedDict([(u'version', None)])), (u'e2fsprogs', OrderedDict([(u'version', None)])), (u'runc', OrderedDict([(u'version', None)])), (u'kubernetes-cni', OrderedDict([(u'version', None)]))]))]), OrderedDict([(u'reload_modules', True)]), OrderedDict([(u'require', [OrderedDict([(u'test', u'Repositories configured')])])])]), (u'file.serialize', [OrderedDict([(u'name', u'/etc/crictl.yaml')]), OrderedDict([(u'dataset', OrderedDict([(u'runtime-endpoint', u'unix:///run/containerd/containerd.sock'), (u'image-endpoint', u'unix:///run/containerd/containerd.sock')]))]), OrderedDict([(u'merge_if_exists', True)]), OrderedDict([(u'user', u'root')]), OrderedDict([(u'group', u'root')]), OrderedDict([(u'mode', u'0644')]), OrderedDict([(u'formatter', u'yaml')])])])), (u'Configure registry IP in containerd conf', OrderedDict([(u'file.managed', [OrderedDict([(u'name', u'/etc/containerd/config.toml')]), OrderedDict([(u'makedirs', True)]), OrderedDict([(u'contents', u'[plugins.cri.registry.mirrors."metalk8s-registry-from-config.invalid"]\nendpoint = ["http://10.0.3.15:8080"]\n\n[debug]\nlevel = "info"\n')])])]))])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/container-engine/containerd/installed.sls' using 'yaml' renderer: 0.0124778747559
[DEBUG   ] Could not find file 'salt://metalk8s/internal/preflight.sls' in saltenv 'metalk8s-2.6.0-dev'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/internal/preflight/init.sls' to resolve 'salt://metalk8s/internal/preflight/init.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/internal/preflight/init.sls' to resolve 'salt://metalk8s/internal/preflight/init.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/internal/preflight/init.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/internal/preflight/init.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/internal/preflight/init.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/internal/preflight/init.sls' using 'jinja' renderer: 0.00159502029419
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/internal/preflight/init.sls:
#
# State preparation for kubeadm init preflight phase.
#
# The goal is to satisfy the checks executed by preflight:
#
# https://kubernetes.io/docs/reference/setup-tools/kubeadm/implementation-details/#preflight-checks
#
# Available states
# ================
#
# * mandatory   -> prevent ERROR in preflight phase
# * recommended -> prevent WARNING in preflight phase
#
# List of checks
#
#

include:
  - .mandatory
  - .recommended

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'include', [u'.mandatory', u'.recommended'])])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/internal/preflight/init.sls' using 'yaml' renderer: 0.00134801864624
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/internal/preflight/mandatory.sls' to resolve 'salt://metalk8s/internal/preflight/mandatory.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/internal/preflight/mandatory.sls' to resolve 'salt://metalk8s/internal/preflight/mandatory.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/internal/preflight/mandatory.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/internal/preflight/mandatory.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/internal/preflight/mandatory.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/macro.sls' to resolve 'salt://metalk8s/macro.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/macro.sls' to resolve 'salt://metalk8s/macro.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/internal/preflight/mandatory.sls' using 'jinja' renderer: 0.109155893326
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/internal/preflight/mandatory.sls:


include:
  - metalk8s.repo
Install mandatory package "util-linux":
  
  metalk8s_package_manager.installed:
    - name: util-linux
    - pkgs_info: {"kubectl": {"version": "1.17.9"}, "xfsprogs": {"version": null}, "httpd-tools": {"version": null}, "iproute": {"version": null}, "sos": {"version": null}, "yum-plugin-versionlock": {"version": null}, "socat": {"version": null}, "containerd": {"version": "1.2.13-2.el7"}, "coreutils": {"version": null}, "container-selinux": {"version": null}, "iptables": {"version": null}, "ebtables": {"version": null}, "salt-minion": {"version": "3000.3"}, "calico-cni-plugin": {"version": "3.12.0-1.el7"}, "yum-utils": {"version": null}, "kubelet": {"version": "1.17.9"}, "m2crypto": {"version": null}, "genisoimage": {"version": null}, "util-linux": {"version": null}, "metalk8s-sosreport": {"version": "2.6-1.el7"}, "cri-tools": {"version": null}, "ethtool": {"version": null}, "e2fsprogs": {"version": null}, "runc": {"version": null}, "kubernetes-cni": {"version": null}}
    - reload_modules: True
    - require:
      - test: Repositories configured
Install mandatory package "iproute":
  
  metalk8s_package_manager.installed:
    - name: iproute
    - pkgs_info: {"kubectl": {"version": "1.17.9"}, "xfsprogs": {"version": null}, "httpd-tools": {"version": null}, "iproute": {"version": null}, "sos": {"version": null}, "yum-plugin-versionlock": {"version": null}, "socat": {"version": null}, "containerd": {"version": "1.2.13-2.el7"}, "coreutils": {"version": null}, "container-selinux": {"version": null}, "iptables": {"version": null}, "ebtables": {"version": null}, "salt-minion": {"version": "3000.3"}, "calico-cni-plugin": {"version": "3.12.0-1.el7"}, "yum-utils": {"version": null}, "kubelet": {"version": "1.17.9"}, "m2crypto": {"version": null}, "genisoimage": {"version": null}, "util-linux": {"version": null}, "metalk8s-sosreport": {"version": "2.6-1.el7"}, "cri-tools": {"version": null}, "ethtool": {"version": null}, "e2fsprogs": {"version": null}, "runc": {"version": null}, "kubernetes-cni": {"version": null}}
    - reload_modules: True
    - require:
      - test: Repositories configured
Install mandatory package "iptables":
  
  metalk8s_package_manager.installed:
    - name: iptables
    - pkgs_info: {"kubectl": {"version": "1.17.9"}, "xfsprogs": {"version": null}, "httpd-tools": {"version": null}, "iproute": {"version": null}, "sos": {"version": null}, "yum-plugin-versionlock": {"version": null}, "socat": {"version": null}, "containerd": {"version": "1.2.13-2.el7"}, "coreutils": {"version": null}, "container-selinux": {"version": null}, "iptables": {"version": null}, "ebtables": {"version": null}, "salt-minion": {"version": "3000.3"}, "calico-cni-plugin": {"version": "3.12.0-1.el7"}, "yum-utils": {"version": null}, "kubelet": {"version": "1.17.9"}, "m2crypto": {"version": null}, "genisoimage": {"version": null}, "util-linux": {"version": null}, "metalk8s-sosreport": {"version": "2.6-1.el7"}, "cri-tools": {"version": null}, "ethtool": {"version": null}, "e2fsprogs": {"version": null}, "runc": {"version": null}, "kubernetes-cni": {"version": null}}
    - reload_modules: True
    - require:
      - test: Repositories configured
Enable containerd service:
  service.running:
    - name: containerd
    - enable: true
    - require_in:
      - test: Check that the crictl socket answer

# required to set sysctl net.bridge.bridge-nf-call-iptables
Add the module br_netfilter to kernel:
  kmod.present:
    - name: br_netfilter
    - persist: True
Set sysctl net.bridge.bridge-nf-call-ip6tables value to 1:
  sysctl.present:
    - name: net.bridge.bridge-nf-call-ip6tables
    - value: 1
    - config: /etc/sysctl.d/60-metalk8s.conf
    - require:
      - kmod: Add the module br_netfilter to kernel
Set sysctl net.bridge.bridge-nf-call-iptables value to 1:
  sysctl.present:
    - name: net.bridge.bridge-nf-call-iptables
    - value: 1
    - config: /etc/sysctl.d/60-metalk8s.conf
    - require:
      - kmod: Add the module br_netfilter to kernel
Set sysctl net.ipv4.ip_forward value to 1:
  sysctl.present:
    - name: net.ipv4.ip_forward
    - value: 1
    - config: /etc/sysctl.d/60-metalk8s.conf
Disable swap device /dev/dm-1:
  module.run:
    - mount.swapoff:
      - name: /dev/dm-1

Prevent swap mount from fstab:
  file.comment:
    - name: /etc/fstab
    - regex: .+\s+.+\s+swap\s+.+
    - onlyif:
      # Add a condition to avoid the state failure
      # in case we don t have swap in /etc/fstab
      - test -n "$(awk '$3=="swap" {print}' /etc/fstab)"

Check that the crictl socket answer:
  # use test.succeed_without_changes instead of cmd.run for idempotency
  test.succeed_without_changes:
    - name: crictl --runtime-endpoint unix:///run/containerd/containerd.sock info
    - check_cmd:
      - crictl --runtime-endpoint unix:///run/containerd/containerd.sock info
The port 10250 is free:
  test.succeed_without_changes: []
The port 10251 is free:
  test.succeed_without_changes: []
The port 10252 is free:
  test.succeed_without_changes: []
The port 2379 is free:
  test.succeed_without_changes: []
The port 2380 is free:
  test.succeed_without_changes: []

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'include', [u'metalk8s.repo']), (u'Install mandatory package "util-linux"', OrderedDict([(u'metalk8s_package_manager.installed', [OrderedDict([(u'name', u'util-linux')]), OrderedDict([(u'pkgs_info', OrderedDict([(u'kubectl', OrderedDict([(u'version', u'1.17.9')])), (u'xfsprogs', OrderedDict([(u'version', None)])), (u'httpd-tools', OrderedDict([(u'version', None)])), (u'iproute', OrderedDict([(u'version', None)])), (u'sos', OrderedDict([(u'version', None)])), (u'yum-plugin-versionlock', OrderedDict([(u'version', None)])), (u'socat', OrderedDict([(u'version', None)])), (u'containerd', OrderedDict([(u'version', u'1.2.13-2.el7')])), (u'coreutils', OrderedDict([(u'version', None)])), (u'container-selinux', OrderedDict([(u'version', None)])), (u'iptables', OrderedDict([(u'version', None)])), (u'ebtables', OrderedDict([(u'version', None)])), (u'salt-minion', OrderedDict([(u'version', u'3000.3')])), (u'calico-cni-plugin', OrderedDict([(u'version', u'3.12.0-1.el7')])), (u'yum-utils', OrderedDict([(u'version', None)])), (u'kubelet', OrderedDict([(u'version', u'1.17.9')])), (u'm2crypto', OrderedDict([(u'version', None)])), (u'genisoimage', OrderedDict([(u'version', None)])), (u'util-linux', OrderedDict([(u'version', None)])), (u'metalk8s-sosreport', OrderedDict([(u'version', u'2.6-1.el7')])), (u'cri-tools', OrderedDict([(u'version', None)])), (u'ethtool', OrderedDict([(u'version', None)])), (u'e2fsprogs', OrderedDict([(u'version', None)])), (u'runc', OrderedDict([(u'version', None)])), (u'kubernetes-cni', OrderedDict([(u'version', None)]))]))]), OrderedDict([(u'reload_modules', True)]), OrderedDict([(u'require', [OrderedDict([(u'test', u'Repositories configured')])])])])])), (u'Install mandatory package "iproute"', OrderedDict([(u'metalk8s_package_manager.installed', [OrderedDict([(u'name', u'iproute')]), OrderedDict([(u'pkgs_info', OrderedDict([(u'kubectl', OrderedDict([(u'version', u'1.17.9')])), (u'xfsprogs', OrderedDict([(u'version', None)])), (u'httpd-tools', OrderedDict([(u'version', None)])), (u'iproute', OrderedDict([(u'version', None)])), (u'sos', OrderedDict([(u'version', None)])), (u'yum-plugin-versionlock', OrderedDict([(u'version', None)])), (u'socat', OrderedDict([(u'version', None)])), (u'containerd', OrderedDict([(u'version', u'1.2.13-2.el7')])), (u'coreutils', OrderedDict([(u'version', None)])), (u'container-selinux', OrderedDict([(u'version', None)])), (u'iptables', OrderedDict([(u'version', None)])), (u'ebtables', OrderedDict([(u'version', None)])), (u'salt-minion', OrderedDict([(u'version', u'3000.3')])), (u'calico-cni-plugin', OrderedDict([(u'version', u'3.12.0-1.el7')])), (u'yum-utils', OrderedDict([(u'version', None)])), (u'kubelet', OrderedDict([(u'version', u'1.17.9')])), (u'm2crypto', OrderedDict([(u'version', None)])), (u'genisoimage', OrderedDict([(u'version', None)])), (u'util-linux', OrderedDict([(u'version', None)])), (u'metalk8s-sosreport', OrderedDict([(u'version', u'2.6-1.el7')])), (u'cri-tools', OrderedDict([(u'version', None)])), (u'ethtool', OrderedDict([(u'version', None)])), (u'e2fsprogs', OrderedDict([(u'version', None)])), (u'runc', OrderedDict([(u'version', None)])), (u'kubernetes-cni', OrderedDict([(u'version', None)]))]))]), OrderedDict([(u'reload_modules', True)]), OrderedDict([(u'require', [OrderedDict([(u'test', u'Repositories configured')])])])])])), (u'Install mandatory package "iptables"', OrderedDict([(u'metalk8s_package_manager.installed', [OrderedDict([(u'name', u'iptables')]), OrderedDict([(u'pkgs_info', OrderedDict([(u'kubectl', OrderedDict([(u'version', u'1.17.9')])), (u'xfsprogs', OrderedDict([(u'version', None)])), (u'httpd-tools', OrderedDict([(u'version', None)])), (u'iproute', OrderedDict([(u'version', None)])), (u'sos', OrderedDict([(u'version', None)])), (u'yum-plugin-versionlock', OrderedDict([(u'version', None)])), (u'socat', OrderedDict([(u'version', None)])), (u'containerd', OrderedDict([(u'version', u'1.2.13-2.el7')])), (u'coreutils', OrderedDict([(u'version', None)])), (u'container-selinux', OrderedDict([(u'version', None)])), (u'iptables', OrderedDict([(u'version', None)])), (u'ebtables', OrderedDict([(u'version', None)])), (u'salt-minion', OrderedDict([(u'version', u'3000.3')])), (u'calico-cni-plugin', OrderedDict([(u'version', u'3.12.0-1.el7')])), (u'yum-utils', OrderedDict([(u'version', None)])), (u'kubelet', OrderedDict([(u'version', u'1.17.9')])), (u'm2crypto', OrderedDict([(u'version', None)])), (u'genisoimage', OrderedDict([(u'version', None)])), (u'util-linux', OrderedDict([(u'version', None)])), (u'metalk8s-sosreport', OrderedDict([(u'version', u'2.6-1.el7')])), (u'cri-tools', OrderedDict([(u'version', None)])), (u'ethtool', OrderedDict([(u'version', None)])), (u'e2fsprogs', OrderedDict([(u'version', None)])), (u'runc', OrderedDict([(u'version', None)])), (u'kubernetes-cni', OrderedDict([(u'version', None)]))]))]), OrderedDict([(u'reload_modules', True)]), OrderedDict([(u'require', [OrderedDict([(u'test', u'Repositories configured')])])])])])), (u'Enable containerd service', OrderedDict([(u'service.running', [OrderedDict([(u'name', u'containerd')]), OrderedDict([(u'enable', True)]), OrderedDict([(u'require_in', [OrderedDict([(u'test', u'Check that the crictl socket answer')])])])])])), (u'Add the module br_netfilter to kernel', OrderedDict([(u'kmod.present', [OrderedDict([(u'name', u'br_netfilter')]), OrderedDict([(u'persist', True)])])])), (u'Set sysctl net.bridge.bridge-nf-call-ip6tables value to 1', OrderedDict([(u'sysctl.present', [OrderedDict([(u'name', u'net.bridge.bridge-nf-call-ip6tables')]), OrderedDict([(u'value', 1)]), OrderedDict([(u'config', u'/etc/sysctl.d/60-metalk8s.conf')]), OrderedDict([(u'require', [OrderedDict([(u'kmod', u'Add the module br_netfilter to kernel')])])])])])), (u'Set sysctl net.bridge.bridge-nf-call-iptables value to 1', OrderedDict([(u'sysctl.present', [OrderedDict([(u'name', u'net.bridge.bridge-nf-call-iptables')]), OrderedDict([(u'value', 1)]), OrderedDict([(u'config', u'/etc/sysctl.d/60-metalk8s.conf')]), OrderedDict([(u'require', [OrderedDict([(u'kmod', u'Add the module br_netfilter to kernel')])])])])])), (u'Set sysctl net.ipv4.ip_forward value to 1', OrderedDict([(u'sysctl.present', [OrderedDict([(u'name', u'net.ipv4.ip_forward')]), OrderedDict([(u'value', 1)]), OrderedDict([(u'config', u'/etc/sysctl.d/60-metalk8s.conf')])])])), (u'Disable swap device /dev/dm-1', OrderedDict([(u'module.run', [OrderedDict([(u'mount.swapoff', [OrderedDict([(u'name', u'/dev/dm-1')])])])])])), (u'Prevent swap mount from fstab', OrderedDict([(u'file.comment', [OrderedDict([(u'name', u'/etc/fstab')]), OrderedDict([(u'regex', u'.+\\s+.+\\s+swap\\s+.+')]), OrderedDict([(u'onlyif', [u'test -n "$(awk \'$3=="swap" {print}\' /etc/fstab)"'])])])])), (u'Check that the crictl socket answer', OrderedDict([(u'test.succeed_without_changes', [OrderedDict([(u'name', u'crictl --runtime-endpoint unix:///run/containerd/containerd.sock info')]), OrderedDict([(u'check_cmd', [u'crictl --runtime-endpoint unix:///run/containerd/containerd.sock info'])])])])), (u'The port 10250 is free', OrderedDict([(u'test.succeed_without_changes', [])])), (u'The port 10251 is free', OrderedDict([(u'test.succeed_without_changes', [])])), (u'The port 10252 is free', OrderedDict([(u'test.succeed_without_changes', [])])), (u'The port 2379 is free', OrderedDict([(u'test.succeed_without_changes', [])])), (u'The port 2380 is free', OrderedDict([(u'test.succeed_without_changes', [])]))])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/internal/preflight/mandatory.sls' using 'yaml' renderer: 0.01043009758
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/internal/preflight/recommended.sls' to resolve 'salt://metalk8s/internal/preflight/recommended.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/internal/preflight/recommended.sls' to resolve 'salt://metalk8s/internal/preflight/recommended.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/internal/preflight/recommended.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/internal/preflight/recommended.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/internal/preflight/recommended.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/macro.sls' to resolve 'salt://metalk8s/macro.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/macro.sls' to resolve 'salt://metalk8s/macro.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/internal/preflight/recommended.sls' using 'jinja' renderer: 0.0760159492493
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/internal/preflight/recommended.sls:


include:
  - metalk8s.repo
Install recommended package "util-linux":
  
  metalk8s_package_manager.installed:
    - name: util-linux
    - pkgs_info: {"kubectl": {"version": "1.17.9"}, "xfsprogs": {"version": null}, "httpd-tools": {"version": null}, "iproute": {"version": null}, "sos": {"version": null}, "yum-plugin-versionlock": {"version": null}, "socat": {"version": null}, "containerd": {"version": "1.2.13-2.el7"}, "coreutils": {"version": null}, "container-selinux": {"version": null}, "iptables": {"version": null}, "ebtables": {"version": null}, "salt-minion": {"version": "3000.3"}, "calico-cni-plugin": {"version": "3.12.0-1.el7"}, "yum-utils": {"version": null}, "kubelet": {"version": "1.17.9"}, "m2crypto": {"version": null}, "genisoimage": {"version": null}, "util-linux": {"version": null}, "metalk8s-sosreport": {"version": "2.6-1.el7"}, "cri-tools": {"version": null}, "ethtool": {"version": null}, "e2fsprogs": {"version": null}, "runc": {"version": null}, "kubernetes-cni": {"version": null}}
    - reload_modules: True
    - require:
      - test: Repositories configured
Install recommended package "iproute":
  
  metalk8s_package_manager.installed:
    - name: iproute
    - pkgs_info: {"kubectl": {"version": "1.17.9"}, "xfsprogs": {"version": null}, "httpd-tools": {"version": null}, "iproute": {"version": null}, "sos": {"version": null}, "yum-plugin-versionlock": {"version": null}, "socat": {"version": null}, "containerd": {"version": "1.2.13-2.el7"}, "coreutils": {"version": null}, "container-selinux": {"version": null}, "iptables": {"version": null}, "ebtables": {"version": null}, "salt-minion": {"version": "3000.3"}, "calico-cni-plugin": {"version": "3.12.0-1.el7"}, "yum-utils": {"version": null}, "kubelet": {"version": "1.17.9"}, "m2crypto": {"version": null}, "genisoimage": {"version": null}, "util-linux": {"version": null}, "metalk8s-sosreport": {"version": "2.6-1.el7"}, "cri-tools": {"version": null}, "ethtool": {"version": null}, "e2fsprogs": {"version": null}, "runc": {"version": null}, "kubernetes-cni": {"version": null}}
    - reload_modules: True
    - require:
      - test: Repositories configured
Install recommended package "iptables":
  
  metalk8s_package_manager.installed:
    - name: iptables
    - pkgs_info: {"kubectl": {"version": "1.17.9"}, "xfsprogs": {"version": null}, "httpd-tools": {"version": null}, "iproute": {"version": null}, "sos": {"version": null}, "yum-plugin-versionlock": {"version": null}, "socat": {"version": null}, "containerd": {"version": "1.2.13-2.el7"}, "coreutils": {"version": null}, "container-selinux": {"version": null}, "iptables": {"version": null}, "ebtables": {"version": null}, "salt-minion": {"version": "3000.3"}, "calico-cni-plugin": {"version": "3.12.0-1.el7"}, "yum-utils": {"version": null}, "kubelet": {"version": "1.17.9"}, "m2crypto": {"version": null}, "genisoimage": {"version": null}, "util-linux": {"version": null}, "metalk8s-sosreport": {"version": "2.6-1.el7"}, "cri-tools": {"version": null}, "ethtool": {"version": null}, "e2fsprogs": {"version": null}, "runc": {"version": null}, "kubernetes-cni": {"version": null}}
    - reload_modules: True
    - require:
      - test: Repositories configured

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'include', [u'metalk8s.repo']), (u'Install recommended package "util-linux"', OrderedDict([(u'metalk8s_package_manager.installed', [OrderedDict([(u'name', u'util-linux')]), OrderedDict([(u'pkgs_info', OrderedDict([(u'kubectl', OrderedDict([(u'version', u'1.17.9')])), (u'xfsprogs', OrderedDict([(u'version', None)])), (u'httpd-tools', OrderedDict([(u'version', None)])), (u'iproute', OrderedDict([(u'version', None)])), (u'sos', OrderedDict([(u'version', None)])), (u'yum-plugin-versionlock', OrderedDict([(u'version', None)])), (u'socat', OrderedDict([(u'version', None)])), (u'containerd', OrderedDict([(u'version', u'1.2.13-2.el7')])), (u'coreutils', OrderedDict([(u'version', None)])), (u'container-selinux', OrderedDict([(u'version', None)])), (u'iptables', OrderedDict([(u'version', None)])), (u'ebtables', OrderedDict([(u'version', None)])), (u'salt-minion', OrderedDict([(u'version', u'3000.3')])), (u'calico-cni-plugin', OrderedDict([(u'version', u'3.12.0-1.el7')])), (u'yum-utils', OrderedDict([(u'version', None)])), (u'kubelet', OrderedDict([(u'version', u'1.17.9')])), (u'm2crypto', OrderedDict([(u'version', None)])), (u'genisoimage', OrderedDict([(u'version', None)])), (u'util-linux', OrderedDict([(u'version', None)])), (u'metalk8s-sosreport', OrderedDict([(u'version', u'2.6-1.el7')])), (u'cri-tools', OrderedDict([(u'version', None)])), (u'ethtool', OrderedDict([(u'version', None)])), (u'e2fsprogs', OrderedDict([(u'version', None)])), (u'runc', OrderedDict([(u'version', None)])), (u'kubernetes-cni', OrderedDict([(u'version', None)]))]))]), OrderedDict([(u'reload_modules', True)]), OrderedDict([(u'require', [OrderedDict([(u'test', u'Repositories configured')])])])])])), (u'Install recommended package "iproute"', OrderedDict([(u'metalk8s_package_manager.installed', [OrderedDict([(u'name', u'iproute')]), OrderedDict([(u'pkgs_info', OrderedDict([(u'kubectl', OrderedDict([(u'version', u'1.17.9')])), (u'xfsprogs', OrderedDict([(u'version', None)])), (u'httpd-tools', OrderedDict([(u'version', None)])), (u'iproute', OrderedDict([(u'version', None)])), (u'sos', OrderedDict([(u'version', None)])), (u'yum-plugin-versionlock', OrderedDict([(u'version', None)])), (u'socat', OrderedDict([(u'version', None)])), (u'containerd', OrderedDict([(u'version', u'1.2.13-2.el7')])), (u'coreutils', OrderedDict([(u'version', None)])), (u'container-selinux', OrderedDict([(u'version', None)])), (u'iptables', OrderedDict([(u'version', None)])), (u'ebtables', OrderedDict([(u'version', None)])), (u'salt-minion', OrderedDict([(u'version', u'3000.3')])), (u'calico-cni-plugin', OrderedDict([(u'version', u'3.12.0-1.el7')])), (u'yum-utils', OrderedDict([(u'version', None)])), (u'kubelet', OrderedDict([(u'version', u'1.17.9')])), (u'm2crypto', OrderedDict([(u'version', None)])), (u'genisoimage', OrderedDict([(u'version', None)])), (u'util-linux', OrderedDict([(u'version', None)])), (u'metalk8s-sosreport', OrderedDict([(u'version', u'2.6-1.el7')])), (u'cri-tools', OrderedDict([(u'version', None)])), (u'ethtool', OrderedDict([(u'version', None)])), (u'e2fsprogs', OrderedDict([(u'version', None)])), (u'runc', OrderedDict([(u'version', None)])), (u'kubernetes-cni', OrderedDict([(u'version', None)]))]))]), OrderedDict([(u'reload_modules', True)]), OrderedDict([(u'require', [OrderedDict([(u'test', u'Repositories configured')])])])])])), (u'Install recommended package "iptables"', OrderedDict([(u'metalk8s_package_manager.installed', [OrderedDict([(u'name', u'iptables')]), OrderedDict([(u'pkgs_info', OrderedDict([(u'kubectl', OrderedDict([(u'version', u'1.17.9')])), (u'xfsprogs', OrderedDict([(u'version', None)])), (u'httpd-tools', OrderedDict([(u'version', None)])), (u'iproute', OrderedDict([(u'version', None)])), (u'sos', OrderedDict([(u'version', None)])), (u'yum-plugin-versionlock', OrderedDict([(u'version', None)])), (u'socat', OrderedDict([(u'version', None)])), (u'containerd', OrderedDict([(u'version', u'1.2.13-2.el7')])), (u'coreutils', OrderedDict([(u'version', None)])), (u'container-selinux', OrderedDict([(u'version', None)])), (u'iptables', OrderedDict([(u'version', None)])), (u'ebtables', OrderedDict([(u'version', None)])), (u'salt-minion', OrderedDict([(u'version', u'3000.3')])), (u'calico-cni-plugin', OrderedDict([(u'version', u'3.12.0-1.el7')])), (u'yum-utils', OrderedDict([(u'version', None)])), (u'kubelet', OrderedDict([(u'version', u'1.17.9')])), (u'm2crypto', OrderedDict([(u'version', None)])), (u'genisoimage', OrderedDict([(u'version', None)])), (u'util-linux', OrderedDict([(u'version', None)])), (u'metalk8s-sosreport', OrderedDict([(u'version', u'2.6-1.el7')])), (u'cri-tools', OrderedDict([(u'version', None)])), (u'ethtool', OrderedDict([(u'version', None)])), (u'e2fsprogs', OrderedDict([(u'version', None)])), (u'runc', OrderedDict([(u'version', None)])), (u'kubernetes-cni', OrderedDict([(u'version', None)]))]))]), OrderedDict([(u'reload_modules', True)]), OrderedDict([(u'require', [OrderedDict([(u'test', u'Repositories configured')])])])])]))])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/internal/preflight/recommended.sls' using 'yaml' renderer: 0.00699210166931
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/repo/installed.sls' to resolve 'salt://metalk8s/repo/installed.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/repo/installed.sls' to resolve 'salt://metalk8s/repo/installed.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/repo/installed.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/repo/installed.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/repo/installed.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[WARNING ] Skip, invalid archive path /metalk8s.iso, should be an iso or a directory.
[ERROR   ] Rendering exception occurred
Traceback (most recent call last):
  File "/usr/lib/python2.7/site-packages/salt/utils/templates.py", line 169, in render_tmpl
    output = render_str(tmplstr, context, tmplpath)
  File "/usr/lib/python2.7/site-packages/salt/utils/templates.py", line 404, in render_jinja_tmpl
    buf=tmplstr)
SaltRenderError: Jinja variable 'dict object' has no attribute u'metalk8s-2.6.0-dev'
[CRITICAL] Rendering SLS 'metalk8s-2.6.0-dev:metalk8s.repo.installed' failed: Jinja variable 'dict object' has no attribute u'metalk8s-2.6.0-dev'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/salt/master/certs/salt-api.sls' to resolve 'salt://metalk8s/salt/master/certs/salt-api.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/master/certs/salt-api.sls' to resolve 'salt://metalk8s/salt/master/certs/salt-api.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/salt/master/certs/salt-api.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/salt/master/certs/salt-api.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/master/certs/salt-api.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[DEBUG   ] Trying to parse u'localhost.localdomain' as AF_INET
[DEBUG   ] Failed to parse u'localhost.localdomain' as AF_INET: illegal IP address string passed to inet_pton
[DEBUG   ] Trying to parse u'localhost.localdomain' as AF_INET6
[DEBUG   ] Failed to parse u'localhost.localdomain' as AF_INET6: illegal IP address string passed to inet_pton
[DEBUG   ] SAN field for u'localhost.localdomain' is "DNS:localhost.localdomain"
[DEBUG   ] Trying to parse u'salt-master' as AF_INET
[DEBUG   ] Failed to parse u'salt-master' as AF_INET: illegal IP address string passed to inet_pton
[DEBUG   ] Trying to parse u'salt-master' as AF_INET6
[DEBUG   ] Failed to parse u'salt-master' as AF_INET6: illegal IP address string passed to inet_pton
[DEBUG   ] SAN field for u'salt-master' is "DNS:salt-master"
[DEBUG   ] Trying to parse u'salt-master.kube-system' as AF_INET
[DEBUG   ] Failed to parse u'salt-master.kube-system' as AF_INET: illegal IP address string passed to inet_pton
[DEBUG   ] Trying to parse u'salt-master.kube-system' as AF_INET6
[DEBUG   ] Failed to parse u'salt-master.kube-system' as AF_INET6: illegal IP address string passed to inet_pton
[DEBUG   ] SAN field for u'salt-master.kube-system' is "DNS:salt-master.kube-system"
[DEBUG   ] Trying to parse u'salt-master.kube-system.svc' as AF_INET
[DEBUG   ] Failed to parse u'salt-master.kube-system.svc' as AF_INET: illegal IP address string passed to inet_pton
[DEBUG   ] Trying to parse u'salt-master.kube-system.svc' as AF_INET6
[DEBUG   ] Failed to parse u'salt-master.kube-system.svc' as AF_INET6: illegal IP address string passed to inet_pton
[DEBUG   ] SAN field for u'salt-master.kube-system.svc' is "DNS:salt-master.kube-system.svc"
[DEBUG   ] Trying to parse u'salt-master.kube-system.svc.cluster.local' as AF_INET
[DEBUG   ] Failed to parse u'salt-master.kube-system.svc.cluster.local' as AF_INET: illegal IP address string passed to inet_pton
[DEBUG   ] Trying to parse u'salt-master.kube-system.svc.cluster.local' as AF_INET6
[DEBUG   ] Failed to parse u'salt-master.kube-system.svc.cluster.local' as AF_INET6: illegal IP address string passed to inet_pton
[DEBUG   ] SAN field for u'salt-master.kube-system.svc.cluster.local' is "DNS:salt-master.kube-system.svc.cluster.local"
[DEBUG   ] Trying to parse u'10.0.3.15' as AF_INET
[DEBUG   ] Trying to unparse u'\n\x00\x03\x0f' as AF_INET
[DEBUG   ] SAN field for u'10.0.3.15' is "IP:10.0.3.15"
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/master/certs/salt-api.sls' using 'jinja' renderer: 0.0710778236389
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/master/certs/salt-api.sls:


include:
  - metalk8s.internal.m2crypto

Create Salt API private key:
  x509.private_key_managed:
    - name: /etc/salt/pki/api/salt-api.key
    - bits: 2048
    - verbose: False
    - user: root
    - group: root
    - mode: 600
    - makedirs: True
    - dir_mode: 755
    - require:
      - metalk8s_package_manager: Install m2crypto
    - unless:
      - test -f "/etc/salt/pki/api/salt-api.key"



Generate Salt API certificate:
  x509.certificate_managed:
    - name: /etc/salt/pki/api/salt-api.crt
    - public_key: /etc/salt/pki/api/salt-api.key
    - signing_policy: kube_apiserver_server_policy
    - CN: salt-api on 10.0.2.15
    - subjectAltName: "DNS:localhost.localdomain, DNS:salt-master, DNS:salt-master.kube-system, DNS:salt-master.kube-system.svc, DNS:salt-master.kube-system.svc.cluster.local, IP:10.0.3.15"
    - user: root
    - group: root
    - mode: 644
    - makedirs: True
    - dir_mode: 755
    - require:
      - x509: Create Salt API private key

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'include', [u'metalk8s.internal.m2crypto']), (u'Create Salt API private key', OrderedDict([(u'x509.private_key_managed', [OrderedDict([(u'name', u'/etc/salt/pki/api/salt-api.key')]), OrderedDict([(u'bits', 2048)]), OrderedDict([(u'verbose', False)]), OrderedDict([(u'user', u'root')]), OrderedDict([(u'group', u'root')]), OrderedDict([(u'mode', 600)]), OrderedDict([(u'makedirs', True)]), OrderedDict([(u'dir_mode', 755)]), OrderedDict([(u'require', [OrderedDict([(u'metalk8s_package_manager', u'Install m2crypto')])])]), OrderedDict([(u'unless', [u'test -f "/etc/salt/pki/api/salt-api.key"'])])])])), (u'Generate Salt API certificate', OrderedDict([(u'x509.certificate_managed', [OrderedDict([(u'name', u'/etc/salt/pki/api/salt-api.crt')]), OrderedDict([(u'public_key', u'/etc/salt/pki/api/salt-api.key')]), OrderedDict([(u'signing_policy', u'kube_apiserver_server_policy')]), OrderedDict([(u'CN', u'salt-api on 10.0.2.15')]), OrderedDict([(u'subjectAltName', u'DNS:localhost.localdomain, DNS:salt-master, DNS:salt-master.kube-system, DNS:salt-master.kube-system.svc, DNS:salt-master.kube-system.svc.cluster.local, IP:10.0.3.15')]), OrderedDict([(u'user', u'root')]), OrderedDict([(u'group', u'root')]), OrderedDict([(u'mode', 644)]), OrderedDict([(u'makedirs', True)]), OrderedDict([(u'dir_mode', 755)]), OrderedDict([(u'require', [OrderedDict([(u'x509', u'Create Salt API private key')])])])])]))])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/master/certs/salt-api.sls' using 'yaml' renderer: 0.00200796127319
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/salt/master/configured.sls' to resolve 'salt://metalk8s/salt/master/configured.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/master/configured.sls' to resolve 'salt://metalk8s/salt/master/configured.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/salt/master/configured.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/salt/master/configured.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/master/configured.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[WARNING ] Skip, invalid archive path /metalk8s.iso, should be an iso or a directory.
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/master/configured.sls' using 'jinja' renderer: 0.0661158561707
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/master/configured.sls:


Configure salt master:
  file.managed:
    - name: /etc/salt/master.d/99-metalk8s.conf
    - source: salt://metalk8s/salt/master/files/master-99-metalk8s.conf.j2
    - user: root
    - group: root
    - mode: '0644'
    - makedirs: true
    - backup: false
    - template: jinja
    - defaults:
        debug: False
        salt_ip: "10.0.3.15"
        kubeconfig: "/etc/salt/master-kubeconfig.conf"

Configure salt master roots paths:
  file.serialize:
    - name: /etc/salt/master.d/99-metalk8s-roots.conf
    - user: root
    - group: root
    - mode: '0644'
    - formatter: yaml
    - merge_if_exists: True
    - makedirs: true
    - backup: false
    - dataset:
        file_roots:
        pillar_roots:

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'Configure salt master', OrderedDict([(u'file.managed', [OrderedDict([(u'name', u'/etc/salt/master.d/99-metalk8s.conf')]), OrderedDict([(u'source', u'salt://metalk8s/salt/master/files/master-99-metalk8s.conf.j2')]), OrderedDict([(u'user', u'root')]), OrderedDict([(u'group', u'root')]), OrderedDict([(u'mode', u'0644')]), OrderedDict([(u'makedirs', True)]), OrderedDict([(u'backup', False)]), OrderedDict([(u'template', u'jinja')]), OrderedDict([(u'defaults', OrderedDict([(u'debug', False), (u'salt_ip', u'10.0.3.15'), (u'kubeconfig', u'/etc/salt/master-kubeconfig.conf')]))])])])), (u'Configure salt master roots paths', OrderedDict([(u'file.serialize', [OrderedDict([(u'name', u'/etc/salt/master.d/99-metalk8s-roots.conf')]), OrderedDict([(u'user', u'root')]), OrderedDict([(u'group', u'root')]), OrderedDict([(u'mode', u'0644')]), OrderedDict([(u'formatter', u'yaml')]), OrderedDict([(u'merge_if_exists', True)]), OrderedDict([(u'makedirs', True)]), OrderedDict([(u'backup', False)]), OrderedDict([(u'dataset', OrderedDict([(u'file_roots', None), (u'pillar_roots', None)]))])])]))])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/master/configured.sls' using 'yaml' renderer: 0.00144290924072
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/salt/master/installed.sls' to resolve 'salt://metalk8s/salt/master/installed.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/master/installed.sls' to resolve 'salt://metalk8s/salt/master/installed.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/salt/master/installed.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/salt/master/installed.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/master/installed.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/repo/macro.sls' to resolve 'salt://metalk8s/repo/macro.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/repo/macro.sls' to resolve 'salt://metalk8s/repo/macro.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/repo/macro.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/repo/macro.sls'
[WARNING ] Skip, invalid archive path /metalk8s.iso, should be an iso or a directory.
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/master/installed.sls' using 'jinja' renderer: 0.0929760932922
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/master/installed.sls:




include:
  - .configured

Create salt master directories:
  file.directory:
    - user: root
    - group: root
    - mode: '0700'
    - makedirs: true
    - names:
      - /etc/salt
      - /var/cache/salt
      - /var/run/salt

Install and start salt master manifest:
  metalk8s.static_pod_managed:
    - name: /etc/kubernetes/manifests/salt-master.yaml
    - source: salt://metalk8s/salt/master/files/salt-master-manifest.yaml.j2
    - config_files:
      - /etc/salt/master.d/99-metalk8s.conf
      - /etc/salt/master.d/99-metalk8s-roots.conf
    - context:
        debug: False
        image: metalk8s-registry-from-config.invalid/metalk8s-2.6.0-dev/salt-master:3000.3-1
        version: 3000.3-1
        archives: {}
        solution_archives: {}
        salt_ip: "10.0.3.15"
    - require:
      - file: Create salt master directories
      - file: /etc/salt/master.d/99-metalk8s.conf
      - file: /etc/salt/master.d/99-metalk8s-roots.conf

Delay after new pod deployment:
  module.wait:
    - test.sleep:
      - length: 10
    - watch:
      - metalk8s: Install and start salt master manifest

Make sure salt master container is up:
  module.wait:
    - cri.wait_container:
      - name: salt-master
      - state: running
    - watch:
      - metalk8s: Install and start salt master manifest
    - require:
      - module: Delay after new pod deployment

Wait for Salt API to answer:
  http.wait_for_successful_query:
    - name: https://10.0.3.15:4507/
    - ca_bundle: /etc/kubernetes/pki/ca.crt
    - status: 200
    - require:
      - module: Make sure salt master container is up

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'include', [u'.configured']), (u'Create salt master directories', OrderedDict([(u'file.directory', [OrderedDict([(u'user', u'root')]), OrderedDict([(u'group', u'root')]), OrderedDict([(u'mode', u'0700')]), OrderedDict([(u'makedirs', True)]), OrderedDict([(u'names', [u'/etc/salt', u'/var/cache/salt', u'/var/run/salt'])])])])), (u'Install and start salt master manifest', OrderedDict([(u'metalk8s.static_pod_managed', [OrderedDict([(u'name', u'/etc/kubernetes/manifests/salt-master.yaml')]), OrderedDict([(u'source', u'salt://metalk8s/salt/master/files/salt-master-manifest.yaml.j2')]), OrderedDict([(u'config_files', [u'/etc/salt/master.d/99-metalk8s.conf', u'/etc/salt/master.d/99-metalk8s-roots.conf'])]), OrderedDict([(u'context', OrderedDict([(u'debug', False), (u'image', u'metalk8s-registry-from-config.invalid/metalk8s-2.6.0-dev/salt-master:3000.3-1'), (u'version', u'3000.3-1'), (u'archives', OrderedDict()), (u'solution_archives', OrderedDict()), (u'salt_ip', u'10.0.3.15')]))]), OrderedDict([(u'require', [OrderedDict([(u'file', u'Create salt master directories')]), OrderedDict([(u'file', u'/etc/salt/master.d/99-metalk8s.conf')]), OrderedDict([(u'file', u'/etc/salt/master.d/99-metalk8s-roots.conf')])])])])])), (u'Delay after new pod deployment', OrderedDict([(u'module.wait', [OrderedDict([(u'test.sleep', [OrderedDict([(u'length', 10)])])]), OrderedDict([(u'watch', [OrderedDict([(u'metalk8s', u'Install and start salt master manifest')])])])])])), (u'Make sure salt master container is up', OrderedDict([(u'module.wait', [OrderedDict([(u'cri.wait_container', [OrderedDict([(u'name', u'salt-master')]), OrderedDict([(u'state', u'running')])])]), OrderedDict([(u'watch', [OrderedDict([(u'metalk8s', u'Install and start salt master manifest')])])]), OrderedDict([(u'require', [OrderedDict([(u'module', u'Delay after new pod deployment')])])])])])), (u'Wait for Salt API to answer', OrderedDict([(u'http.wait_for_successful_query', [OrderedDict([(u'name', u'https://10.0.3.15:4507/')]), OrderedDict([(u'ca_bundle', u'/etc/kubernetes/pki/ca.crt')]), OrderedDict([(u'status', 200)]), OrderedDict([(u'require', [OrderedDict([(u'module', u'Make sure salt master container is up')])])])])]))])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/master/installed.sls' using 'yaml' renderer: 0.00340008735657
[DEBUG   ] Could not find file 'salt://metalk8s/kubectl.sls' in saltenv 'metalk8s-2.6.0-dev'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/kubectl/init.sls' to resolve 'salt://metalk8s/kubectl/init.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubectl/init.sls' to resolve 'salt://metalk8s/kubectl/init.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/kubectl/init.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/kubectl/init.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubectl/init.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubectl/init.sls' using 'jinja' renderer: 0.00179505348206
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubectl/init.sls:
#
# State to manage kubectl.
#
# Available states
# ================
#
# * installed   -> Ensure kubectl is installed
#

include:
  - .installed

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'include', [u'.installed'])])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubectl/init.sls' using 'yaml' renderer: 0.000490188598633
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/kubectl/installed.sls' to resolve 'salt://metalk8s/kubectl/installed.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubectl/installed.sls' to resolve 'salt://metalk8s/kubectl/installed.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/kubectl/installed.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/kubectl/installed.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubectl/installed.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/macro.sls' to resolve 'salt://metalk8s/macro.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/macro.sls' to resolve 'salt://metalk8s/macro.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubectl/installed.sls' using 'jinja' renderer: 0.0910129547119
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubectl/installed.sls:


include :
  - metalk8s.repo

Install kubectl:
  
  metalk8s_package_manager.installed:
    - name: kubectl
    - pkgs_info: {"kubectl": {"version": "1.17.9"}, "xfsprogs": {"version": null}, "httpd-tools": {"version": null}, "iproute": {"version": null}, "sos": {"version": null}, "yum-plugin-versionlock": {"version": null}, "socat": {"version": null}, "containerd": {"version": "1.2.13-2.el7"}, "coreutils": {"version": null}, "container-selinux": {"version": null}, "iptables": {"version": null}, "ebtables": {"version": null}, "salt-minion": {"version": "3000.3"}, "calico-cni-plugin": {"version": "3.12.0-1.el7"}, "yum-utils": {"version": null}, "kubelet": {"version": "1.17.9"}, "m2crypto": {"version": null}, "genisoimage": {"version": null}, "util-linux": {"version": null}, "metalk8s-sosreport": {"version": "2.6-1.el7"}, "cri-tools": {"version": null}, "ethtool": {"version": null}, "e2fsprogs": {"version": null}, "runc": {"version": null}, "kubernetes-cni": {"version": null}}
    - version: 1.17.9
    - hold: True
    - update_holds: True
    - ignore_epoch: True
    - reload_modules: True
    - require:
      - test: Repositories configured

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'include', [u'metalk8s.repo']), (u'Install kubectl', OrderedDict([(u'metalk8s_package_manager.installed', [OrderedDict([(u'name', u'kubectl')]), OrderedDict([(u'pkgs_info', OrderedDict([(u'kubectl', OrderedDict([(u'version', u'1.17.9')])), (u'xfsprogs', OrderedDict([(u'version', None)])), (u'httpd-tools', OrderedDict([(u'version', None)])), (u'iproute', OrderedDict([(u'version', None)])), (u'sos', OrderedDict([(u'version', None)])), (u'yum-plugin-versionlock', OrderedDict([(u'version', None)])), (u'socat', OrderedDict([(u'version', None)])), (u'containerd', OrderedDict([(u'version', u'1.2.13-2.el7')])), (u'coreutils', OrderedDict([(u'version', None)])), (u'container-selinux', OrderedDict([(u'version', None)])), (u'iptables', OrderedDict([(u'version', None)])), (u'ebtables', OrderedDict([(u'version', None)])), (u'salt-minion', OrderedDict([(u'version', u'3000.3')])), (u'calico-cni-plugin', OrderedDict([(u'version', u'3.12.0-1.el7')])), (u'yum-utils', OrderedDict([(u'version', None)])), (u'kubelet', OrderedDict([(u'version', u'1.17.9')])), (u'm2crypto', OrderedDict([(u'version', None)])), (u'genisoimage', OrderedDict([(u'version', None)])), (u'util-linux', OrderedDict([(u'version', None)])), (u'metalk8s-sosreport', OrderedDict([(u'version', u'2.6-1.el7')])), (u'cri-tools', OrderedDict([(u'version', None)])), (u'ethtool', OrderedDict([(u'version', None)])), (u'e2fsprogs', OrderedDict([(u'version', None)])), (u'runc', OrderedDict([(u'version', None)])), (u'kubernetes-cni', OrderedDict([(u'version', None)]))]))]), OrderedDict([(u'version', u'1.17.9')]), OrderedDict([(u'hold', True)]), OrderedDict([(u'update_holds', True)]), OrderedDict([(u'ignore_epoch', True)]), OrderedDict([(u'reload_modules', True)]), OrderedDict([(u'require', [OrderedDict([(u'test', u'Repositories configured')])])])])]))])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/kubectl/installed.sls' using 'yaml' renderer: 0.00400495529175
[DEBUG   ] Could not find file 'salt://metalk8s/roles/minion.sls' in saltenv 'metalk8s-2.6.0-dev'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/roles/minion/init.sls' to resolve 'salt://metalk8s/roles/minion/init.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/roles/minion/init.sls' to resolve 'salt://metalk8s/roles/minion/init.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/roles/minion/init.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/roles/minion/init.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/roles/minion/init.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/roles/minion/init.sls' using 'jinja' renderer: 0.000892162322998
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/roles/minion/init.sls:
include:
  - metalk8s.salt.minion.configured
  - metalk8s.sreport.installed

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'include', [u'metalk8s.salt.minion.configured', u'metalk8s.sreport.installed'])])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/roles/minion/init.sls' using 'yaml' renderer: 0.000277996063232
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/salt/minion/configured.sls' to resolve 'salt://metalk8s/salt/minion/configured.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/minion/configured.sls' to resolve 'salt://metalk8s/salt/minion/configured.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/salt/minion/configured.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/salt/minion/configured.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/minion/configured.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/minion/configured.sls' using 'jinja' renderer: 0.0654029846191
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/minion/configured.sls:


include:
  - .installed
  - .running

Configure salt minion:
  file.managed:
    - name: /etc/salt/minion.d/99-metalk8s.conf
    - source: salt://metalk8s/salt/minion/files/minion-99-metalk8s.conf.j2
    - template: jinja
    - user: root
    - group: root
    - mode: '0644'
    - makedirs: true
    - backup: false
    - defaults:
        debug: False
        master_hostname: 10.0.3.15
        minion_id: 10.0.2.15
        saltenv: metalk8s-2.6.0-dev
    - watch_in:
      - cmd: Restart salt-minion

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'include', [u'.installed', u'.running']), (u'Configure salt minion', OrderedDict([(u'file.managed', [OrderedDict([(u'name', u'/etc/salt/minion.d/99-metalk8s.conf')]), OrderedDict([(u'source', u'salt://metalk8s/salt/minion/files/minion-99-metalk8s.conf.j2')]), OrderedDict([(u'template', u'jinja')]), OrderedDict([(u'user', u'root')]), OrderedDict([(u'group', u'root')]), OrderedDict([(u'mode', u'0644')]), OrderedDict([(u'makedirs', True)]), OrderedDict([(u'backup', False)]), OrderedDict([(u'defaults', OrderedDict([(u'debug', False), (u'master_hostname', u'10.0.3.15'), (u'minion_id', u'10.0.2.15'), (u'saltenv', u'metalk8s-2.6.0-dev')]))]), OrderedDict([(u'watch_in', [OrderedDict([(u'cmd', u'Restart salt-minion')])])])])]))])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/minion/configured.sls' using 'yaml' renderer: 0.00179815292358
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/salt/minion/installed.sls' to resolve 'salt://metalk8s/salt/minion/installed.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/minion/installed.sls' to resolve 'salt://metalk8s/salt/minion/installed.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/salt/minion/installed.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/salt/minion/installed.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/minion/installed.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/macro.sls' to resolve 'salt://metalk8s/macro.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/macro.sls' to resolve 'salt://metalk8s/macro.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/minion/installed.sls' using 'jinja' renderer: 0.0621700286865
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/minion/installed.sls:


include :
  - metalk8s.repo
  - .running

Install salt-minion:
  
  metalk8s_package_manager.installed:
    - name: salt-minion
    - pkgs_info: {"kubectl": {"version": "1.17.9"}, "xfsprogs": {"version": null}, "httpd-tools": {"version": null}, "iproute": {"version": null}, "sos": {"version": null}, "yum-plugin-versionlock": {"version": null}, "socat": {"version": null}, "containerd": {"version": "1.2.13-2.el7"}, "coreutils": {"version": null}, "container-selinux": {"version": null}, "iptables": {"version": null}, "ebtables": {"version": null}, "salt-minion": {"version": "3000.3"}, "calico-cni-plugin": {"version": "3.12.0-1.el7"}, "yum-utils": {"version": null}, "kubelet": {"version": "1.17.9"}, "m2crypto": {"version": null}, "genisoimage": {"version": null}, "util-linux": {"version": null}, "metalk8s-sosreport": {"version": "2.6-1.el7"}, "cri-tools": {"version": null}, "ethtool": {"version": null}, "e2fsprogs": {"version": null}, "runc": {"version": null}, "kubernetes-cni": {"version": null}}
    - version: 3000.3
    - hold: True
    - update_holds: True
    - ignore_epoch: True
    - reload_modules: True
    # NOTE: launch `salt-minion` installation/upgrade/downgrade at the
    # end as this may have impact on the running salt states
    - order: last
    - require:
      - test: Repositories configured
    - require_in:
      - cmd: Restart salt-minion

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'include', [u'metalk8s.repo', u'.running']), (u'Install salt-minion', OrderedDict([(u'metalk8s_package_manager.installed', [OrderedDict([(u'name', u'salt-minion')]), OrderedDict([(u'pkgs_info', OrderedDict([(u'kubectl', OrderedDict([(u'version', u'1.17.9')])), (u'xfsprogs', OrderedDict([(u'version', None)])), (u'httpd-tools', OrderedDict([(u'version', None)])), (u'iproute', OrderedDict([(u'version', None)])), (u'sos', OrderedDict([(u'version', None)])), (u'yum-plugin-versionlock', OrderedDict([(u'version', None)])), (u'socat', OrderedDict([(u'version', None)])), (u'containerd', OrderedDict([(u'version', u'1.2.13-2.el7')])), (u'coreutils', OrderedDict([(u'version', None)])), (u'container-selinux', OrderedDict([(u'version', None)])), (u'iptables', OrderedDict([(u'version', None)])), (u'ebtables', OrderedDict([(u'version', None)])), (u'salt-minion', OrderedDict([(u'version', u'3000.3')])), (u'calico-cni-plugin', OrderedDict([(u'version', u'3.12.0-1.el7')])), (u'yum-utils', OrderedDict([(u'version', None)])), (u'kubelet', OrderedDict([(u'version', u'1.17.9')])), (u'm2crypto', OrderedDict([(u'version', None)])), (u'genisoimage', OrderedDict([(u'version', None)])), (u'util-linux', OrderedDict([(u'version', None)])), (u'metalk8s-sosreport', OrderedDict([(u'version', u'2.6-1.el7')])), (u'cri-tools', OrderedDict([(u'version', None)])), (u'ethtool', OrderedDict([(u'version', None)])), (u'e2fsprogs', OrderedDict([(u'version', None)])), (u'runc', OrderedDict([(u'version', None)])), (u'kubernetes-cni', OrderedDict([(u'version', None)]))]))]), OrderedDict([(u'version', 3000.3)]), OrderedDict([(u'hold', True)]), OrderedDict([(u'update_holds', True)]), OrderedDict([(u'ignore_epoch', True)]), OrderedDict([(u'reload_modules', True)]), OrderedDict([(u'order', u'last')]), OrderedDict([(u'require', [OrderedDict([(u'test', u'Repositories configured')])])]), OrderedDict([(u'require_in', [OrderedDict([(u'cmd', u'Restart salt-minion')])])])])]))])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/minion/installed.sls' using 'yaml' renderer: 0.0035879611969
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/salt/minion/running.sls' to resolve 'salt://metalk8s/salt/minion/running.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/minion/running.sls' to resolve 'salt://metalk8s/salt/minion/running.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/salt/minion/running.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/salt/minion/running.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/minion/running.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/minion/running.sls' using 'jinja' renderer: 0.00105810165405
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/minion/running.sls:
Restart salt-minion:
  cmd.wait:
    - name: 'salt-call --local service.restart salt-minion > /dev/null'
    - bg: true

Wait until salt-minion restarted:
  test.configurable_test_state:
    - changes: False
    - result: __slot__:salt:test.sleep(10)
    - comment: Wait a bit for 'salt-minion' to restart
    - onchanges:
      - cmd: Restart salt-minion

Ensure salt-minion running:
  service.running:
    - name: salt-minion
    - enable: True
    - require:
      - test: Wait until salt-minion restarted
  test.configurable_test_state:
    - changes: False
    - result: __slot__:salt:test.ping()
    - comment: Ran 'test.ping'
    - require:
      - service: Ensure salt-minion running

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'Restart salt-minion', OrderedDict([(u'cmd.wait', [OrderedDict([(u'name', u'salt-call --local service.restart salt-minion > /dev/null')]), OrderedDict([(u'bg', True)])])])), (u'Wait until salt-minion restarted', OrderedDict([(u'test.configurable_test_state', [OrderedDict([(u'changes', False)]), OrderedDict([(u'result', u'__slot__:salt:test.sleep(10)')]), OrderedDict([(u'comment', u"Wait a bit for 'salt-minion' to restart")]), OrderedDict([(u'onchanges', [OrderedDict([(u'cmd', u'Restart salt-minion')])])])])])), (u'Ensure salt-minion running', OrderedDict([(u'service.running', [OrderedDict([(u'name', u'salt-minion')]), OrderedDict([(u'enable', True)]), OrderedDict([(u'require', [OrderedDict([(u'test', u'Wait until salt-minion restarted')])])])]), (u'test.configurable_test_state', [OrderedDict([(u'changes', False)]), OrderedDict([(u'result', u'__slot__:salt:test.ping()')]), OrderedDict([(u'comment', u"Ran 'test.ping'")]), OrderedDict([(u'require', [OrderedDict([(u'service', u'Ensure salt-minion running')])])])])]))])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/salt/minion/running.sls' using 'yaml' renderer: 0.00163507461548
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/sreport/installed.sls' to resolve 'salt://metalk8s/sreport/installed.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/sreport/installed.sls' to resolve 'salt://metalk8s/sreport/installed.sls'
[DEBUG   ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** attempting ** 'salt://metalk8s/sreport/installed.sls'
[DEBUG   ] No dest file found
[INFO    ] Fetching file from saltenv 'metalk8s-2.6.0-dev', ** done ** 'metalk8s/sreport/installed.sls'
[DEBUG   ] compile template: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/sreport/installed.sls
[DEBUG   ] Jinja search path: [u'/var/cache/salt/minion/files/metalk8s-2.6.0-dev']
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/macro.sls' to resolve 'salt://metalk8s/macro.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/macro.sls' to resolve 'salt://metalk8s/macro.sls'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/map.jinja' to resolve 'salt://metalk8s/map.jinja'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/defaults.yaml' to resolve 'salt://metalk8s/defaults.yaml'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', looking at rel_path 'metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[DEBUG   ] In saltenv 'metalk8s-2.6.0-dev', ** considering ** path '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/versions.json' to resolve 'salt://metalk8s/versions.json'
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/sreport/installed.sls' using 'jinja' renderer: 0.103574037552
[DEBUG   ] Rendered data from file: /var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/sreport/installed.sls:


include:
  - metalk8s.repo

Install sos report and custom plugins:
  
  metalk8s_package_manager.installed:
    - name: metalk8s-sosreport
    - pkgs_info: {"kubectl": {"version": "1.17.9"}, "xfsprogs": {"version": null}, "httpd-tools": {"version": null}, "iproute": {"version": null}, "sos": {"version": null}, "yum-plugin-versionlock": {"version": null}, "socat": {"version": null}, "containerd": {"version": "1.2.13-2.el7"}, "coreutils": {"version": null}, "container-selinux": {"version": null}, "iptables": {"version": null}, "ebtables": {"version": null}, "salt-minion": {"version": "3000.3"}, "calico-cni-plugin": {"version": "3.12.0-1.el7"}, "yum-utils": {"version": null}, "kubelet": {"version": "1.17.9"}, "m2crypto": {"version": null}, "genisoimage": {"version": null}, "util-linux": {"version": null}, "metalk8s-sosreport": {"version": "2.6-1.el7"}, "cri-tools": {"version": null}, "ethtool": {"version": null}, "e2fsprogs": {"version": null}, "runc": {"version": null}, "kubernetes-cni": {"version": null}}
    - version: 2.6-1.el7
    - hold: True
    - update_holds: True
    - ignore_epoch: True
    - reload_modules: True
    - require:
      - test: Repositories configured

[DEBUG   ] Results of YAML rendering: 
OrderedDict([(u'include', [u'metalk8s.repo']), (u'Install sos report and custom plugins', OrderedDict([(u'metalk8s_package_manager.installed', [OrderedDict([(u'name', u'metalk8s-sosreport')]), OrderedDict([(u'pkgs_info', OrderedDict([(u'kubectl', OrderedDict([(u'version', u'1.17.9')])), (u'xfsprogs', OrderedDict([(u'version', None)])), (u'httpd-tools', OrderedDict([(u'version', None)])), (u'iproute', OrderedDict([(u'version', None)])), (u'sos', OrderedDict([(u'version', None)])), (u'yum-plugin-versionlock', OrderedDict([(u'version', None)])), (u'socat', OrderedDict([(u'version', None)])), (u'containerd', OrderedDict([(u'version', u'1.2.13-2.el7')])), (u'coreutils', OrderedDict([(u'version', None)])), (u'container-selinux', OrderedDict([(u'version', None)])), (u'iptables', OrderedDict([(u'version', None)])), (u'ebtables', OrderedDict([(u'version', None)])), (u'salt-minion', OrderedDict([(u'version', u'3000.3')])), (u'calico-cni-plugin', OrderedDict([(u'version', u'3.12.0-1.el7')])), (u'yum-utils', OrderedDict([(u'version', None)])), (u'kubelet', OrderedDict([(u'version', u'1.17.9')])), (u'm2crypto', OrderedDict([(u'version', None)])), (u'genisoimage', OrderedDict([(u'version', None)])), (u'util-linux', OrderedDict([(u'version', None)])), (u'metalk8s-sosreport', OrderedDict([(u'version', u'2.6-1.el7')])), (u'cri-tools', OrderedDict([(u'version', None)])), (u'ethtool', OrderedDict([(u'version', None)])), (u'e2fsprogs', OrderedDict([(u'version', None)])), (u'runc', OrderedDict([(u'version', None)])), (u'kubernetes-cni', OrderedDict([(u'version', None)]))]))]), OrderedDict([(u'version', u'2.6-1.el7')]), OrderedDict([(u'hold', True)]), OrderedDict([(u'update_holds', True)]), OrderedDict([(u'ignore_epoch', True)]), OrderedDict([(u'reload_modules', True)]), OrderedDict([(u'require', [OrderedDict([(u'test', u'Repositories configured')])])])])]))])
[PROFILE ] Time (in seconds) to render '/var/cache/salt/minion/files/metalk8s-2.6.0-dev/metalk8s/sreport/installed.sls' using 'yaml' renderer: 0.00247001647949
[DEBUG   ] LazyLoaded highstate.output
[TRACE   ] data = {u'local': [u"Rendering SLS 'metalk8s-2.6.0-dev:metalk8s.repo.redhat' failed: Jinja variable 'dict object' has no attribute u'metalk8s-2.6.0-dev'", u"Rendering SLS 'metalk8s-2.6.0-dev:metalk8s.repo.installed' failed: Jinja variable 'dict object' has no attribute u'metalk8s-2.6.0-dev'"]}
local:
    Data failed to compile:
----------
    Rendering SLS 'metalk8s-2.6.0-dev:metalk8s.repo.redhat' failed: Jinja variable 'dict object' has no attribute u'metalk8s-2.6.0-dev'
----------
    Rendering SLS 'metalk8s-2.6.0-dev:metalk8s.repo.installed' failed: Jinja variable 'dict object' has no attribute u'metalk8s-2.6.0-dev'
+ cat
<< END >>

This script will now exit

+ exit 1
cleanup
+ cleanup
+ rm -rf /tmp/tmp.SDSHkRiDts
